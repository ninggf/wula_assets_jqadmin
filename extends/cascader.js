layui.define(["jquery","laytpl","layer"],function(i){function t(i){this.option=i,this.domContent="",this.textArr=[],this.textStr="",this.valueArr=[],this.onOff=!1,this.positionArr=[],this.blockData={},this.count=0,this.initOption()}var e=layui.jquery,n=layui.laytpl,o=layui.layer,l=3e3;t.prototype={constructor:t,initOption:function(){var i=this;if(i.option.elem?function(){i.elem=i.option.elem}():function(){throw"缺少elem节点选择器"}(),i.triggerType="change"===i.option.triggerType?"mouseenter":"click",i.option.data)return i.d=i.option.data,void i.callback();if(i.option.url)return void e.ajax({url:i.option.url,type:i.option.type?i.option.type:"get",data:i.option.where?i.option.where:{},success:function(t){return 0===t.Code?(i.d=t.Data,void i.callback()):void o.alert(t.Msg,{title:"选择器"+i.elem+"获取数据失败",icon:2})}});throw"选择器"+i.elem+"缺少data或url参数"},init:function(){e(this.elem).after('<i class="layui-icon layui-icon-down"></i>'),e(this.elem).after('<div class="urp-cascader-content"></div>')},initFirst:function(){var i=n('<ul class="urp-cascader-child">{{# for(var i=0;i<d.length;i++){ }}<li>{{ d[i].label }}<i class="layui-icon layui-icon-right" ></i></li>{{# } }}</ul>').render(this.d);e(this.elem).siblings(".urp-cascader-content").append(i),this.domContent=e(this.elem).siblings(".urp-cascader-content"),this.domContent.find(".urp-cascader-child").hide();for(var t=0;t<this.d.length;t++)"children"in this.d[t]?this.domContent.find("ul.urp-cascader-child li").eq(t).find("i").show():this.domContent.find("ul.urp-cascader-child li").eq(t).find("i").hide()},getBlockData:function(i,t){i.stopPropagation(),this.floor=e(t).parent().index();var n=e(t).index();this.positionArr.length=this.floor,this.positionArr.push(n),this.blockData=this.d[this.positionArr[0]];for(var o=1;o<=this.floor;o++)this.blockData=this.blockData.children[this.positionArr[o]]},initChild:function(){this.domContent.find(".urp-cascader-child:gt("+this.floor+")").remove(),this.textArr.length=this.floor,this.textArr.push(this.blockData.label),this.valueArr.length=this.floor,this.valueArr.push(this.blockData.value);var i=n('<ul class="urp-cascader-child">{{# for(var i=0;i< d.length;i++){ }}<li>{{ d[i].label }}<i class="layui-icon layui-icon-right"></i></li>{{# } }}</ul>').render(this.blockData.children);this.domContent.append(i);for(var t=0;t<this.blockData.children.length;t++)"children"in this.blockData.children[t]?this.domContent.find("ul.urp-cascader-child:gt("+this.floor+")").find("li").eq(t).find("i").show():this.domContent.find("ul.urp-cascader-child:gt("+this.floor+")").find("li").eq(t).find("i").hide()},finishInitData:function(){this.domContent.find(".urp-cascader-child:gt("+this.floor+")").remove(),this.textArr.length=this.floor,this.textArr.push(this.blockData.label),this.valueArr.length=this.floor,this.valueArr.push(this.blockData.value),this.textStr=this.textArr.join("/"),this.option.showLastLevels?e(this.elem).val(this.textArr[this.textArr.length-1]):e(this.elem).val(this.textStr),this.onOff=!1,e(this.elem).siblings(".urp-cascader-content").find("ul").slideUp(100),e(this.elem).siblings("i").replaceWith('<i class="layui-icon layui-icon-down"></i>'),this.count++,e.isArray(this.option.value)&&this.option.value.length>0&&1===this.count&&this.option.success||this.option.success&&this.option.success(this.valueArr,this.textArr)},initValue:function(){var i=this;e.isArray(this.option.value)&&this.option.value.length>0?function(){var t=i.option.value;e(i.elem).trigger("click");var n=[],o=i.d;t.forEach(function(t,l){if(!o)throw"选择器"+i.elem+"初始化数据不匹配";for(var s=0;s<o.length;s++)o[s].value==t&&(n.push(s),i.domContent.find(".urp-cascader-child").eq(l).find("li").eq(s).trigger(i.triggerType,"initValue"),e(i.elem).siblings(".urp-cascader-content").find("ul").finish());o[n[l]]?function(){o=o[n[l]].children}():function(){throw"选择器"+i.elem+"初始化数据不匹配"}()})}():""},callback:function(){this.init(),this.initFirst();var i=this;i.domContent.on(i.triggerType,".urp-cascader-child li",function(t,n){var o=this;i.getBlockData(t,this),e(this).addClass("active").siblings("li").removeClass("active"),"children"in i.blockData?i.initChild():"mouseenter"===i.triggerType?function(){i.domContent.find(".urp-cascader-child:gt("+i.floor+")").remove(),e(o).off("click").on("click",function(){i.finishInitData()}),"initValue"===n&&e(o).trigger("click")}():i.finishInitData()}),e(i.elem).on("click",function(){i.onOff=!i.onOff,l++,i.onOff?(e(i.elem).siblings(".urp-cascader-content").find("ul").slideDown(100),e(i.elem).siblings("i").replaceWith('<i class="layui-icon layui-icon-up"></i>'),i.domContent.css("zIndex",l)):(e(i.elem).siblings(".urp-cascader-content").find("ul").slideUp(100),e(i.elem).siblings("i").replaceWith('<i class="layui-icon layui-icon-down"></i>'))}),e(document).on("click",function(t){t.target.isEqualNode(e(i.elem).get(0))||(i.onOff=!1,i.onOff||(e(i.elem).siblings(".urp-cascader-content").find("ul").slideUp(100),e(i.elem).siblings("i").replaceWith('<i class="layui-icon layui-icon-down"></i>')))}),i.initValue()}},i("cascader",function(i){new t(i)})});