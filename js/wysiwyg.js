layui.define(["jquery","laytpl","bootstrap"],function(t){var r=layui.$,d=r,s=layui.laytpl,c='<div class="pull-in"><div class="form-group clearfix"><div class="col-xs-4"><label>target</label><br/><input type="text" class="form-control" value="{{d.target}}" name="target"></div><div class="col-xs-8"><label>标题</label><br/><input type="text" class="form-control" value="{{=d.title}}" name="title"></div></div><div class="form-group clearfix"><div class="col-xs-12"><label>URL</label><div class="input-group"><input class="form-control" placeholder="URL" type="text" value="{{d.href}}" name="href"><span class="input-group-btn"><button class="btn btn-success btn-icon" type="button"><i class="fa fa-check-square"></i></button></span></div></div></div>',u='<div class="pull-in"><div class="form-group clearfix"><div class="col-xs-3"><label>宽</label><br/><input type="text" class="form-control" value="{{d.width}}" name="width"></div><div class="col-xs-3"><label>高</label><br/><input type="text" class="form-control" value="{{d.height}}" name="height"></div><div class="col-xs-6"><label>替换文本</label><br/><input type="text" class="form-control" value="{{=d.alt}}" name="alt"></div></div><div class="form-group clearfix"><div class="col-xs-12"><label>排版</label><br/><div><label class="checkbox-inline"><input type="radio" name="float" value="none">无</label><label class="checkbox-inline"><input type="radio" name="float" value="left">居左</label><label class="checkbox-inline"><input type="radio" name="float" value="right">居右</label></div></div></div><div class="form-group clearfix"><div class="col-xs-12"><label>图片地址</label><div class="input-group"><input class="form-control" placeholder="SRC" type="text" value="{{d.src}}" name="src"><span class="input-group-btn"><button class="btn btn-success btn-icon" type="button"><i class="fa fa-check-square"></i></button></span></div></div></div>';function e(t){if("string"==typeof t.data&&(t.data={keys:t.data}),t.data&&t.data.keys&&"string"==typeof t.data.keys){var r=t.handler,s=t.data.keys.toLowerCase().split(" "),c=["text","password","number","email","url","range","date","month","week","time","datetime","datetime-local","search","color","tel"];t.handler=function(t){if(this===t.target||!(/textarea|select/i.test(t.target.nodeName)||-1<d.inArray(t.target.type,c))){var e=d.hotkeys.specialKeys[t.keyCode],a="keypress"===t.type&&String.fromCharCode(t.which).toLowerCase(),o="",n={};t.altKey&&"alt"!==e&&(o+="alt+"),t.ctrlKey&&"ctrl"!==e&&(o+="ctrl+"),t.metaKey&&!t.ctrlKey&&"meta"!==e&&(o+="meta+"),t.shiftKey&&"shift"!==e&&(o+="shift+"),e&&(n[o+e]=!0),a&&(n[o+a]=!0,n[o+d.hotkeys.shiftNums[a]]=!0,"shift+"===o&&(n[d.hotkeys.shiftNums[a]]=!0));for(var i=0,l=s.length;i<l;i++)if(n[s[i]])return r.apply(this,arguments)}}}}function a(t,e){var o=this;this.selectedRange=null,this.editor=r(t).on("click",function(){r(this).find("a,img").removeAttr("data-original-title").popover("destroy")});var n=r(t),i=r.extend(!0,{},{hotKeys:{"Ctrl+b meta+b":"bold","Ctrl+i meta+i":"italic","Ctrl+u meta+u":"underline","Ctrl+f meta+f":"removeFormat","Ctrl+z":"undo","Ctrl+y meta+y meta+shift+z":"redo","Ctrl+l meta+l":"justifyleft","Ctrl+r meta+r":"justifyright","Ctrl+e meta+e":"justifycenter","Ctrl+j meta+j":"justifyfull","Shift+tab":"outdent",tab:"indent"},toolbarSelector:"[data-role=editor-toolbar]",commandRole:"edit",activeToolbarClass:"btn-info",selectionMarker:"edit-focus-marker",selectionColor:"darkgray",dragAndDropImages:!1,keypressTimeout:200,fileUploadError:function(t,e){}},e),l="a[data-"+(this.options=i).commandRole+"],button[data-"+i.commandRole+"],input[type=button][data-"+i.commandRole+"]";this.toolbarBtnSelector=l,this.bindHotkeys(n,i,l),this.bindToolbar(n,r(i.toolbarSelector),i,l),n.attr("contenteditable",!0).on("mouseup keyup mouseout",function(){this.saveSelection(),this.updateToolbar(n,l,i)}.bind(this)),n.on("click","img",function(t){t.stopPropagation();var e,a,l=r(this).popover({container:"body",content:(e=r(this),a={src:e.attr("src")||"",alt:e.attr("alt")||"",width:e.css("width")||"",height:e.css("height")||"",float:e.css("float")||"none"},s(u).render(a)),html:!0,placement:"auto bottom",viewport:"#"+o.editor.attr("id"),trigger:"manual",template:'<div class="popover imgtag-dlg" role="tooltip" style="width: 400px;max-width:400px"><div class="arrow"></div><div class="popover-content"></div></div>'}).on("shown.bs.popover",function(){var t=l.css("float");r(".imgtag-dlg").find("[name=float][value="+t+"]").prop("checked",!0),r(".imgtag-dlg button").on("click",function(){var t=r(this).closest(".imgtag-dlg"),e=t.find("[name=src]").val(),a=t.find("[name=alt]").val(),o=t.find("[name=width]").val(),n=t.find("[name=height]").val(),i=t.find("[name=float]:checked").val();l.attr("src",e).attr("alt",a).css("width",o).css("height",n),"none"===i?l.css("float","none"):l.css("float",i),l.popover("destroy")})}).popover("show");return!1}).on("click","a",function(t){t.stopPropagation();var e,a,n=r(this).popover({container:"body",content:(e=r(this),a={href:e.attr("href")||"",target:e.attr("target")||"",title:e.attr("title")||""},s(c).render(a)),html:!0,placement:"auto bottom",viewport:"#"+o.editor.attr("id"),trigger:"manual",template:'<div class="popover atag-dlg" role="tooltip" style="width: 400px;max-width:400px"><div class="arrow"></div><div class="popover-content"></div></div>'}).on("shown.bs.popover",function(){r(".atag-dlg button").on("click",function(){var t=r(this).closest(".atag-dlg"),e=t.find("[name=target]").val(),a=t.find("[name=title]").val(),o=t.find("[name=href]").val();n.attr("target",e).attr("title",a).attr("href",o),n.popover("destroy")})}).popover("show");return!1}),r(window).bind("touchend",function(t){var e=n.is(t.target)||0<n.has(t.target).length,a=this.getCurrentRange();a&&a.startContainer===a.endContainer&&a.startOffset===a.endOffset&&!e||(this.saveSelection(),this.updateToolbar(n,l,i))})}a.prototype.updateToolbar=function(t,e,o){o.activeToolbarClass&&r(o.toolbarSelector).find(e).each(function(){var t=r(this),e=t.data(o.commandRole).split(" "),a=e[0];1<e.length&&document.queryCommandEnabled(a)&&document.queryCommandValue(a)===e[1]?t.addClass(o.activeToolbarClass):1===e.length&&document.queryCommandEnabled(a)&&document.queryCommandState(a)?t.addClass(o.activeToolbarClass):t.removeClass(o.activeToolbarClass)})},a.prototype.execCommand=function(t,e,a,o,n){var i=t.split(" "),l=i.shift(),r=i.join(" ")+(e||""),s=t.split("-");1===s.length?document.execCommand(l,!1,r):"format"===s[0]&&2===s.length&&document.execCommand("formatBlock",!1,s[1]),(a||this.editor).trigger("change"),this.updateToolbar(a||this.editor,n||this.toolbarBtnSelector,o||this.options)},a.prototype.bindHotkeys=function(a,o,n){var i=this;r.each(o.hotKeys,function(t,e){e&&r(a).keydown(t,function(t){a.attr("contenteditable")&&r(a).is(":visible")&&(t.preventDefault(),t.stopPropagation(),i.execCommand(e,null,a,o,n))}).keyup(t,function(t){a.attr("contenteditable")&&r(a).is(":visible")&&(t.preventDefault(),t.stopPropagation())})}),a.keyup(function(){a.trigger("change")})},a.prototype.getCurrentRange=function(){var t=void 0,e=void 0;return window.getSelection?(t=window.getSelection()).getRangeAt&&t.rangeCount&&(e=t.getRangeAt(0)):document.selection&&(e=document.selection.createRange()),e},a.prototype.saveSelection=function(){this.selectedRange=this.getCurrentRange()},a.prototype.restoreSelection=function(){var t=void 0;if(window.getSelection||document.createRange){if(t=window.getSelection(),this.selectedRange){try{t.removeAllRanges()}catch(t){document.body.createTextRange().select(),document.selection.empty()}t.addRange(this.selectedRange)}}else document.selection&&this.selectedRange&&this.selectedRange.select()},a.prototype.markSelection=function(t,e){this.restoreSelection(),document.queryCommandSupported("hiliteColor")&&document.execCommand("hiliteColor",!1,t||"transparent"),this.saveSelection()},a.prototype.bindToolbar=function(e,t,a,o){var n=this;t.find(o).click(function(){n.restoreSelection(),e.focus(),n.execCommand(r(this).data(a.commandRole),null,e,a,o),n.saveSelection()}),t.find("[data-toggle=dropdown]").on("click",function(){n.markSelection(a.selectionColor,a)}),t.on("hide.bs.dropdown",function(){n.markSelection(!1,a)}),t.find("input[type=text][data-"+a.commandRole+"]").on("webkitspeechchange change",function(){var t=this.value;this.value="",n.restoreSelection(),""===window.getSelection().toString().trim()&&t&&(n.editor.append("<span>"+t+"</span>"),function(t){if(window.getSelection&&document.createRange){var e=window.getSelection(),a=document.createRange();a.selectNodeContents(t),e.removeAllRanges(),e.addRange(a)}else if(document.selection&&document.body.createTextRange){var o=document.body.createTextRange();o.moveToElementText(t),o.select()}}(r("span:last",n.editor)[0])),t&&(e.focus(),n.execCommand(r(this).data(a.commandRole),t,e,a,o)),n.saveSelection()}).on("blur",function(){n.markSelection(!1,a)})},r.fn.wysiwyg=function(t){return new a(this,t)},r.hotkeys={version:"0.8",specialKeys:{8:"backspace",9:"tab",10:"return",13:"return",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scroll",186:";",191:"/",220:"\\",222:"'",224:"meta"},shiftNums:{"`":"~",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")","-":"_","=":"+",";":": ","'":'"',",":"<",".":">","/":"?","\\":"|"}},r.each(["keydown","keyup","keypress"],function(){r.event.special[this]={add:e}}),t("wysiwyg",a)});