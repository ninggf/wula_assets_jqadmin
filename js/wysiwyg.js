layui.define(["jquery","laytpl","bootstrap","layer"],function(e){var s=layui.$,d=s,c=layui.layer,u=layui.laytpl,r='<div class="pull-in"><div class="form-group clearfix"><div class="col-xs-4"><label>target</label><br/><select name="target"><option value="" selected>当前窗口</option><option value="_blank">新开窗口</option></select> </div><div class="col-xs-8"><label>标题</label><br/><input type="text" class="form-control" value="{{=d.title}}" name="title"></div></div><div class="form-group clearfix m-b-none"><div class="col-xs-12"><label>URL</label><br/><input class="form-control" placeholder="URL" type="text" value="{{d.href}}" name="href"></div></div></div>',m='<div class="pull-in"><div class="form-group clearfix"><div class="col-xs-3"><label>宽</label><br/><input type="text" class="form-control" value="{{d.width}}" name="width"></div><div class="col-xs-3"><label>高</label><br/><input type="text" class="form-control" value="{{d.height}}" name="height"></div><div class="col-xs-6"><label>替换文本</label><br/><input type="text" class="form-control" value="{{=d.alt}}" name="alt"></div></div><div class="form-group clearfix"><div class="col-xs-12"><label>排版</label><br/><div><label class="checkbox-inline"><input type="radio" name="float" value="none">无</label><label class="checkbox-inline"><input type="radio" name="float" value="left">居左</label><label class="checkbox-inline"><input type="radio" name="float" value="right">居右</label></div></div></div><div class="form-group clearfix m-b-none"><div class="col-xs-12"><label>图片地址</label><br/><input class="form-control" placeholder="SRC" type="text" value="{{d.src}}" name="src"></div></div></div>';function t(e){if("string"==typeof e.data&&(e.data={keys:e.data}),e.data&&e.data.keys&&"string"==typeof e.data.keys){var r=e.handler,s=e.data.keys.toLowerCase().split(" "),c=["text","password","number","email","url","range","date","month","week","time","datetime","datetime-local","search","color","tel"];e.handler=function(e){if(this===e.target||!(/textarea|select/i.test(e.target.nodeName)||-1<d.inArray(e.target.type,c))){var t=d.hotkeys.specialKeys[e.keyCode],a="keypress"===e.type&&String.fromCharCode(e.which).toLowerCase(),o="",n={};e.altKey&&"alt"!==t&&(o+="alt+"),e.ctrlKey&&"ctrl"!==t&&(o+="ctrl+"),e.metaKey&&!e.ctrlKey&&"meta"!==t&&(o+="meta+"),e.shiftKey&&"shift"!==t&&(o+="shift+"),t&&(n[o+t]=!0),a&&(n[o+a]=!0,n[o+d.hotkeys.shiftNums[a]]=!0,"shift+"===o&&(n[d.hotkeys.shiftNums[a]]=!0));for(var l=0,i=s.length;l<i;l++)if(n[s[l]])return r.apply(this,arguments)}}}}function n(e,t){var o=this,a=this;a.doc=e.ownerDocument||document;try{a.doc.execCommand("enableObjectResizing",!1,!1),a.doc.execCommand("defaultParagraphSeparator",!1,"p")}catch(e){}this.selectedRange=null,this.editor=s(e);var n=this.editor,l=s.extend(!0,{},{hotKeys:{"Ctrl+b meta+b":"bold","Ctrl+i meta+i":"italic","Ctrl+u meta+u":"underline","Ctrl+f meta+f":"removeFormat","Ctrl+z":"undo","Ctrl+y meta+y meta+shift+z":"redo","Ctrl+l meta+l":"justifyleft","Ctrl+r meta+r":"justifyright","Ctrl+e meta+e":"justifycenter","Ctrl+j meta+j":"justifyfull","Shift+tab":"outdent",tab:"indent"},toolbarSelector:"[data-role=editor-toolbar]",commandRole:"edit",activeToolbarClass:"btn-info",selectionMarker:"edit-focus-marker",selectionColor:"darkgray",dragAndDropImages:!1,keypressTimeout:200,fileUploadError:function(e,t){}},t),i="a[data-"+(this.options=l).commandRole+"],button[data-"+l.commandRole+"],input[type=button][data-"+l.commandRole+"]";this.toolbarBtnSelector=i,this.bindHotkeys(n,l,i),this.bindToolbar(n,s(l.toolbarSelector),l,i),n.attr("contenteditable",!0).on("mouseup keyup mouseout",function(){o.saveSelection(),o.updateToolbar(n,i,l)}.bind(this)),n.on("dblclick","img",function(e){e.stopPropagation();var t,a,r=s(this);return c.open({btn:["确认","取消"],shadeClose:!0,title:"编辑图片",content:(t=s(this),a={src:t.attr("src")||"",alt:t.attr("alt")||"",width:t.css("width")||"",height:t.css("height")||"",float:t.css("float")||"none"},u(m).render(a)),area:["500px","auto"],success:function(e){e.find("[name=float][value="+r.css("float")+"]").prop("checked",!0)},yes:function(e,t){var a=t.find("[name=src]").val(),o=t.find("[name=alt]").val(),n=t.find("[name=width]").val(),l=t.find("[name=height]").val(),i=t.find("[name=float]:checked").val();r.attr("src",a).attr("alt",o).css("width",n).css("height",l),"none"===i?r.css("float","none"):r.css("float",i),c.close(e)}}),!1}).on("dblclick","a",function(e){e.stopPropagation();var t,a,l=s(this);return c.open({btn:["确认","取消"],shadeClose:!0,title:"编辑超链接",content:(t=s(this),a={href:t.attr("href")||"",target:t.attr("target")||"",title:t.attr("title")||""},u(r).render(a)),area:["500px","auto"],yes:function(e,t){var a=t.find("[name=target]").val(),o=t.find("[name=title]").val(),n=t.find("[name=href]").val();l.removeAttr("target").removeAttr("title"),a&&l.attr("target",a),o&&l.attr("title",o),l.attr("href",n),c.close(e)}}),!1}),s(window).on("touchend",function(e){var t=n.is(e.target)||0<n.has(e.target).length,a=o.getCurrentRange();a&&a.startContainer===a.endContainer&&a.startOffset===a.endOffset&&!t||(o.saveSelection(),o.updateToolbar(n,i,l))})}n.prototype.updateToolbar=function(e,t,o){o.activeToolbarClass&&s(o.toolbarSelector).find(t).each(function(){var e=s(this),t=e.data(o.commandRole).split(" "),a=t[0];1<t.length&&document.queryCommandEnabled(a)&&document.queryCommandValue(a)===t[1]?e.addClass(o.activeToolbarClass):1===t.length&&document.queryCommandEnabled(a)&&document.queryCommandState(a)?e.addClass(o.activeToolbarClass):e.removeClass(o.activeToolbarClass)})},n.prototype.execCommand=function(e,t){var a=e.split(" "),o=a.shift(),n=a.join(" ")+(t||""),l=e.split("-");try{this.doc.execCommand("styleWithCSS",!1,!0)}catch(e){}1===l.length?this.doc.execCommand(o,!1,n):"format"===l[0]&&2===l.length&&this.doc.execCommand("formatBlock",!1,l[1]),this.editor.trigger("change"),this.updateToolbar(this.editor,this.toolbarBtnSelector,this.options)},n.prototype.bindHotkeys=function(a,e,t){var o=this;s.each(e.hotKeys,function(e,t){t&&s(a).keydown(e,function(e){a.attr("contenteditable")&&s(a).is(":visible")&&(e.preventDefault(),e.stopPropagation(),o.execCommand(t,null))}).keyup(e,function(e){a.attr("contenteditable")&&s(a).is(":visible")&&(e.preventDefault(),e.stopPropagation())})}),a.keyup(function(){a.trigger("change")})},n.prototype.getCurrentRange=function(){var e=void 0,t=void 0;return window.getSelection?(e=window.getSelection()).getRangeAt&&e.rangeCount&&(t=e.getRangeAt(0)):document.selection&&(t=document.selection.createRange()),t},n.prototype.saveSelection=function(){this.selectedRange=this.getCurrentRange()},n.prototype.restoreSelection=function(){var e=void 0;if(window.getSelection||document.createRange){if(e=window.getSelection(),this.selectedRange){try{e.removeAllRanges()}catch(e){document.body.createTextRange().select(),document.selection.empty()}e.addRange(this.selectedRange)}}else document.selection&&this.selectedRange&&this.selectedRange.select()},n.prototype.markSelection=function(e,t){this.restoreSelection(),this.doc.queryCommandSupported("hiliteColor")&&this.doc.execCommand("hiliteColor",!1,e||"transparent"),this.saveSelection()},n.prototype.bindToolbar=function(t,e,a,o){var n=this;e.find(o).click(function(){n.restoreSelection(),t.focus(),n.execCommand(s(this).data(a.commandRole),null),n.saveSelection()}),e.find("[data-toggle=dropdown]").on("click",function(){n.markSelection(a.selectionColor,a)}),e.on("hide.bs.dropdown",function(){n.markSelection(!1,a)}),e.find("input[type=text][data-"+a.commandRole+"]").on("webkitspeechchange change",function(){var e=this.value;this.value="",n.restoreSelection(),""===window.getSelection().toString().trim()&&e&&(n.editor.append("<span>"+e+"</span>"),function(e){if(window.getSelection&&document.createRange){var t=window.getSelection(),a=document.createRange();a.selectNodeContents(e),t.removeAllRanges(),t.addRange(a)}else if(document.selection&&document.body.createTextRange){var o=document.body.createTextRange();o.moveToElementText(e),o.select()}}(s("span:last",n.editor)[0])),e&&(t.focus(),n.execCommand(s(this).data(a.commandRole),e)),n.saveSelection()}).on("blur",function(){n.markSelection(!1,a)})},s.fn.wysiwyg=function(e,t){var a="wulawysiwyg";if(e===Object(e)||!e){var o=this.each(function(){s(this).data(a)||s(this).data(a,new n(this,e))});return 1===this.length?s(this).data(a):o}if(1===this.length)try{return s(this).data(a)}catch(e){}return null},s.hotkeys={version:"0.8",specialKeys:{8:"backspace",9:"tab",10:"return",13:"return",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scroll",186:";",191:"/",220:"\\",222:"'",224:"meta"},shiftNums:{"`":"~",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")","-":"_","=":"+",";":": ","'":'"',",":"<",".":">","/":"?","\\":"|"}},s.each(["keydown","keyup","keypress"],function(){s.event.special[this]={add:t}}),e("wysiwyg",n)});