var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};layui.define(["jquery","layer","toastr"],function(exports){var $=layui.$,layer=layui.layer,WulaUI=function(){var t=layui.data("wulaui");this.config=$.extend({},{base:"/",assets:"/assets/",medias:[],groups:{char:[],prefix:[]},ids:{}},t.config)},getParams=function(t,e){var a=t.data(e)||t.attr(e);if(a&&"string"==typeof a)try{return new Function("return {"+a+"}")()}catch(t){return{}}return a};WulaUI.prototype.map=function(){this.elements=[],this.size=function(){return this.elements.length},this.isEmpty=function(){return this.elements.length<1},this.clear=function(){delete this.elements,this.elements=[]},this.put=function(t,e){this.remove(t),this.elements.push({key:t,value:e})},this.remove=function(t){try{for(var e=0;e<this.elements.length;e++)if(this.elements[e].key===t)return this.elements.splice(e,1),!0}catch(t){return!1}return!1},this.get=function(t){try{for(var e=0;e<this.elements.length;e++)if(this.elements[e].key===t)return this.elements[e].value}catch(t){return null}},this.join=function(t){t=t||",";var e=[],a=[];try{for(var i=0;i<this.elements.length;i++)e[i]=this.elements[i].key,a[i]=this.elements[i].value}catch(t){return{keys:"",values:""}}return{keys:e.join(t),values:a.join(t)}},this.element=function(t){return t<0||t>=this.elements.length?null:this.elements[t]},this.contains=function(t){try{for(var e=0;e<this.elements.length;e++)if(this.elements[e].key===t)return!0}catch(t){return!1}return!1},this.values=function(){for(var t=[],e=0;e<this.elements.length;e++)t.push(this.elements[e].value);return t},this.keys=function(){for(var t=[],e=0;e<this.elements.length;e++)t.push(this.elements[e].key);return t}},WulaUI.prototype.toast=top.global&&top.global.toast?top.global.toast:layui.toastr,WulaUI.prototype.layer=top.global&&top.global.layer?top.global.layer:layui.layer,WulaUI.prototype.app=function(t){if("string"==typeof t){var e=this.config,a=t.split("/");if(a[0].match(/^([~!@#%\^&\*])(.+)$/)){var i=RegExp.$2,r=RegExp.$1;if(e.ids&&e.ids[i]&&(i=e.ids[i]),e.groups&&e.groups.char)for(var n=0;n<e.groups.char.length;n++)if(e.groups.char[n]===r){r=e.groups.prefix[n];break}a[0]=r+i}else{var o=a[0];e.ids&&e.ids[o]&&(o=e.ids[o],a[0]=o)}a[0]=e.base+a[0],t=a.join("/")}return t},WulaUI.prototype.media=function(t){if(/^(\/|https?:\/\/).+/.test(t))return t;if(this.config.medias){var e=this.config.medias;return e[parseInt(200*Math.random())%e.length]+t}return this.config.base+t},WulaUI.prototype.assets=function(t){return/^(\/|https?:\/\/).+/.test(t)?t:this.config.assets+t},WulaUI.prototype.base=function(t){return/^(\/|https?:\/\/).+/.test(t)?t:this.config.base+t},WulaUI.prototype.open=function(t){top.global&&top.global.menu&&top.global.menu.menuOpen(t)},WulaUI.prototype.init=function(t){(t=t||$("body .wulaui")).hasClass("wulaui")?t.trigger("wulaui.widgets.init"):t.find(".wulaui").trigger("wulaui.widgets.init")},WulaUI.prototype.destroy=function(t){0!==t.length&&(t.hasClass("wulaui")?t.triggerHandler("wulaui.widgets.destroy"):t.find(".wulaui").each(function(){$(this).triggerHandler("wulaui.widgets.destroy")}))},WulaUI.prototype.dialog=function(e,a){var i=["auto","auto"],t=!1,r=0;if(a){var n=$.Event("before.dialog");n.options=e,a.trigger(n)}2===parseInt(e.type)?e.data&&(e.content=e.content+(0<=e.content.indexOf("?")?"&":"?")+e.data):"ajax"===e.type?(t=!0,e.data&&(e.content=e.content+(0<=e.content.indexOf("?")?"&":"?")+e.data)):e.content=$(e.content);var o=$(window).height()-50,s=$(window).width()-50;""===e.area&&"auto,auto"===e.area||(i=e.area.split(","),s<parseInt(i[0])&&(i[0]=s+"px"),o<parseInt(i[1])&&(i[1]=o+"px"));if(e.area&&("auto"===i[0]&&(e.maxWidth=s+"px"),"auto"===i[1]&&(e.maxHeight=o+"px")),t){if(e.type=1,e.success=function(t){wulaui.init(t),e.$content=t},e.end){var l=e.end;e.end=function(){l(),wulaui.destroy(e.$content),a&&a.triggerHandler("close.dialog")}}else e.end=function(){wulaui.destroy(e.$content),a&&a.triggerHandler("close.dialog")};wulaui.ajax.ajax(e.content,{element:a||$("body"),dataType:"html",method:"get"}).done(function(t){e.type=1,e.content=t,e.area?(e.area=i,r=layer.open(e)):(r=layer.open(e),layer.full(r)),a&&a.data("dialogId",r)})}else a&&(e.end=function(){a.triggerHandler("close.dialog")}),e.area?(e.area=i,r=layer.open(e)):(r=layer.open(e),layer.full(r)),a&&a.data("dialogId",r)},WulaUI.prototype.iframeDialog=function(t,e,a,i){var r={type:2,content:t,title:e||"窗口",area:a};this.dialog(r,i)},WulaUI.prototype.params=getParams,WulaUI.prototype.format=function(a,t){return 1===arguments.length?function(){var t=$.makeArray(arguments);return t.unshift(a),WulaUI.prototype.format(t)}:(void 0===t||(2<arguments.length&&t.constructor!==Array&&(t=$.makeArray(arguments).slice(1)),t.constructor!==Array&&(t=[t]),$.each(t,function(t,e){a=a.replace(new RegExp("\\{"+t+"\\}","g"),function(){return e})})),a)};var wulaui=new WulaUI,Kd,Md,Nd,Od,Pd,Ij,Jj,Kj,ok,rk,Pk,Qk,Gm,Hm,on,Kn,Ln,Vn,Wn,Xn;$("body").on("click","[data-tab]",function(){var t=$(this),e=$.Event("ajax.before");if(t.trigger(e),e.isDefaultPrevented())return!1;var a=t.attr("href")||t.data("url"),i=t.attr("title")||t.data("title")||t.text()||"新窗口",r={href:a,icon:t.data("tab")||"&#xe621;",cls:t.data("cls")||null,title:i};return a&&wulaui.open(r),t.is("a")&&t.closest("ul").is(".dropdown-menu")&&t.closest("ul").closest(".open").removeClass("open"),!1}).on("click","[data-dialog]",function(){try{var t=$(this),e={type:t.data("dialog")||2,title:t.attr("title")||t.data("title")||t.text(),content:t.attr("href")||t.data("url"),area:""},a=getParams(t,"params"),i=t.data("area");e=$.extend({},e,a),i&&(e.area=i),wulaui.dialog(e,t)}catch(t){console.log(t)}return!1}).on("click",'[data-toggle^="class"]',function(t){t&&t.preventDefault();var e=$(t.target),a=void 0,i=void 0,r=void 0,n=void 0,o=void 0;!e.data("toggle")&&(e=e.closest('[data-toggle^="class"]')),a=e.data().toggle,i=e.data("target")||e.attr("href"),a&&(r=a.split(":")[1])&&(n=r.split(",")),i&&(o=i.split(",")),o&&o.length&&$.each(o,function(t,e){"#"!==e&&$(e).toggleClass(n[t])}),e.toggleClass("active")}).on("focus","[data-expend]",function(){var t=$(this),e=t.data("owidth")||t.width(),a=t.data("expend");t.data("owidth",e),a&&t.width(a)}).on("blur","[data-expend]",function(){var t=$(this),e=t.data("owidth");e&&t.width(e)}).on("click",".has-form a.btn-more",function(){$(this).closest("form").find(".more").toggle()}),function(b,d,y){"use strict";var t=b.ajax,w=y.toast;b.ajax=function(a,i){return t(a,i).done(function(t){var e=i||a;"abort"!==e.mode&&("json"===e.dataType?(r(t),o(t,e)):"update"===e.action&&e.target&&o({code:200,action:"update",target:e.target,args:{content:t}},e))})},b(document).ajaxSend(function(t,e,a){if("abort"!==a.mode&&a.element){a.element.data("ajaxSending",!0);var i=new b.Event("ajax.send");i.element=a.element,a.element.trigger(i,[a,e]),e.setRequestHeader("X-AJAX-TYPE",a.dataType)}}),b(document).ajaxError(function(t,e,a,i){if("abort"!==a.mode&&a.element){var r=b.Event("ajax.error");if(a.element.trigger(r,[a,i,e]),!r.isDefaultPrevented())switch(e.status){case 500:n(e,"服务器端500错误");break;case 200:n(e,"数据类型转换出错");break;case 401:window.layui&&layui.wulaAuthPage?top.location=layui.wulaAuthPage:(s(e),b(document).trigger("wula.need.login"));break;case 403:s(e),b(document).trigger("wula.perm.denied");break;case 404:s(e),b(document).trigger("wula.page.404");break;case 422:try{o(b.parseJSON(e.responseText))}catch(r){}break;default:s(e)}}}),b(document).ajaxSuccess(function(t,e,a,i){"abort"!==a.mode&&a.element&&a.element.trigger("ajax.success",[i,a,e])}),b(document).ajaxComplete(function(t,e,a){if("abort"!==a.mode&&a.element){a.element.data("ajaxSending",!1),a.element.hasClass("data-loading-text")&&a.element.button("reset");var i=new b.Event("ajax.done");i.element=a.element,a.element.trigger(i,[a,e])}}),b.ajaxSetup({cache:!1,timeout:3e5});var x=function(e,t,a){var i=b.extend({},{icon:3,title:"请确认",loading:!1},a||{});e.dataType||(e.dataType="json"),d.confirm(t||"亲，你确定要这么干吗？",i,function(t){d.close(t),i.loading?(t=d.load(2),b.ajax(e).always(function(){d.close(t)})):b.ajax(e)})},j=function(t,e){t.type="ajax",y.dialog(t,e)},e=function(t){t.preventDefault(),t.stopPropagation();var e=b(this);if(e.is("form")&&0<e.find("[data-uploader].pendup").length)return e.find("[data-uploader].pendup").each(function(t,e){b(e).data("uploaderObj").uploader.start()}),!1;if(e.is("a")&&e.closest("ul").is(".dropdown-menu")&&e.closest("ul").closest(".open").removeClass("open"),e.data("ajaxSending"))return!1;var a=b.Event("ajax.before");if((a.element=e).trigger(a),a.isDefaultPrevented())return!1;var i=b.Event("ajax.validate");if((i.element=e).trigger(i),!i.isDefaultPrevented()){var r=b.Event("ajax.build");r.opts=b.extend({element:e,data:[]},e.data()||{}),r.opts.url=r.opts.url||e.attr("href")||e.attr("action")||e.data("url")||"";var n=r.opts.ajax||"get.json";delete r.opts.ajax;var o=n.split(".");r.opts.dataType=2===o.length?o[1]:"json";var s=e.attr("method")||(o[0]?o[0]:null)||"GET";r.opts.method=s.toUpperCase();var l=e.data("timeout");if(r.opts.timeout=void 0===l?12e4:parseInt(l,10),"UPDATE"===r.opts.method)r.opts.method="GET",r.opts.dataType="html",r.opts.action="update",r.opts.target=e.attr("target")||e.data("target");else if("DIALOG"===r.opts.method){r.opts.method="GET",r.opts.dataType="html",r.opts.action="dialog",r.opts.title=e.attr("title")||e.data("title")||!1,r.opts.dialog=b.extend({},y.params(e,"params")),r.opts.dialog.type=2===o.length?2:"ajax";var d=b.Event("build.dialog");d.btn=null,e.trigger(d),d.btn&&(r.opts.btn=d.btn)}var u=e.data("grp");if(u){var p=[],h=e.data("arg")||"ids";if(b(u).each(function(t,e){p.push(b(e).val())}),0===p.length){var c=e.data("warn")||"请选择要处理的数据";return void w.warning(c)}p=p.join(","),r.opts.data.push({name:h,value:p})}if(e.is("input,select,textarea")&&r.opts.data.push({name:"value",value:e.val()}),e.is("[data-toggle]")&&r.opts.data.push({name:"value",value:e.hasClass("active")?0:1}),e.trigger(r),!r.isDefaultPrevented())if("update"===r.opts.action&&b(r.opts.target).data("loaderObj"))b(r.opts.target).data("load",r.opts.url).data("loaderObj").reload(null,void 0!==e.data("force"));else if("dialog"===r.opts.action){var f=b.extend({},{content:r.opts.url,title:r.opts.title,area:r.opts.area||"",btn:r.opts.btn||null,data:r.opts.data},r.opts.dialog);j(f,e)}else if(void 0!==e.data("confirm")){var g=e.data("confirm"),m=parseInt(e.data("auto"),0)||0,v={icon:3,loading:void 0!==e.data("loading"),title:e.attr("title")||e.data("title")||"请确认"};0<m&&(v.time=m),x(r.opts,g,v)}else b.ajax(r.opts)}return!1},i=function(t){var e=t.responseText||t.statusText;if(t.getResponseHeader("ajax"))try{return b.parseJSON(e).message}catch(t){e="数据转换异常"}else e&&0<e.indexOf("</body>")?e=(e=e.substr(0,e.indexOf("</body>"))).substr(e.indexOf(">",e.indexOf("<body"))+1):"error"===t.statusText&&(e="出错啦");return e},n=function(t,e){var a=i(t);d.full(d.open({type:0,title:e,content:a,btn:null}))},r=function(t){if(t.message){var e=!0;switch("alert"===t.style&&(e=!1),t.code){case 500:e?w.error(t.message):d.alert(t.message,{icon:5,title:null,btn:null,shadeClose:!0});break;case 400:e?w.warning(t.message):d.alert(t.message,{icon:2,title:null,btn:null,shadeClose:!0});break;case 300:e?w.info(t.message):d.alert(t.message,{icon:1,title:null,btn:null,shadeClose:!0});break;case 200:default:e?w.success(t.message):d.alert(t.message,{icon:6,title:null,btn:null,shadeClose:!0})}}},o=function(t,r){var n=void 0,e=void 0;switch(t.action){case"update":"parent"===(e=u(t.target))[0]&&parent.ajaxActions?parent.ajaxActions.update(e[1],t):"top"===e[0]&&top.ajaxActions?top.ajaxActions.update(e[1],t):ajaxActions.update(e[1],t);break;case"reload":if(!t.target||"document"===t.target||"top"===t.target)return void("top"===t.target?top.location.reload(!0):location.reload(!0));try{"parent"===(e=u(t.target))[0]&&parent.ajaxActions?parent.ajaxActions.reload(e[1]):"top"===e[0]&&top.ajaxActions?top.ajaxActions.reload(e[1]):ajaxActions.reload(e[1])}catch(t){}break;case"click":"parent"===(e=u(t.target))[0]&&parent.ajaxActions?parent.ajaxActions.click(e[1]):"top"===e[0]&&top.ajaxActions?top.ajaxActions.click(e[1]):ajaxActions.click(e[1]);break;case"redirect":var a=t.target;a&&(window.location.hash&&t.hash?window.location.href=a+window.location.hash:window.location.href=a);break;case"dialog":j(t.args,r.element);break;case"validate":n=b('form[name="'+t.target+'"]');var i=t.args,o=n.data("validateObj");o&&o.showErrors(i)}if(r&&r.element&&t.code&&t.code<=300){var s=r.element.data("ajaxDone");if(s){var l=s.split(";");b.each(l,function(t,e){var a=e.split(":");switch(a[0]){case"close":if(1<a.length)if("parent"===a[1]&&parent.layer)parent.layer.close(parent.layer.index);else if("top"===a[1]&&top.layer)top.layer.close(top.layer.index);else{var i=r.element.data("dialogId");i?d.close(i):d.close(d.index)}break;case"show":1<a.length&&b(a[1]).removeClass("hidden").show();break;case"hide":1<a.length&&b(a[1]).addClass("hidden").hide();break;case"click":(n=b(a[1])).length&&n.click();break;case"reload":b(a[1]).each(function(t,e){var a=b(e).data("loaderObj");a&&a.reload()})}})}}},s=function(t){var e=i(t);w.error(e)},u=function(t){if("string"==typeof t){var e=t.split(":");if(2===e.length)return e}return["me",t]};b("body").on("click","a[data-ajax]",e).on("click","button[data-ajax]",e).on("submit","form[data-ajax]",e).on("change","select[data-ajax]",e).on("change","input[data-ajax]",e).on("change","textarea[data-ajax]",e).on("ajax.send","[data-loading]",function(t){t.stopPropagation();var e=t.element;void 0!==e.data("loading")&&e.data("loading",d.load(2))}).on("ajax.done","[data-loading]",function(t){t.stopPropagation();var e=t.element;void 0!==e.data("loading")&&d.close(e.data("loading"))}).on("ajax.success","[data-toggle]",function(){b(this).toggleClass("active")}),y.ajax={confirm:x,dialog:j,ajax:b.ajax,async:!0,sync:function(){return this.async=!1,this},get:function(t,e,a){var i={dataType:a||"json",method:"GET",data:e||{},async:!!this.async};return this.async=!0,b.ajax(t,i)},post:function(t,e,a){var i={dataType:a||"json",method:"POST",data:e||{},async:!!this.async};return this.async=!0,b.ajax(t,i)}},window.ajaxActions={reload:function(t){if("document"!==t){if((t=b(t)).length){var e=t.data("loaderObj");e&&e.reload(null,!0)}}else location.reload()},update:function(t,e){if((t=b(t)).length&&e.args&&e.args.content){if(e.args.append){var a=b(e.args.content);t.append(a),y.init(a)}else y.destroy(t),t.empty().html(e.args.content),y.init(t);t.trigger("content.updated")}},click:function(t){(t=b(t)).length&&(/^#.+/.test(t.attr("href"))?window.location.hash=t.attr("href"):t.click())}}}($,layer,wulaui),function(n,t){var i=wulaui.ajax;n.fn.wulauiLoad=function(){return n(this).each(function(t,e){var a=n(e);a.data("loaderObj")||a.data("loaderObj",new r(a))})},n.fn.reload=function(i,r){return n(this).each(function(t,e){var a=n(e).data("loaderObj");a&&(i&&n(e).data("load",i),a.reload(null,r))})};var r=function(t){this.autoload=void 0!==t.data("auto"),this.lazy=void 0!==t.data("lazy"),this.element=t,this.autoload&&this.reload()};r.prototype.reload=function(t,e){a.apply(this,[e])};var a=function(t){var e=this.url?this.url:"";if(this.url=this.element.data("load")||this.element.attr("href"),this.url&&(t||!this.lazy||e!==this.url)){var a=n.Event("ajax.build");a.opts=n.extend({element:this.element},this.element.data()||{}),a.opts.url=this.url,a.opts.method="GET",a.opts.action="update",a.opts.dataType="html",a.opts.target=this.element,this.element.trigger(a),a.isDefaultPrevented()||i.ajax(a.opts)}};n("body").on("wulaui.widgets.init",".wulaui",function(t){t.stopPropagation(),n(this).find("[data-load]").wulauiLoad()})}($),Kd=$,Md=wulaui,Nd={required:function(t,e,a){if(!this.depend(a,e))return"dependency-mismatch";if("select"!==e.nodeName.toLowerCase())return this.checkable(e)?0<this.getLength(t,e):0<t.length;var i=Kd(e).val();return i&&0<i.length},email:function(t,e){return this.optional(e)||/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/.test(t)},url:function(t,e){return this.optional(e)||/^(?:(?:(?:https?|ftp):)?\/\/)(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,})).?)(?::\d{2,5})?(?:[/?#]\S*)?$/i.test(t)},date:function(t,e){return this.optional(e)||/^\d{4}[\/\-](0?[1-9]|1[012])[\/\-](0?[1-9]|[12][0-9]|3[01])$/.test(t)},number:function(t,e){return this.optional(e)||/^(?:-?\d+|-?\d{1,3}(?:,\d{3})+)?(?:\.\d+)?$/.test(t)},digits:function(t,e){return this.optional(e)||/^(0|[1-9]\d*)$/.test(t)},minlength:function(t,e,a){var i=Kd.isArray(t)?t.length:this.getLength(t,e);return this.optional(e)||a<=i},maxlength:function(t,e,a){var i=Kd.isArray(t)?t.length:this.getLength(t,e);return this.optional(e)||i<=a},rangelength:function(t,e,a){var i=Kd.isArray(t)?t.length:this.getLength(t,e);return this.optional(e)||i>=a[0]&&i<=a[1]},min:function(t,e,a){return this.optional(e)||a<=t},max:function(t,e,a){return this.optional(e)||t<=a},range:function(t,e,a){return this.optional(e)||t>=a[0]&&t<=a[1]},step:function(t,e,a){var i=Kd(e).attr("type"),r="Step attribute on input type "+i+" is not supported.",n=new RegExp("\\b"+i+"\\b"),o=i&&!n.test(["text","number","range"].join()),s=function(t){var e=(""+t).match(/(?:\.(\d+))?$/);return e&&e[1]?e[1].length:0},l=function(t){return Math.round(t*Math.pow(10,u))},d=!0,u=void 0;if(o)throw new Error(r);return u=s(a),(s(t)>u||l(t)%l(a)!=0)&&(d=!1),this.optional(e)||d},equalTo:function(t,e,a){return t===Kd(a).val()},passwd:function(t,e,a){if(this.optional(e))return!0;switch(a){case"2":return/[a-z]/i.test(t)&&/\d/.test(t)&&/[^a-z\d]/i.test(t);case"3":return/[A-Z]/.test(t)&&/[a-z]/.test(t)&&/\d/.test(t)&&/[^a-z\d]/i.test(t);case"1":default:return/[a-z]/i.test(t)&&/\d/.test(t)}},pattern:function(t,e,a){return!!this.optional(e)||("string"==typeof a?new RegExp("^(?:"+a+")$").test(t):a.test(t))},ip:function(t,e){return this.optional(e)||/^(25[0-5]|2[0-4]\d|[01]?\d\d?)\.(25[0-5]|2[0-4]\d|[01]?\d\d?)\.(25[0-5]|2[0-4]\d|[01]?\d\d?)\.(25[0-5]|2[0-4]\d|[01]?\d\d?)$/i.test(t)},phone:function(t,e){return this.optional(e)||/^1[34578]\d{9}$/.test(t)}},Od={required:"这是必填字段",email:"请输入合法的邮箱地址",url:"请输入合法的URL",date:"请输入合法的日期",number:"请输入有效的数字",digits:"只能输入数字",equalTo:"你的输入不相同",maxlength:"最多可以输入{0}个字符",minlength:"最少要输入{0}个字符",rangelength:"请输入长度在{0}到{1}之间的字符串",range:"请输入范围在{0}到{1}之间的数值",max:"请输入不大于{0}的数值",min:"请输入不大于{0}的数值",step:"请输入{0}的倍数",passwd:"你输入的密码不够强",pattern:"请输入合法的格式",ip:"请输入合法的IP地址",phone:"请输入有效的手机号"},Pd=function(t){this.form=t;var e=this,a=new Kd.Event("form.init.rule");a.form=this,t.trigger(a).on("ajax.before",function(){return e.validate()}).on("blur","[data-verify]:not(readonly):not(ignore)",function(){e.check(Kd(this),this)})},Kd.extend(Pd,{prototype:{validate:function(){var a=this,i=0,r=0;return this.form.find("[data-verify]:not(readonly):not([ignore])").each(function(t,e){!0===a.check(Kd(e),e)&&i++,r++}),i===r},check:function(t,e){var a=t.data("wulauiValidRules")||this.parseRules(t)||!1,i=t.data("wulauiValidMsgs")||{},r=this.elementValue(e),n=void 0,o=void 0,s=void 0,l=this.createErrorEle(t,e);if(a){var d=Kd.map(a,function(t,e){return e}).length;for(s in a){n={method:s,parameters:a[s]};try{if("dependency-mismatch"===(o=Nd[s].call(this,r,e,n.parameters))&&1===d)continue;if(!o)return l.html(this.getMsg(n,i)).show(),!1}catch(t){console.log("Exception occurred when checking element '"+(e.id||e.name)+"', check the '"+n.method+"' method.",t)}}this.objectLength(a)&&l.hide()}return!0},parseRules:function(t){var e=Md.params(t,"verify");return!!e&&(t.data("wulauiValidRules",e),t.data("wulauiValidMsgs",Md.params(t,"verifyMsg")),e)},getMsg:function(t,e){var a=/\$?\{(\d+)\}/g,i=void 0;return"function"==typeof(i=e[t.method]?e[t.method]:Od[t.method]?Od[t.method]:"此项填写不合法")?i=i.call(this,t.parameters):a.test(i)&&(i=Md.format(i.replace(a,"{$1}"),t.parameters)),i},checkable:function(t){return/radio|checkbox/i.test(t.type)},depend:function(t,e){var a=void 0===t?"undefined":void 0===t?"undefined":_typeof(t);return!this.dependTypes[a]||this.dependTypes[a](t,e)},dependTypes:{boolean:function(t){return t},string:function(t,e){return!!Kd(t,e.form).length},function:function(t,e){return t(e)}},optional:function(t){var e=this.elementValue(t);return!Nd.required.call(this,e,t)&&"dependency-mismatch"},objectLength:function(t){var e=0,a=void 0;for(a in t)t[a]&&e++;return e},escapeCssMeta:function(t){return t.replace(/([\\!"#$%&'()*+,./:;<=>?@\[\]^`{|}~])/g,"\\$1")},findByName:function(t){return this.form.find("[name='"+this.escapeCssMeta(t)+"']")},createErrorEle:function(t){var e=t.parent().find("span.valid-error");return 0<e.length||(e=Kd('<span class="valid-error"/>')).appendTo(t.parent()),e},getLength:function(t,e){switch(e.nodeName.toLowerCase()){case"select":return Kd("option:selected",e).length;case"input":if(this.checkable(e))return this.findByName(e.name).filter(":checked").length}return t.length},elementValue:function(t){var e=Kd(t),a=t.type.toLowerCase(),i=void 0,r=void 0;if("radio"!==a&&"checkbox"!==a)return"number"===a&&void 0!==t.validity?t.validity.badInput?"NaN":e.val():(i=e.val(),"file"===a?"C:\\fakepath\\"===i.substr(0,12)?i.substr(12):0<=(r=i.lastIndexOf("\\"))?i.substr(r+1):i:"string"==typeof i?i.replace(/\r/g,""):i);var n=this.findByName(t.name);if(1<n.length){var o=[];return n.filter(":checked").each(function(t,e){o.push(Kd(e).val())}),o}return n.filter(":checked").val()},showErrors:function(t){var a=this;Kd.each(t,function(t,e){a.createErrorEle(Kd('[name="'+a.escapeCssMeta(t)+'"]:first')).html(e).show()})}}}),Kd.fn.wulaform=function(){var t=Kd(this);return t.length&&t.each(function(){var t=Kd(this);t.data("validateObj")||t.data("validateObj",new Pd(t))}),t},Md.validator={method:function(t,e,a){Nd[t]=e,Od[t]=void 0!==a?a:"此项填写不合法"},validate:function(t,e){var a=Kd(t).data("validateObj");a&&(e?a.showErrors(e):a.validate())},get:function(t){var e=Kd(t),a=e.data("validateObj");return a||(e.wulaform(),a=e.data("validateObj")),a}},Kd("body").on("ajax.build","form[data-ajax]",function(t){t.stopPropagation(),t.opts.data=Kd(this).serializeArray()}).on("wulaui.widgets.init",".wulaui",function(t){t.stopPropagation(),Kd(this).find("form[data-verify]").wulaform()}),function($){var prepareValidateRule=function prepareValidateRule(rules){if(rules=rules||{},"object"!==(void 0===rules?"undefined":_typeof(rules)))try{rules=$.parseJSON(rules)}catch(t){rules={},console.log(t.message)}if(rules.rules)for(var i in rules.rules)for(var j in rules.rules[i])"pattern"===j&&(eval("var rule = "+rules.rules[i][j]+";"),rules.rules[i][j]=rule);return rules},errorPlacement=function(t,e){if(e.is("[type=checkbox]")||e.is("[type=radio]")){var a=e.closest("div");(a.is(".checkbox")||a.is(".radio"))&&(a=a.parent().closest("div")),a.children("span").length?t.insertBefore(a.children("span")):t.appendTo(a)}else{var i=$.Event("form.placement");e.trigger(i,[t,e]),i.isDefaultPrevented()||t.insertAfter(e)}},Validator=function(t){this.form=t,this.rules=prepareValidateRule(t.data("validate")),this.rules.errorPlacement=errorPlacement,this.rules.onsubmit=!1,this.rules.ignoreTitle=!0,this.rules.errorClass="parsley-error",this.rules.validClass="parsley-success",this.rules.wrapper="ul",this.rules.wrapperClass="parsley-error-list",this.rules.errorElement="li";var e=new $.Event("form.init.rule");(e.form=this).form.trigger(e),this.validator=t.validate(this.rules);var a=this;t.on("ajax.validate",function(){return a.validate()});t.closest(".wulaui").on("wulaui.widgets.destroy",function t(){a.destroy(),a.form.closest(".wulaui").off("wulaui.widgets.destroy",t)})};Validator.prototype.validate=function(t){if(!this.validator)return!1;if(this.validator.form()){if(t)return this.validator.showErrors(t),!1;if(this.validator.pendingRequest)return!(this.validator.formSubmitted=!0)}return this.form.valid()},Validator.prototype.showErrors=function(t){this.validate(t)},Validator.prototype.destroy=function(){this.validator&&(this.validator.destroy(),this.validator=null,this.rules=null)},$.fn.wulavalidate=function(){var t=$(this);return t.length&&($.validator.defaults.ignore=".ignore",t.each(function(){var t=$(this);t.data("validateObj")||t.data("validateObj",new Validator(t))})),t},$("body").on("wulaui.widgets.init",".wulaui",function(t){t.stopPropagation();var e=$(this).find("form[data-validate]");0<e.length&&layui.use(["validate"],function(){e.wulavalidate()})})}($),function(h,d){var o=function(t){var a=this;(this.table=t,this.parent=t.parent(),this.data={},this.isTree=void 0!==t.data("tree"),this.hideHead=void 0!==t.data("hh"),this.autoExpend=void 0!==t.data("expend"),this.autoLoad=void 0!==t.data("auto"),this.noHover=void 0!==t.data("noHover"),this.source=t.data("table"),this.id=t.attr("id"),this.currentTreeNode=null,this.folderOpenIcon=t.data("folderIcon1")||"fa fa-minus-circle",this.folderCloseIcon=t.data("folderIcon2")||"fa fa-plus-circle",this.leafIcon=t.data("leafIcon")||"",this.noHover?t.addClass("table"):t.addClass("table table-hover"),t.data("tableObj",this),t.data("formTarget",this),t.data("pagerTarget",this),t.data("loaderObj",this),this.initSorter(),this.id)?0===h('form[data-table-form="#'+this.id+'"]').length&&this.initData():this.initData();this.table.find('th input[type="checkbox"].grp').click(function(){var t=h(this),e=t.prop("checked");a.table.find('td input[type="checkbox"].grp').prop("checked",e),e?a.table.find("tbody tr").addClass("nui-selected"):a.table.find("tbody tr").removeClass("nui-selected"),a.table.find('th input[type="checkbox"].grp').not(t).prop("checked",e)}),this.isTree?(0<this.table.find("tbody tr").length&&this.initTree(),this.table.on("click","tbody tr > td:first-child span.tt-folder",function(){var t=h(this),e=a.currentTreeNode=t.parent().parent();void 0!==e.data("parent")&&(t.hasClass("node-open")?(t.removeClass(a.folderOpenIcon).removeClass("node-open").addClass(a.folderCloseIcon),i(e,a)):(t.removeClass(a.folderCloseIcon).addClass("node-open").addClass(a.folderOpenIcon),e.data("loaded")?c(e,a):a.reload()))})):this.table.on("click","tbody tr > td:first-child span.tt-folder",function(){var t=h(this),e=t.parent().parent().next();t.hasClass("node-open")?(t.removeClass(a.folderOpenIcon).removeClass("node-open").addClass(a.folderCloseIcon),e.addClass("hidden").hide()):(t.removeClass(a.folderCloseIcon).addClass("node-open").addClass(a.folderOpenIcon),e.removeClass("hidden").show())}),this.hideHead&&(this.table.find("thead").hide(),this.table.find("tfoot").hide()),this.table.trigger("wulaui.table.init")};o.prototype.initData=function(){if(this.autoLoad){var t=this,e=10,a=h('div[data-table-pager="#'+t.id+'"]');if(this.data.cp?1===a.length&&(a.data("limit",this.data.limit),a.find("select").val(this.data.limit),this.pagerCtl&&(this.pagerCtl.limit=this.data.limit,this.pagerCtl.current=this.data.cp)):(1===a.length&&a.data("limit")&&(e=parseInt(a.data("limit"),10)),this.data.cp=1,this.data.limit=e),this.data.sf){t.table.find("div.sorthd i").removeClass("fa-sort-up fa-sort-down");var i=t.table.find("div[data-field='"+this.data.sf+"']");"d"===this.data.dir?(i.data("dir","a"),i.find("i").addClass("fa-sort-down")):(i.data("dir","d"),i.find("i").addClass("fa-sort-up"))}this.inited=!1,0<t.table.parents(".nui-dialog").length?setTimeout(function(){t.reload(),t.inited=!0},200):(this.reload(),this.inited=!0)}else this.isTree||(this.subTr(),this.inited=!0)},o.prototype.initSorter=function(){var d=this.table.attr("data-sort"),u=this;if(this.table.find("th[data-sort]").each(function(t,e){var a=h(e),i=a.attr("data-sort");if(i){var r=i.split(","),n=r.shift(),o="d",s="fa fa-sort pull-right m-t-xs ";0<r.length&&"d"!==(o=r.shift())&&"a"!==o&&(o="d"),d===i&&(u.data.sf=n,o="d"===(u.data.dir=o)?(s+="fa-sort-down text-info","a"):(s+="fa-sort-up text-info","d"));var l='<div class="sorthd" data-field="'+n+'"';l+=' data-dir="'+o+'">'+a.html(),l+='<i class="'+s+'"></i></div>',a.empty().append(h(l)).removeAttr("data-sort")}}),this.table.data("tfoot")){var t=h("<tfoot></tfoot>");this.table.find("thead tr").clone().appendTo(t),this.table.append(t)}var r=this.table.find("div.sorthd");r.click(function(){r.find("i").removeClass("fa-sort-down fa-sort-up text-info");var t=h(this),e=t.data("field"),a=t.data("dir"),i=h("div[data-field='"+e+"']");u.doSort(e,a,function(){"d"===a?(i.data("dir","a"),i.find("i").removeClass("fa-sort-up").addClass("fa-sort-down text-info")):(i.data("dir","d"),i.find("i").removeClass("fa-sort-down").addClass("fa-sort-up text-info"))})})},o.prototype.initTree=function(o){var s=this;o||(o=this.table.find("tbody tr"));var l=0,d="0";null!==s.currentTreeNode&&(l=s.currentTreeNode.data("ttLevel"),d=s.currentTreeNode.attr("rel"));var u="tt-folder",p=s.folderCloseIcon;h.each(o,function(t,e){var a=h(e),i=a.attr("rel");if(!a.data("handleAdded")){var r=o.is('[parent="'+i+'"]');p=a.data("parent")||r?(u="tt-folder",a.attr("data-parent")||a.attr("data-parent","true"),!s.autoExpend||!r&&s.autoLoad?s.folderCloseIcon:s.folderOpenIcon):(u="tt-leaf",s.leafIcon),a.attr("parent")||a.attr("parent",d);var n=a.attr("parent");o.is('[rel="'+n+'"]')?a.css("display","none"):a.css("display","table-row"),a.find("td:first").prepend(h('<span class="'+u+" "+p+'"></span>')),a.find("td:first").prepend(h('<span class="tt-line"></span>')),a.data("handleAdded",!0),a.data("ttLevel",l),a.data("loaded",r)}}),s.autoExpend&&s.table.find("tbody tr[parent='0']").each(function(t,e){c(h(e),s)})},o.prototype.reloadNode=function(t){var i=this;t?(t=(t=""+t).split(","),h.each(t,function(t,e){if(i.currentTreeNode=i.table.find("tr[rel="+e+"]").eq(0),i.currentTreeNode&&i.currentTreeNode.data("loaded")){var a=i.currentTreeNode.find("td:first-child span.tt-folder");i.currentTreeNode.data("loaded",!1),a.hasClass("node-open")&&(r(i.currentTreeNode,i),i.currentTreeNode.find("td:first-child span.tt-folder").removeClass(i.folderOpenIcon).removeClass("node-open").addClass(i.folderCloseIcon),i.reload())}})):(i.currentTreeNode&&(i.currentTreeNode.data("loaded",!1),i.currentTreeNode=null),this.reload())},o.prototype.doPage=function(t,e,a,i){this.data.cp=t,this.currentTreeNode=null,e&&(this.data.limit=e),a&&this.reload(null,i)},o.prototype.doSort=function(t,e,a){this.currentTreeNode=null,this.data.sf=t,this.data.dir=e,this.reload(a)},o.prototype.reload=function(o,t){if(this.source){var s=this,e=[],l=!1;s.searchForm&&(e=s.searchForm.serializeArray()),!t&&this.inited||(e.push({name:"count",value:1}),l=!0),t&&(this.data.cp=1,this.currentTreeNode=null,this.pagerCtl&&(this.pagerCtl.current=1)),e.push({name:"pager[page]",value:this.data.cp}),e.push({name:"pager[size]",value:this.data.limit}),this.data.sf&&(e.push({name:"sort[name]",value:this.data.sf}),this.data.dir?e.push({name:"sort[dir]",value:this.data.dir}):e.push({name:"sort[dir]",value:"d"})),null!==s.currentTreeNode&&(e.push({name:"parentId",value:s.currentTreeNode.attr("rel")}),s.currentTreeNode.find(".tt-folder").addClass("fa-spin")),h.ajax(s.source,{dataType:"html",element:s.table,data:e,method:"get"}).done(function(t){s.table.find('th input[type="checkbox"].grp').prop("checked",!1);var e=(t=h(t)).data("disableTree");if(s.isTree&&!e)if(s.currentTreeNode)t=t.find("tr"),s.initTree(t),s.currentTreeNode.after(t),s.currentTreeNode.data("loaded",!0),s.currentTreeNode.find(".tt-folder").removeClass("fa-spin "+s.folderCloseIcon).addClass(s.folderOpenIcon+" node-open"),c(s.currentTreeNode,s);else{var a=s.table.find("tbody");d.destroy(a),a.remove(),s.table.find("thead").after(t),s.initTree()}else{var i=s.table.find("tbody");d.destroy(i),i.remove(),s.table.find("thead").after(t),s.subTr()}if(h.isFunction(o)&&o(),s.pagerCtl&&h.isFunction(s.pagerCtl.pageIt)){var r=-1;if(l){var n=t.data("total");r=""===n?-1:parseInt(n||0,10)}s.pagerCtl.pageIt(r)}d.init(t)})}},o.prototype.form=function(t){if(!t)return this.searchForm;this.searchForm=t,this.initData()},o.prototype.pager=function(t){if(!t)return this.pagerCtl;this.pagerCtl=t},o.prototype.filter=function(t,e){if(void 0===e)this.table.find("tbody tr").show();else{var a="[data-field-"+t+'="'+e+'"]';this.table.find("tbody tr"+a).show(),this.table.find("tbody tr").not(a).hide()}},o.prototype.subTr=function(){if(!this.isTree){var t=this.table.find("tbody tr[rel]"),e=this.folderCloseIcon;0<t.length&&t.each(function(){h(this).find("td:first").prepend(h('<span class="tt-folder '+e+'"></span>'))})}},h.fn.wulatable=function(r){var n=Array.apply(null,arguments);return n.shift(),h(this).each(function(t,e){var a=h(e);if(a.data("tableObj")){var i=a.data("tableObj");"string"==typeof r&&"function"==typeof i[r]&&i[r].apply(i,n)}else new o(a)})};var c=function r(t,n){var e=t.attr("rel"),a=n.table,o=t.data("ttLevel")+1;t.data("childrenMoved")||(t.after(a.find('[parent="'+e+'"]')),t.data("childrenMoved",!0));var s=10*o+"px";a.find('[parent="'+e+'"]').each(function(t,e){var a=h(e),i=a.find("td:first span.tt-folder");a.data("ttLevel",o),a.find("td:first span.tt-line").css({"margin-left":s}),a.css({display:"table-row"}),i.hasClass("node-open")&&r(a,n)})},i=function i(t,r){var e=t.attr("rel");r.table.find('[parent="'+e+'"]').each(function(t,e){var a=h(e);i(a,r),a.css("display","none")})},r=function i(t,r){var e=t.attr("rel");r.table.find('[parent="'+e+'"]').each(function(t,e){var a=h(e);i(a,r),a.css("display","none").remove()})};h("body").on("wulaui.widgets.init",".wulaui",function(t){t.stopPropagation(),h(this).find("[data-table]").wulatable()})}($,wulaui),Ij=$,Jj=wulaui,Kj=function(t){(this.table=t,this.data={},this.autoLoad=void 0!==t.data("auto"),this.source=t.data("repeater"),this.id=t.attr("id"),t.data("repeaterObj",this),t.data("formTarget",this),t.data("pagerTarget",this),t.data("loaderObj",this),this.id)?0===Ij('form[data-table-form="#'+this.id+'"]').length&&this.initData():this.initData();this.table.trigger("wulaui.table.init")},Kj.prototype.initData=function(){if(this.autoLoad){var t=this,e=10,a=Ij('div[data-table-pager="#'+t.id+'"]');this.data.cp?1===a.length&&(a.data("limit",this.data.limit),a.find("select").val(this.data.limit),this.pagerCtl&&(this.pagerCtl.limit=this.data.limit,this.pagerCtl.current=this.data.cp)):(1===a.length&&a.data("limit")&&(e=parseInt(a.data("limit"),10)),this.data.cp=1,this.data.limit=e),this.inited=!1,0<t.table.parents(".nui-dialog").length?setTimeout(function(){t.reload(),t.inited=!0},200):(this.reload(),this.inited=!0)}},Kj.prototype.doPage=function(t,e,a,i){this.data.cp=t,e&&(this.data.limit=e),a&&this.reload(null,i)},Kj.prototype.doSort=function(t,e,a){this.data.sf===t&&this.data.dir===e||(this.data.sf=t,this.data.dir=e,this.reload(a))},Kj.prototype.reload=function(r,t){if(this.source){var n=this,e=[],o=!1;n.searchForm&&(e=n.searchForm.serializeArray()),!t&&this.inited||(e.push({name:"count",value:1}),o=!0),t&&(this.data.cp=1,this.pagerCtl&&(this.pagerCtl.current=1)),e.push({name:"pager[page]",value:this.data.cp}),e.push({name:"pager[size]",value:this.data.limit}),this.data.sf&&(e.push({name:"sort[name]",value:this.data.sf}),this.data.dir?e.push({name:"sort[dir]",value:this.data.dir}):e.push({name:"sort[dir]",value:"d"})),Ij.ajax(n.source,{dataType:"html",element:n.table,data:e,method:"get"}).done(function(t){(t=Ij(t)).addClass("repeater-body");var e=n.table.find(".repeater-body");if(Jj.destroy(e),e.remove(),n.table.append(t),Jj.init(t),n.pagerCtl&&Ij.isFunction(n.pagerCtl.pageIt)){var a=-1;if(o){var i=t.data("total");a=""===i?-1:parseInt(i||0,10)}n.pagerCtl.pageIt(a)}Ij.isFunction(r)&&r(t)})}},Kj.prototype.form=function(t){if(!t)return this.searchForm;this.searchForm=t,this.initData()},Kj.prototype.pager=function(t){if(!t)return this.pagerCtl;this.pagerCtl=t},Ij.fn.wularepeater=function(r){var n=Array.apply(null,arguments);return n.shift(),Ij(this).each(function(t,e){var a=Ij(e);if(a.data("repeaterObj")){var i=a.data("repeaterObj");"string"==typeof r&&"function"==typeof i[r]&&i[r].apply(i,n)}else new Kj(a)})},Ij("body").on("wulaui.widgets.init",".wulaui",function(t){t.stopPropagation(),Ij(this).find("[data-repeater]").wularepeater()}),ok=$,rk=function(t){var e=t.data("tablePager");if(e){var a=ok(e).data("pagerTarget");a&&(this.pagerTarget=a)}if(t.addClass("row"),this.pagerTarget&&ok.isFunction(this.pagerTarget.pager)&&ok.isFunction(this.pagerTarget.doPage)){this.pagerTarget.pager(this),this.element=t,this.total=parseInt(ok(e).find("[data-total]").data("total")||0,10),this.limit=parseInt(t.data("limit")||20,10),this.pp=parseInt(t.data("pp")||5,10),this.current=1,this.limit||(this.limit=20),this.pp||(this.pp=5);var i=this,r=ok('<section class="col-xs-6 col-sm-4 col-lg-8 text-right"><ul class="pagination pagination-sm m-t-sm m-b-none"></ul></section>');if(void 0===t.data("hiddenTip")){this.tipElm=ok('<section class="col-xs-6 col-sm-8 col-lg-4"><div class="m-t text-muted">共<span class="tp"></span>页<span class="tr"></span>条记录<select class="plimit hidden-xs"></select></span></div></section>');var n=this.tipElm.find("select");n.append(ok('<option value="5">5条/页</option>')),n.append(ok('<option value="10">10条/页</option>')),n.append(ok('<option value="15">15条/页</option>')),n.append(ok('<option value="20">20条/页</option>')),n.append(ok('<option value="30">30条/页</option>')),n.append(ok('<option value="50">50条/页</option>')),n.append(ok('<option value="100">100条/页</option>')),n.val(this.limit),this.tipElm.find(".tr").html(this.total),this.tipElm.appendTo(t),n.change(function(){i.limit=ok(this).val(),i.current=1,i.pagerTarget.doPage(i.current,i.limit,!0,!0)})}else r.removeClass("col-xs-6 col-sm-4 col-lg-8 text-right").addClass("col-xs-12");var o=this.pagerElm=r.find("ul");o.append('<li class="disabled p-f hidden-sm hidden-xs"><a href="#" rel="1"><i class="fa fa-fast-backward"></i></a></li>'),o.append('<li class="disabled p-p"><a href="#" rel="1"><i class="fa fa-backward"></i></a></li>');for(var s=1;s<=this.pp;s++)o.append('<li class="p-'+s+' hidden-sm hidden-xs"><a href="#" rel="'+s+'">'+s+"</a></li>");o.append('<li class="disabled p-n"><a href="#" rel="1"><i class="fa fa-forward"></i></a></li>'),o.append('<li class="disabled p-l hidden-sm hidden-xs"><a href="#" rel="1"><i class="fa fa-fast-forward"></i></a></li>'),r.appendTo(t),o.on("click","a",function(t){if(t.preventDefault(),!ok(this).parents("li").hasClass("disabled")){var e=ok(this).attr("rel");i.current=parseInt(e,10),i.pagerTarget.doPage(i.current,i.limit,!0)}return!1}),this.pagerTarget.doPage(i.current,i.limit),this.pageIt(this.total)}},rk.prototype.pageIt=function(t){this.total=0<=t?t:this.total;var e=Math.ceil(this.total/this.limit),a=this.pagerElm;if(this.tipElm&&(this.tipElm.find(".tp").html(e),this.tipElm.find(".tr").html(this.total)),e<2)a.hide();else{a.show(),a.find("li").removeClass("disabled"),1<this.current?(a.find(".p-f").removeClass("disabled"),a.find(".p-p").removeClass("disabled").find("a").attr("rel",this.current-1)):(a.find(".p-f").addClass("disabled"),a.find(".p-p").addClass("disabled")),this.current===e?(a.find(".p-n").addClass("disabled"),a.find(".p-l").addClass("disabled")):(a.find(".p-l").removeClass("disabled").find("a").attr("rel",e),a.find(".p-n").removeClass("disabled").find("a").attr("rel",this.current+1));var i=Math.ceil(this.pp/2),r=0;if(e<this.pp)for(var n=this.pp;e<n;n--)a.find(".p-"+n).hide();this.current>=i&&(r=this.current-i-1),this.current+i>e&&(r=e-this.pp),r=Math.max(0,r);for(var o=1;o<=Math.min(this.pp,e);o++)a.find(".p-"+o).css("display","inline").find("a").attr("rel",r+o).html(r+o);a.find("a[rel="+this.current+"]").parents("li").removeClass("hidden-xs hidden-sm").addClass("disabled")}},ok.fn.wulaplgpager=function(){return ok(this).each(function(t,e){var a=ok(e);a.data("pagerObj")||a.data("pagerObj",new rk(a))})},ok("body").on("wulaui.table.init","div[data-repeater],table[data-table]",function(t){t.stopPropagation();var e=ok(this).attr("id");e&&ok('div[data-table-pager="#'+e+'"]').wulaplgpager()}),Pk=$,Qk=function(t){var e=t.data("tableForm");if(e){var a=Pk(e).data("formTarget");a&&Pk.isFunction(a.form)&&Pk.isFunction(a.reload)&&(a.form(t),t.submit(function(t){return t.preventDefault(),a.reload(null,!0),!1}))}},Pk.fn.wulaplgform=function(){return Pk(this).each(function(t,e){var a=Pk(e);a.data("formObj")||a.data("formObj",new Qk(a))})},Pk("body").on("wulaui.table.init","table[data-table], div[data-repeater]",function(t){t.stopPropagation();var e=Pk(this).attr("id");e&&Pk('form[data-table-form="#'+e+'"]').wulaplgform()}),function($,wui){var defaultOpts={c:!1,runtimes:"html5",max_file_count:1,chunk_size:"256k",chunks:!0,multi_selection:!1,max_file_size:"28mb",filters:[{title:"*.*",extensions:"jpg,gif,png,jpeg"}]},PreviewFile=function(t,e){if(this.file=t,this.id=e,this.name=t.name,this.previewable=/.+\.(png|gif|jpg|jpeg|bmp)/i.test(this.name),this.previewable){var a=$(this.id).get(0),i=new FileReader;i.onload=function(t){a.src=t.target.result},i.readAsDataURL(this.file)}else $(this.id).attr("src",wui.config.assets+"dat.jpg")},nuiUploader=function(e){e.data("uploaderObj",this);var o=this;this.element=e,this.form=e.closest("form[data-ajax]"),this.value=e.data("value"),this.varName=e.data("name"),this.auto=void 0!==e.data("auto"),this.extensions=e.data("exts")||"jpg,gif,png,jpeg",this.width=e.data("width")||90,this.height=e.data("height")||this.width,this.readonly=void 0!==e.data("readonly"),this.whstyle="width:"+this.width+"px;height:"+this.height+"px;",this.isLocal=void 0!==e.data("localStore");var t={};this.extensions&&(t.filters=[{title:"*.*",extensions:this.extensions}]);var a=e.data("multi");this.multi=parseInt(a||"1",10)||1,1<this.multi?(t.max_file_count=this.multi,t.chunks=!0,t.chunk_size="512k",t.multi_selection=!0,this.varName+="[]"):this.multi=1,this.mfs=e.data("maxFileSize"),this.mfs&&(t.max_file_size=this.mfs);var i=e.data("resize");if(i){var r=i.split(",");t.resize={},t.resize.width=r[0],t.resize.height=r[0],t.resize.preserve_headers=!1,2<=r.length&&r[1]&&(t.resize.height=r[1]),3<=r.length&&r[2]&&(t.resize.quality=r[2]),4<=r.length&&r[3]&&(t.resize.crop=!0)}this.opts=$.extend({},defaultOpts,t),this.noWatermark=e.data("noWater"),void 0!==this.noWatermark&&(this.opts.multipart_params={nowater:1});var n=function(){var t=o.uploader,e=$(this).parent(),a=e.find("input").attr("id"),i=t.getFile(a);i&&(t.removeFile(i),o.newFile--);var r=e.find("input").val();if(r){var n=$.Event("uploader.remove");o.element.trigger(n,[r]),n.isDefaultPrevented()||(e.remove(),o.uploadBtn.show())}else e.remove(),o.uploadBtn.show();0===o.wrapper.find("input").length&&o.uploadBtn.append('<input type="hidden" id="empty-f-'+o.id+'" name="'+o.varName+'" value=""/>')};e.closest(".wulaui").on("wulaui.widgets.destroy",function t(){e.off("form.placement"),o.uploader&&(o.uploader.destroy(),o.wrapper=null,e.data("uploaderObj",null),$(this).off("wulaui.widgets.destroy",t),delete o.uploader)}),this.id=e.attr("id"),this.btnId="uploadimg-"+this.id,e.hasClass("input-group")?this._init2(n,e):this._init1(n,e),this.uploader.bind("UploadComplete",function(t){t.disableBrowse(!1),o.newFile=0,t.splice(0),t.refresh(),o.element.hasClass("pendup")?(o.element.removeClass("pendup"),0<o.form.length&&0===o.form.find("[data-uploader].pendup").length&&o.form.submit()):o.element.trigger("uploader.done")})};nuiUploader.prototype.start=function(){0<this.newFile?this.uploader.start():this.element.trigger("uploader.done")},nuiUploader.prototype.stop=function(){this.uploader.stop()},nuiUploader.prototype.get=function(){return this.uploader},nuiUploader.prototype.clear=function(){this.wrapper.find("li").not(this.uploadBtn).find("i").click(),this.uploader.splice(0),this.uploader.refresh(),this.uploader.disableBrowse(!1),this.uploadBtn.show()},nuiUploader.prototype._init1=function(removeFile,elem){var $this=this;this.wrapper=$('<ul class="upload-img-box"><li class="uploadimg-btn"><a href="javascript:void(0);" style="'+this.whstyle+'" id="'+this.btnId+'"></a></li><br class="clearfix"/></ul>'),elem.append(this.wrapper),this.uploadBtn=this.wrapper.find(".uploadimg-btn"),this.opts.browse_button=this.btnId,this.opts.url=elem.data("uploader")||"";var uploader=new plupload.Uploader(this.opts);if(this.uploader=uploader,this.newFile=0,this.value){if(1===this.multi&&(this.value=[this.value]),$.isArray(this.value)){$.each(this.value,function(t,e){var a='<li id="up-file'+t+'">';a+='<img id="img_file'+t+'" src="'+($this.isLocal?wui.base(e):wui.media(e))+'" style="'+$this.whstyle+'"/>',a+='<span class="fsrc">'+e+"</span>",$this.readonly||(a+="<i>×</i>"),a+='<input type="hidden" id="old-file'+t+'" name="'+$this.varName+'" value="'+e+'"/>';var i=$(a+="</li>");$this.uploadBtn.before(i),i.on("click","i",removeFile)});var imgNum=$this.wrapper.find("input").length;imgNum>=$this.multi&&$this.uploadBtn.hide()}}else this.uploadBtn.append('<input type="hidden" id="empty-f-'+this.id+'" name="'+this.varName+'" value=""/>');this.readonly&&this.uploadBtn.remove(),uploader.init(),uploader.bind("BeforeUpload",function(t,e){var a="#up-"+e.id;$(a+" .progress").show()}),uploader.bind("FilesAdded",function(t,e){var a=document.getElementById(t.id+"_"+t.runtime),i=void 0;for(var r in $this.uploadBtn.find("input").remove(),$this.auto&&t.disableBrowse(!0),e){if((i=$this.wrapper.find("input").length)+1>$this.multi){t.splice($this.newFile);break}var n=e[r],o=null;for(var s in a.files)a.files[s].name===n.name&&a.files[s].size===n.size&&(o=a.files[s]);if(o){$this.newFile++;var l='<li id="up-'+n.id+'">';l+='<img id="img_'+n.id+'" src="'+wui.config.assets+'s.gif" style="'+$this.whstyle+'"/>',l+='<div class="progress progress-xs" style="display:none;width: '+$this.width+'px"><div class="progress-bar progress-bar-info"></div></div>',l+='<span class="fsrc">'+n.name+"</span>",l+='<span class="fsize">'+(n.size/1e3).toFixed(1)+"K</span>",l+="<i>+</i>",l+='<input type="hidden" id="'+n.id+'" name="'+$this.varName+'"/>';var d=$(l+="</li>");$this.uploadBtn.before(d),new PreviewFile(o,"#img_"+n.id),d.on("click","i",removeFile)}}++i>=$this.multi&&$this.uploadBtn.hide(),$this.auto&&0<$this.newFile?t.start():0<$this.newFile&&$this.element.addClass("pendup")}),uploader.bind("UploadProgress",function(t,e){var a="#up-"+e.id;$(a+" .progress-bar").css("width",e.percent+"%")}),uploader.bind("FileUploaded",function(t,e,a){var i=e.id,r="#up-"+i;if(e.status===plupload.DONE){$(r+" .progress-bar").removeClass("progress-bar-info").addClass("progress-bar-success");try{var n=$.parseJSON(a.response).result;if(n){$(r+" input").val(n.url);try{$this.element.trigger("uploader.uploaded",[n])}catch(t){}}else $(r+" .progress-bar").removeClass("progress-bar-info").addClass("progress-bar-danger")}catch(t){$("#up-"+i+" .progress-bar").removeClass("progress-bar-info").addClass("progress-bar-danger"),wui.toast.error(t.message)}}else $("#up-"+i+" .progress-bar").removeClass("progress-bar-info").addClass("progress-bar-danger")}),uploader.bind("Error",function(up,file){up.disableBrowse(!1);var id=file.file?file.file.id:file.id;if($("#up-"+id+" .progress-bar").removeClass("progress-bar-info").addClass("progress-bar-danger"),file.response)try{var result=eval("("+file.response+")"),rst=result.error;wui.toast.error(rst.message)}catch(t){wui.toast.error("文件上传出错")}else file.message&&wui.toast.error(file.message);$this.element.trigger("uploader.error")})},nuiUploader.prototype._init2=function(removeFile,elem){if(this.inputEle=$('<input type="text" class="form-control" autocomplete="off" id="file-'+this.id+'" name="'+this.varName+'"/>'),this.inputEle.val(this.value),this.btnEle=$('<span class="input-group-addon"><em>x</em><i class="fa fa-upload" id="'+this.btnId+'" style="cursor: pointer"></i></span>'),elem.append(this.inputEle).append(this.btnEle),this.readonly)this.inputEle.attr("readonly","true");else{this.opts.browse_button=this.btnId,this.opts.url=elem.data("uploader")||"";var uploader=new plupload.Uploader(this.opts),$this=this;this.uploader=uploader,uploader.init(),uploader.bind("FilesAdded",function(t,e){1<t.files.length&&t.splice(0,t.files.length-1),$this.inputEle.val(e[0].name+"（"+(e[0].size/1e3).toFixed(1)+"KB）"),$this.element.addClass("pendup")}),uploader.bind("FileUploaded",function(t,e,a){if(e.status===plupload.DONE)try{var i=$.parseJSON(a.response).result;i?$this.inputEle.val(i.url):(wui.toast.error(a.response),$this.inputEle.val(""))}catch(t){wui.toast.error(a.response),$this.inputEle.val("")}else wui.toast.error(a.response),$this.inputEle.val("")}),uploader.bind("Error",function(up,file){if(file.response)try{var result=eval("("+file.response+")"),rst=result.error;wui.toast.error(rst.message)}catch(t){wui.toast.error("文件上传出错")}else file.message&&wui.toast.error(file.message)}),elem.find("span > em").on("click",function(){$this.element.removeClass("pendup"),$this.uploader.splice(0),$this.inputEle.val("")})}},$.fn.wulauploader=function(){var r=Array.apply(null,arguments);return r.shift(),$(this).each(function(t,e){var a=$(e);if(a.data("uploaderObj")){var i=a.data("uploaderObj");"string"==typeof option&&"function"==typeof i[option]&&i[option].apply(i,r)}else new nuiUploader(a)})},$("body").on("wulaui.widgets.init",".wulaui",function(t){t.stopPropagation();var e=$(this).find("[data-uploader]");0<e.length&&(window.plupload?e.wulauploader():layui.use("plupload",function(){e.wulauploader()}))})}($,wulaui),function(r,t){r.fn.wulapopmenu=function(){return r(this).each(function(t,e){var a=r(e);a.data("popMenuObj")||a.data("popMenuObj",new i(a))})};var i=function(t){this.target=t.data("popMenu"),this.arg=t.data("popArg")||"id";var i=this;this.target&&t.find("[data-id]").hover(function(){var t=r(this),e=t.data("popToolbar"),a=t.data("id");return e||(e=r(i.target).clone(!0),t.data("popToolbar",e),e.css({position:"absolute",right:5,bottom:5,padding:0,margin:0}).find("[data-ajax]").on("ajax.build",function(t){t.opts&&t.opts.url&&(t.opts.url=t.opts.url+(0<t.opts.url.indexOf("?")?"&":"?")+i.arg+"="+a)}),e.appendTo(t)),e.show(),!1},function(){var t=r(this).data("popToolbar");return t&&t.hide(),!1})};r("body").on("wulaui.widgets.init",".wulaui",function(t){t.stopPropagation(),r(this).find("[data-pop-menu]").wulapopmenu()})}($),Gm=$,Hm=function(i){var s=this;(this.combox=i).data("comboxObj",this);var t={allowClear:!0},r=Gm.Event("combox.formatResult");if(this.isTagMode=void 0!==i.data("tagMode"),this.parent=i.data("parent"),this.url=i.data("combox"),this.multiple=void 0!==i.data("multi"),this.multiple&&i.data("multi")&&(t.maximumSelectionSize=parseInt(i.data("multi"),10)),t.placeholder=i.attr("placeholder")||"",t.allowClear="false"!==i.data("allowClear")&&t.allowClear,t.minimumInputLength=i.data("mnl")?parseInt(i.data("mnl"),10):0,t.maximumInputLength=i.data("mxl")?parseInt(i.data("mxl"),10):200,t.formatResult=function(t,e,a){return r.data=t,r.query=a,i.trigger(r),r.data.text},t.formatSelection=function(t){var e=Gm.Event("combox.formatSelection");return e.selected=t,i.trigger(e),e.selected.text},t.sortResults=function(t){return Gm.grep(t,function(t){return!!t.text})},this.isTagMode){var e=i.data("tagMode");e=e?e.split(","):[""],t.tags=e,t.separator=",",t.tokenSeparators=[","," "]}if(i.is("select")||(t.multiple=this.multiple,t.initSelection=function(t,e){var a=Gm(t).val(),i=null,r=void 0,n=[];if(i=s.multiple?[{id:"",text:""}]:{id:"",text:""},a){if(s.multiple)for(var o in i=[],a=a.split(","))1<(r=a[o].split(":")).length?i.push({id:r[0],text:r[1]}):i.push({id:r[0],text:r[0]}),n.push(r[0]);else i=1<(a=a.split(":")).length?{id:a[0],text:a[1]}:{id:a[0],text:a[0]},n.push(a[0]);Gm(t).attr("value",n.join(","))}e(i)}),this.url&&(t.ajax={quietMillis:500,cache:!0,data:function(t,e){var a={q:t,_cp:e};return s.parent&&(a.p=Gm("#"+s.parent).val()),a},dataType:"json",url:this.url,results:function(t){return t.results?t:{results:t,more:!1}}}),this.options=t,this.comboxObj=i.select2(this.options),this.parent){var a=Gm("#"+this.parent);0<a.length&&a.change(function(){s.setValue()})}i.closest(".wulaui").on("wulaui.widgets.destroy",function(){s.comboxObj.select2("destroy")})},Hm.prototype.getComboxObj=function(){return this.comboxObj},Hm.prototype.getCombox=function(){return this.combox},Hm.prototype.setValue=function(t){t||(t=this.multiple?null:""),this.combox.select2("val",t,!0)},Gm.fn.wulauiCombox2=function(){return Gm(this).each(function(t,e){var a=Gm(e);a.data("comboxObj")||new Hm(a)})},Gm("body").on("wulaui.widgets.init",".wulaui",function(t){t.stopPropagation();var e=Gm(this).find("[data-combox]");0<e.length&&(Gm.fn.select2?e.wulauiCombox2():layui.use("select2",function(){e.wulauiCombox2()}))}),on=$,on.fn.wulauiDatepicker=function(){return on(this).each(function(t,e){var a=on(e);if(!a.data("DatepickerObj")){a.data("DatepickerObj",!0);var i={format:a.data("format")||"yyyy-mm-dd",clearBtn:!0,daysOfWeekHighlighted:"0,6",calendarWeeks:!0,autoclose:!0,todayHighlight:!0},r=a.data("start"),n=a.data("end"),o=a.data("startday"),s=a.data("endday"),l=a.data("dwd"),d=a.data("disabled");o&&(i.startDate=o),s&&(i.endDate=s),d&&(i.datesDisabled=d),l&&(i.daysOfWeekDisabled=l),a.datepicker(i),r?(r=on(r)).length&&r.change(function(){a.datepicker("setStartDate",on(this).val())}).change():n&&(n=on(n)).length&&n.change(function(){a.datepicker("setEndDate",on(this).val())}).change()}})},on.fn.wulauiTimepicker=function(){return on(this).each(function(t,e){var a=on(e);if(!a.data("TimepickerObj")){a.data("TimepickerObj",1);var i=a.attr("for");if(i){var r=(i=on(i)).val().split(":");0===r.length?r=["00","00"]:1===r.length&&r.push("00"),a.find(".hour").on("change",function(){r[0]=on(this).val(),i.val(r.join(":"))}).val(r[0]),a.find(".minute").on("change",function(){r[1]=on(this).val(),i.val(r.join(":"))}).val(r[1])}}})},on("body").on("wulaui.widgets.init",".wulaui",function(t){t.stopPropagation();var e=on(this).find("[data-datepicker]");0<e.length&&(on.fn.datepicker?e.wulauiDatepicker():layui.use("datepicker",function(){e.wulauiDatepicker()}));var a=on(this).find("[data-timepicker]");0<a.length&&a.wulauiTimepicker()}),Kn=$,Ln=function(e){var a=this;this.settings={view:{},callback:{},edit:{drap:{}},data:{keep:{},key:{},simpleData:{}},check:{}},this.url=e.data("ztree"),this.lazy=void 0!==e.data("lazy"),e.addClass("ztree"),this.url&&(this.settings.async={enable:!0,url:this.url,type:"get",dataType:"json",autoParam:["id"]}),e.on("ztree.setting.load",function(){var t=Kn.Event("ztree.init");t.tree=a,e.trigger(t),a.settings=t.tree.settings,a.nodes=t.tree.nodes,t.isDefaultPrevented()||(a.treeObj=Kn.fn.zTree.init(e,a.settings,a.nodes),e.trigger("ztree.ready",[a.treeObj])),e.off("ztree.setting.load")}).closest(".wulaui").on("wulaui.widgets.destroy",a.destroy),this.lazy&&!e.data("treeEventBind")||e.trigger("ztree.setting.load")},Ln.prototype.destroy=function(){this.treeObj&&(this.treeObj.destroy(),delete this.treeObj,Kn(this).off("wulaui.widgets.destroy",this.destroy))},Kn.fn.wulatree=function(a){return Kn(this).each(function(){var t=Kn(this);if("load"===a)t.data("treeObj")?t.trigger("ztree.setting.load"):t.data("treeEventBind",!0);else if("destroy"===a){var e=t.data("treeObj");e&&(t.data("treeObj",null),e.destroy(),e=null)}else t.data("treeObj")||t.data("treeObj",new Ln(t))})},Kn("body").on("wulaui.widgets.init",".wulaui",function(t){t.stopPropagation();var e=Kn(this).find("[data-ztree]");0<e.length&&layui.use("ztree",function(){e.wulatree()})}),Vn=$,Wn=wulaui,Xn=function(t){var a=this,e=layui.upload;this.form=t.closest("form"),this.targetId=t.attr("for"),this.target=Vn(this.targetId),this.parent=t.closest("div.wysiwyg"),this.mode="edit",this.readonly=t.data("readonly"),void 0!==this.form.data("ajax")?this.form.on("ajax.before",function(){a.target.val(t.html())}):this.form.on("submit",function(){a.target.val(t.html())}),t.data("wysiwygObj",this),this.element=t,this.parent.on("click","a[data-act]",function(){var t=Vn(this).data("act");a[t]&&a[t].apply(a)}).on("click",".ins-pic",function(){var t=Vn(this).closest(".input-group").find(".form-control"),e=t.val();t.val(""),e&&a.exec("insertImage",e)}),this.readonly||(this.editor=t.wysiwyg({toolbarSelector:this.targetId+"-editor-toolbar"}),e.render({elem:this.targetId+"-uploader",url:Wn.app("media/ins"),exts:"jpg|png|gif|jpeg",done:function(t){if(1===t.done){var e='<img src="'+Wn.media(t.result.url)+'" style="width:'+(800<=t.result.width?"100%":t.result.width+"px")+';height: auto;border:0"/>';a.exec("insertHtml",e)}},accept:"images",multiple:!0})),t.data("wysiwygObj",this.editor)},Xn.prototype.exec=function(t,e){this.editor&&(this.editor.restoreSelection(),this.element.focus(),this.editor.execCommand(t,e,this.element),this.editor.saveSelection())},Xn.prototype.source=function(){this.element.find("a,img").removeAttr("data-original-title").popover("destroy"),"edit"===this.mode?(this.mode="source",this.element.addClass("hidden"),this.target.val(this.element.html()).removeClass("hidden"),this.parent.find(".btn-toolbar .btn-group").not(".source").hide()):(this.mode="edit",this.target.addClass("hidden"),this.element.html(this.target.val()).removeClass("hidden"),this.parent.find(".btn-toolbar .btn-group").show())},Xn.prototype.pager=function(){this.editor&&this.exec("insertHtml","<hr/><div><br/></div>")},Vn("body").on("wulaui.widgets.init",".wulaui",function(t){t.stopPropagation();var e=Vn(this).find("[data-wysiwyg]");0<e.length&&layui.use(["upload","wysiwyg"],function(){e.each(function(t,e){var a=Vn(e);a.data("wysiwygObj")||new Xn(a)})})}),wulaui.init(),exports("wulaui",wulaui)});