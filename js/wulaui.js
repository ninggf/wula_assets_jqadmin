var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};layui.define(["jquery","layer","toastr"],function(exports){var $=layui.$,layer=layui.layer,WulaUI=function(){var t=layui.data("wulaui");this.config=$.extend({},{base:"/",assets:"/assets/",medias:[],groups:{char:[],prefix:[]},ids:{}},t.config)},getParams=function(t,e){var a=t.data(e)||t.attr(e);if(a&&"string"==typeof a)try{return new Function("return {"+a+"}")()}catch(t){return{}}return a};WulaUI.prototype.map=function(){this.elements=[],this.size=function(){return this.elements.length},this.isEmpty=function(){return this.elements.length<1},this.clear=function(){delete this.elements,this.elements=[]},this.put=function(t,e){this.remove(t),this.elements.push({key:t,value:e})},this.remove=function(t){try{for(var e=0;e<this.elements.length;e++)if(this.elements[e].key===t)return this.elements.splice(e,1),!0}catch(t){return!1}return!1},this.get=function(t){try{for(var e=0;e<this.elements.length;e++)if(this.elements[e].key===t)return this.elements[e].value}catch(t){return null}},this.join=function(t){t=t||",";var e=[],a=[];try{for(var i=0;i<this.elements.length;i++)e[i]=this.elements[i].key,a[i]=this.elements[i].value}catch(t){return{keys:"",values:""}}return{keys:e.join(t),values:a.join(t)}},this.element=function(t){return t<0||t>=this.elements.length?null:this.elements[t]},this.contains=function(t){try{for(var e=0;e<this.elements.length;e++)if(this.elements[e].key===t)return!0}catch(t){return!1}return!1},this.values=function(){for(var t=[],e=0;e<this.elements.length;e++)t.push(this.elements[e].value);return t},this.keys=function(){for(var t=[],e=0;e<this.elements.length;e++)t.push(this.elements[e].key);return t}},WulaUI.prototype.toast=top.global&&top.global.toast?top.global.toast:layui.toastr,WulaUI.prototype.layer=top.global&&top.global.layer?top.global.layer:layui.layer,WulaUI.prototype.app=function(t){if("string"==typeof t){var e=this.config,a=t.split("/");if(a[0].match(/^([~!@#%\^&\*])(.+)$/)){var i=RegExp.$2,r=RegExp.$1;if(e.ids&&e.ids[i]&&(i=e.ids[i]),e.groups&&e.groups.char)for(var n=0;n<e.groups.char.length;n++)if(e.groups.char[n]===r){r=e.groups.prefix[n];break}a[0]=r+i}else{var s=a[0];e.ids&&e.ids[s]&&(s=e.ids[s],a[0]=s)}a[0]=e.base+a[0],t=a.join("/")}return t},WulaUI.prototype.media=function(t){if(/^(\/|https?:\/\/).+/.test(t))return t;if(this.config.medias){var e=this.config.medias;return e[parseInt(200*Math.random())%e.length]+t}return this.config.base+t},WulaUI.prototype.assets=function(t){return/^(\/|https?:\/\/).+/.test(t)?t:this.config.assets+t},WulaUI.prototype.base=function(t){return/^(\/|https?:\/\/).+/.test(t)?t:this.config.base+t},WulaUI.prototype.open=function(t){top.global&&top.global.menu&&top.global.menu.menuOpen(t)},WulaUI.prototype.init=function(t){(t=t||$("body .wulaui")).hasClass("wulaui")?t.trigger("wulaui.widgets.init"):t.find(".wulaui").trigger("wulaui.widgets.init")},WulaUI.prototype.destroy=function(t){0!==t.length&&(t.hasClass("wulaui")?t.triggerHandler("wulaui.widgets.destroy"):t.find(".wulaui").each(function(){$(this).triggerHandler("wulaui.widgets.destroy")}))},WulaUI.prototype.dialog=function(t,e){var a=["auto","auto"],i=!1,r=0;if(e){var n=$.Event("before.dialog");n.options=t,e.trigger(n)}if(2===parseInt(t.type)?t.data&&(t.content=t.content+(t.content.indexOf("?")>=0?"&":"?")+t.data):"ajax"===t.type?(i=!0,t.data&&(t.content=t.content+(t.content.indexOf("?")>=0?"&":"?")+t.data)):t.content=$(t.content),""!==t.area||"auto,auto"!==t.area){a=t.area.split(",");var s=parseInt(a[0]),o=$(window).width()-20;s>o&&(a[0]=o+"px");var l=parseInt(a[1]),d=$(window).height()-20;l>d&&(a[1]=d+"px")}i?(t.type=1,t.success=function(e){wulaui.init(e),t.$content=e},t.beforeClose=function(){wulaui.destroy(t.$content)},wulaui.ajax.ajax(t.content,{element:e||$("body"),dataType:"html",method:"get"}).done(function(i){t.type=1,t.content=i,t.area?(t.area=a,r=layer.open(t)):(r=layer.open(t),layer.full(r)),e&&e.data("dialogId",r)})):(t.area?(t.area=a,r=layer.open(t)):(r=layer.open(t),layer.full(r)),e&&e.data("dialogId",r))},WulaUI.prototype.iframeDialog=function(t,e,a,i){var r={type:2,content:t,title:e||"窗口",area:a};this.dialog(r,i)},WulaUI.prototype.params=getParams,WulaUI.prototype.format=function(t,e){return 1===arguments.length?function(){var e=$.makeArray(arguments);return e.unshift(t),WulaUI.prototype.format(e)}:void 0===e?t:(arguments.length>2&&e.constructor!==Array&&(e=$.makeArray(arguments).slice(1)),e.constructor!==Array&&(e=[e]),$.each(e,function(e,a){t=t.replace(new RegExp("\\{"+e+"\\}","g"),function(){return a})}),t)};var wulaui=new WulaUI,Gd,Id,Jd,Kd,Ld,Ej,Hj,dk,El,Fl,lm,Hm,Im,Sm,Tm,Um;$("body").on("click","[data-tab]",function(){var t=$(this),e=$.Event("ajax.before");if(t.trigger(e),e.isDefaultPrevented())return!1;var a=t.attr("href")||t.data("url"),i=t.attr("title")||t.data("title")||t.text()||"新窗口",r={href:a,icon:t.data("tab")||"&#xe621;",cls:t.data("cls")||null,title:i};return a&&wulaui.open(r),t.is("a")&&t.closest("ul").is(".dropdown-menu")&&t.closest("ul").closest(".open").removeClass("open"),!1}).on("click","[data-dialog]",function(){try{var t=$(this),e={type:t.data("dialog")||2,title:t.attr("title")||t.data("title")||t.text(),content:t.attr("href")||t.data("url"),area:""},a=getParams(t,"params"),i=t.data("area");e=$.extend({},e,a),i&&(e.area=i),wulaui.dialog(e,t)}catch(t){console.log(t)}return!1}).on("click",'[data-toggle^="class"]',function(t){t&&t.preventDefault();var e=$(t.target),a=void 0,i=void 0,r=void 0,n=void 0,s=void 0;!e.data("toggle")&&(e=e.closest('[data-toggle^="class"]')),a=e.data().toggle,i=e.data("target")||e.attr("href"),a&&(r=a.split(":")[1])&&(n=r.split(",")),i&&(s=i.split(",")),s&&s.length&&$.each(s,function(t,e){"#"!==e&&$(e).toggleClass(n[t])}),e.toggleClass("active")}).on("focus","[data-expend]",function(){var t=$(this),e=t.data("owidth")||t.width(),a=t.data("expend");t.data("owidth",e),a&&t.width(a)}).on("blur","[data-expend]",function(){var t=$(this),e=t.data("owidth");e&&t.width(e)}),function(t,e,a){"use strict";var i=t.ajax,r=a.toast;t.ajax=function(t,e){return i(t,e).done(function(a){var i=e||t;"abort"!==i.mode&&("json"===i.dataType?(u(a),p(a,i)):"update"===i.action&&i.target&&p({code:200,action:"update",target:i.target,args:{content:a}},i))})},t(document).ajaxSend(function(e,a,i){if("abort"!==i.mode&&i.element){i.element.data("ajaxSending",!0);var r=new t.Event("ajax.send");r.element=i.element,i.element.trigger(r,[i,a]),a.setRequestHeader("X-AJAX-TYPE",i.dataType)}}),t(document).ajaxError(function(e,a,i,r){if("abort"!==i.mode&&i.element){var n=t.Event("ajax.error");if(i.element.trigger(n,[i,r,a]),!n.isDefaultPrevented())switch(a.status){case 500:d(a,"服务器端500错误");break;case 200:d(a,"数据类型转换出错");break;case 401:window.layui&&layui.wulaAuthPage?top.location=layui.wulaAuthPage:(h(a),t(document).trigger("wula.need.login"));break;case 403:h(a),t(document).trigger("wula.perm.denied");break;case 404:h(a),t(document).trigger("wula.page.404");break;case 422:try{p(t.parseJSON(a.responseText))}catch(n){}break;default:h(a)}}}),t(document).ajaxSuccess(function(t,e,a,i){"abort"!==a.mode&&a.element&&a.element.trigger("ajax.success",[i,a,e])}),t(document).ajaxComplete(function(e,a,i){if("abort"!==i.mode&&i.element){i.element.data("ajaxSending",!1),i.element.hasClass("data-loading-text")&&i.element.button("reset");var r=new t.Event("ajax.done");r.element=i.element,i.element.trigger(r,[i,a])}}),t.ajaxSetup({cache:!1,timeout:3e5});var n=function(a,i,r){var n=t.extend({},{icon:3,title:"请确认",loading:!1},r||{});a.dataType||(a.dataType="json"),e.confirm(i||"亲，你确定要这么干吗？",n,function(i){e.close(i),n.loading?(i=e.load(2),t.ajax(a).always(function(){e.close(i)})):t.ajax(a)})},s=function(t,e){t.type="ajax",a.dialog(t,e)},o=function(e){e.preventDefault(),e.stopPropagation();var i=t(this);if(i.is("a")&&i.closest("ul").is(".dropdown-menu")&&i.closest("ul").closest(".open").removeClass("open"),i.data("ajaxSending"))return!1;var o=t.Event("ajax.before");if(o.element=i,i.trigger(o),o.isDefaultPrevented())return!1;var l=t.Event("ajax.validate");if(l.element=i,i.trigger(l),!l.isDefaultPrevented()){var d=t.Event("ajax.build");d.opts=t.extend({element:i,data:[]},i.data()||{}),d.opts.url=d.opts.url||i.attr("href")||i.attr("action")||i.data("url")||"";var u=d.opts.ajax||"get.json";delete d.opts.ajax;var p=u.split(".");d.opts.dataType=2===p.length?p[1]:"json";var h=i.attr("method")||(p[0]?p[0]:null)||"GET";d.opts.method=h.toUpperCase();var c=i.data("timeout");if(d.opts.timeout=void 0===c?12e4:parseInt(c,10),"UPDATE"===d.opts.method)d.opts.method="GET",d.opts.dataType="html",d.opts.action="update",d.opts.target=i.attr("target")||i.data("target");else if("DIALOG"===d.opts.method){d.opts.method="GET",d.opts.dataType="html",d.opts.action="dialog",d.opts.title=i.attr("title")||i.data("title")||!1,d.opts.dialog=t.extend({},a.params(i,"params")),d.opts.dialog.type=2===p.length?2:"ajax";var f=t.Event("build.dialog");f.btn=null,i.trigger(f),f.btn&&(d.opts.btn=f.btn)}var m=i.data("grp");if(m){var g=[],v=i.data("arg")||"ids";if(t(m).each(function(e,a){g.push(t(a).val())}),0===g.length){var b=i.data("warn")||"请选择要处理的数据";return void r.warning(b)}g=g.join(","),d.opts.data.push({name:v,value:g})}if(i.is("input,select,textarea")&&d.opts.data.push({name:"value",value:i.val()}),i.is("[data-toggle]")&&d.opts.data.push({name:"value",value:i.hasClass("active")?0:1}),i.trigger(d),!d.isDefaultPrevented())if("update"===d.opts.action&&t(d.opts.target).data("loaderObj"))t(d.opts.target).data("load",d.opts.url).data("loaderObj").reload(null,void 0!==i.data("force"));else if("dialog"===d.opts.action){var y=t.extend({},{content:d.opts.url,title:d.opts.title,area:d.opts.area||"",btn:d.opts.btn||null,data:d.opts.data},d.opts.dialog);s(y,i)}else if(void 0!==i.data("confirm")){var w=i.data("confirm"),x=parseInt(i.data("auto"),0)||0,j={icon:3,loading:void 0!==i.data("loading"),title:i.attr("title")||i.data("title")||"请确认"};x>0&&(j.time=x),n(d.opts,w,j)}else t.ajax(d.opts)}return!1},l=function(e){var a=e.responseText||e.statusText;if(e.getResponseHeader("ajax"))try{return t.parseJSON(a).message}catch(t){a="数据转换异常"}else a&&a.indexOf("</body>")>0?a=(a=a.substr(0,a.indexOf("</body>"))).substr(a.indexOf(">",a.indexOf("<body"))+1):"error"===e.statusText&&(a="出错啦");return a},d=function(t,a){var i=l(t);e.full(e.open({type:0,title:a,content:i,btn:null}))},u=function(t){if(t.message){var a=!0;switch("alert"===t.style&&(a=!1),t.code){case 500:a?r.error(t.message):e.alert(t.message,{icon:5,title:null,btn:null,shadeClose:!0});break;case 400:a?r.warning(t.message):e.alert(t.message,{icon:2,title:null,btn:null,shadeClose:!0});break;case 300:a?r.info(t.message):e.alert(t.message,{icon:1,title:null,btn:null,shadeClose:!0});break;case 200:default:a?r.success(t.message):e.alert(t.message,{icon:6,title:null,btn:null,shadeClose:!0})}}},p=function(a,i){var r=void 0,n=void 0;switch(a.action){case"update":"parent"===(n=c(a.target))[0]&&parent.ajaxActions?parent.ajaxActions.update(n[1],a):"top"===n[0]&&top.ajaxActions?top.ajaxActions.update(n[1],a):ajaxActions.update(n[1],a);break;case"reload":if(!a.target||"document"===a.target||"top"===a.target)return void("top"===a.target?top.location.reload(!0):location.reload(!0));try{"parent"===(n=c(a.target))[0]&&parent.ajaxActions?parent.ajaxActions.reload(n[1]):"top"===n[0]&&top.ajaxActions?top.ajaxActions.reload(n[1]):ajaxActions.reload(n[1])}catch(t){}break;case"click":"parent"===(n=c(a.target))[0]&&parent.ajaxActions?parent.ajaxActions.click(n[1]):"top"===n[0]&&top.ajaxActions?top.ajaxActions.click(n[1]):ajaxActions.click(n[1]);break;case"redirect":var o=a.target;o&&(window.location.hash&&a.hash?window.location.href=o+window.location.hash:window.location.href=o);break;case"dialog":s(a.args,i.element);break;case"validate":r=t('form[name="'+a.target+'"]');var l=a.args,d=r.data("validateObj");d&&d.showErrors(l)}if(i&&i.element&&a.code&&a.code<=300){var u=i.element.data("ajaxDone");if(u){var p=u.split(";");t.each(p,function(a,n){var s=n.split(":");switch(s[0]){case"close":if(s.length>1)if("parent"===s[1]&&parent.layer)parent.layer.close(parent.layer.index);else if("top"===s[1]&&top.layer)top.layer.close(top.layer.index);else{var o=i.element.data("dialogId");o?e.close(o):e.close(e.index)}break;case"show":s.length>1&&t(s[1]).removeClass("hidden").show();break;case"hide":s.length>1&&t(s[1]).addClass("hidden").hide();break;case"click":(r=t(s[1])).length&&r.click();break;case"reload":t(s[1]).each(function(e,a){var i=t(a).data("loaderObj");i&&i.reload()})}})}}},h=function(t){var e=l(t);r.error(e)},c=function(t){if("string"==typeof t){var e=t.split(":");if(2===e.length)return e}return["me",t]};t("body").on("click","a[data-ajax]",o).on("click","button[data-ajax]",o).on("submit","form[data-ajax]",o).on("change","select[data-ajax]",o).on("change","input[data-ajax]",o).on("change","textarea[data-ajax]",o).on("ajax.send","[data-loading]",function(t){t.stopPropagation();var a=t.element;void 0!==a.data("loading")&&a.data("loading",e.load(2))}).on("ajax.done","[data-loading]",function(t){t.stopPropagation();var a=t.element;void 0!==a.data("loading")&&e.close(a.data("loading"))}).on("ajax.success","[data-toggle]",function(){t(this).toggleClass("active")}),a.ajax={confirm:n,dialog:s,ajax:t.ajax,async:!0,sync:function(){return this.async=!1,this},get:function(e,a,i){var r={dataType:i||"json",method:"GET",data:a||{},async:!!this.async};return this.async=!0,t.ajax(e,r)},post:function(e,a,i){var r={dataType:i||"json",method:"POST",data:a||{},async:!!this.async};return this.async=!0,t.ajax(e,r)}},window.ajaxActions={reload:function(e){if("document"!==e){if((e=t(e)).length){var a=e.data("loaderObj");a&&a.reload(null,!0)}}else location.reload()},update:function(e,i){if((e=t(e)).length&&i.args&&i.args.content){if(i.args.append){var r=t(i.args.content);e.append(r),a.init(r)}else a.destroy(e),e.empty().html(i.args.content),a.init(e);e.trigger("content.updated")}},click:function(e){(e=t(e)).length&&(/^#.+/.test(e.attr("href"))?window.location.hash=e.attr("href"):e.click())}}}($,layer,wulaui),function(t,e){var a=wulaui.ajax;t.fn.wulauiLoad=function(){return t(this).each(function(e,a){var r=t(a);r.data("loaderObj")||r.data("loaderObj",new i(r))})},t.fn.reload=function(e,a){return t(this).each(function(i,r){var n=t(r).data("loaderObj");n&&(e&&t(r).data("load",e),n.reload(null,a))})};var i=function(t){this.autoload=void 0!==t.data("auto"),this.lazy=void 0!==t.data("lazy"),this.element=t,this.autoload&&this.reload()};i.prototype.reload=function(t,e){r.apply(this,[e])};var r=function(e){var i=this.url?this.url:"";if(this.url=this.element.data("load")||this.element.attr("href"),this.url&&(e||!this.lazy||i!==this.url)){var r=t.Event("ajax.build");r.opts=t.extend({element:this.element},this.element.data()||{}),r.opts.url=this.url,r.opts.method="GET",r.opts.action="update",r.opts.dataType="html",r.opts.target=this.element,this.element.trigger(r),r.isDefaultPrevented()||a.ajax(r.opts)}};t("body").on("wulaui.widgets.init",".wulaui",function(e){e.stopPropagation(),t(this).find("[data-load]").wulauiLoad()})}($),Gd=$,Id=wulaui,Jd={required:function(t,e,a){if(!this.depend(a,e))return"dependency-mismatch";if("select"===e.nodeName.toLowerCase()){var i=Gd(e).val();return i&&i.length>0}return this.checkable(e)?this.getLength(t,e)>0:t.length>0},email:function(t,e){return this.optional(e)||/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/.test(t)},url:function(t,e){return this.optional(e)||/^(?:(?:(?:https?|ftp):)?\/\/)(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,})).?)(?::\d{2,5})?(?:[/?#]\S*)?$/i.test(t)},date:function(t,e){return this.optional(e)||/^\d{4}[\/\-](0?[1-9]|1[012])[\/\-](0?[1-9]|[12][0-9]|3[01])$/.test(t)},number:function(t,e){return this.optional(e)||/^(?:-?\d+|-?\d{1,3}(?:,\d{3})+)?(?:\.\d+)?$/.test(t)},digits:function(t,e){return this.optional(e)||/^(0|[1-9]\d*)$/.test(t)},minlength:function(t,e,a){var i=Gd.isArray(t)?t.length:this.getLength(t,e);return this.optional(e)||i>=a},maxlength:function(t,e,a){var i=Gd.isArray(t)?t.length:this.getLength(t,e);return this.optional(e)||i<=a},rangelength:function(t,e,a){var i=Gd.isArray(t)?t.length:this.getLength(t,e);return this.optional(e)||i>=a[0]&&i<=a[1]},min:function(t,e,a){return this.optional(e)||t>=a},max:function(t,e,a){return this.optional(e)||t<=a},range:function(t,e,a){return this.optional(e)||t>=a[0]&&t<=a[1]},step:function(t,e,a){var i=Gd(e).attr("type"),r="Step attribute on input type "+i+" is not supported.",n=new RegExp("\\b"+i+"\\b"),s=i&&!n.test(["text","number","range"].join()),o=function(t){var e=(""+t).match(/(?:\.(\d+))?$/);return e&&e[1]?e[1].length:0},l=function(t){return Math.round(t*Math.pow(10,u))},d=!0,u=void 0;if(s)throw new Error(r);return u=o(a),(o(t)>u||l(t)%l(a)!=0)&&(d=!1),this.optional(e)||d},equalTo:function(t,e,a){return t===Gd(a).val()},passwd:function(t,e,a){if(this.optional(e))return!0;switch(a){case"2":return/[a-z]/i.test(t)&&/\d/.test(t)&&/[^a-z\d]/i.test(t);case"3":return/[A-Z]/.test(t)&&/[a-z]/.test(t)&&/\d/.test(t)&&/[^a-z\d]/i.test(t);case"1":default:return/[a-z]/i.test(t)&&/\d/.test(t)}},pattern:function(t,e,a){return!!this.optional(e)||("string"==typeof a?new RegExp("^(?:"+a+")$").test(t):a.test(t))},ip:function(t,e){return this.optional(e)||/^(25[0-5]|2[0-4]\d|[01]?\d\d?)\.(25[0-5]|2[0-4]\d|[01]?\d\d?)\.(25[0-5]|2[0-4]\d|[01]?\d\d?)\.(25[0-5]|2[0-4]\d|[01]?\d\d?)$/i.test(t)},phone:function(t,e){return this.optional(e)||/^1[34578]\d{9}$/.test(t)}},Kd={required:"这是必填字段",email:"请输入合法的邮箱地址",url:"请输入合法的URL",date:"请输入合法的日期",number:"请输入有效的数字",digits:"只能输入数字",equalTo:"你的输入不相同",maxlength:"最多可以输入{0}个字符",minlength:"最少要输入{0}个字符",rangelength:"请输入长度在{0}到{1}之间的字符串",range:"请输入范围在{0}到{1}之间的数值",max:"请输入不大于{0}的数值",min:"请输入不大于{0}的数值",step:"请输入{0}的倍数",passwd:"你输入的密码不够强",pattern:"请输入合法的格式",ip:"请输入合法的IP地址",phone:"请输入有效的手机号"},Ld=function(t){this.form=t;var e=this,a=new Gd.Event("form.init.rule");a.form=this,t.trigger(a).on("ajax.before",function(){return e.validate()}).on("blur","[data-verify]:not(readonly):not(ignore)",function(){e.check(Gd(this),this)})},Gd.extend(Ld,{prototype:{validate:function(){var t=this,e=0,a=0;return this.form.find("[data-verify]:not(readonly):not([ignore])").each(function(i,r){!0===t.check(Gd(r),r)&&e++,a++}),e===a},check:function(t,e){var a=t.data("wulauiValidRules")||this.parseRules(t)||!1,i=t.data("wulauiValidMsgs")||{},r=this.elementValue(e),n=void 0,s=void 0,o=void 0,l=this.createErrorEle(t,e);if(a){var d=Gd.map(a,function(t,e){return e}).length;for(o in a){n={method:o,parameters:a[o]};try{if("dependency-mismatch"===(s=Jd[o].call(this,r,e,n.parameters))&&1===d)continue;if(!s)return l.html(this.getMsg(n,i)).show(),!1}catch(t){console.log("Exception occurred when checking element '"+(e.id||e.name)+"', check the '"+n.method+"' method.",t)}}this.objectLength(a)&&l.hide()}return!0},parseRules:function(t){var e=Id.params(t,"verify");return!!e&&(t.data("wulauiValidRules",e),t.data("wulauiValidMsgs",Id.params(t,"verifyMsg")),e)},getMsg:function(t,e){var a=/\$?\{(\d+)\}/g,i=void 0;return"function"==typeof(i=e[t.method]?e[t.method]:Kd[t.method]?Kd[t.method]:"此项填写不合法")?i=i.call(this,t.parameters):a.test(i)&&(i=Id.format(i.replace(a,"{$1}"),t.parameters)),i},checkable:function(t){return/radio|checkbox/i.test(t.type)},depend:function(t,e){var a=void 0===t?"undefined":void 0===t?"undefined":_typeof(t);return!this.dependTypes[a]||this.dependTypes[a](t,e)},dependTypes:{boolean:function(t){return t},string:function(t,e){return!!Gd(t,e.form).length},function:function(t,e){return t(e)}},optional:function(t){var e=this.elementValue(t);return!Jd.required.call(this,e,t)&&"dependency-mismatch"},objectLength:function(t){var e=0,a=void 0;for(a in t)t[a]&&e++;return e},escapeCssMeta:function(t){return t.replace(/([\\!"#$%&'()*+,./:;<=>?@\[\]^`{|}~])/g,"\\$1")},findByName:function(t){return this.form.find("[name='"+this.escapeCssMeta(t)+"']")},createErrorEle:function(t){var e=t.parent().find("span.valid-error");return e.length>0?e:((e=Gd('<span class="valid-error"/>')).appendTo(t.parent()),e)},getLength:function(t,e){switch(e.nodeName.toLowerCase()){case"select":return Gd("option:selected",e).length;case"input":if(this.checkable(e))return this.findByName(e.name).filter(":checked").length}return t.length},elementValue:function(t){var e=Gd(t),a=t.type.toLowerCase(),i=void 0,r=void 0;if("radio"===a||"checkbox"===a){var n=this.findByName(t.name);if(n.length>1){var s=[];return n.filter(":checked").each(function(t,e){s.push(Gd(e).val())}),s}return n.filter(":checked").val()}return"number"===a&&void 0!==t.validity?t.validity.badInput?"NaN":e.val():(i=e.val(),"file"===a?"C:\\fakepath\\"===i.substr(0,12)?i.substr(12):(r=i.lastIndexOf("\\"))>=0?i.substr(r+1):i:"string"==typeof i?i.replace(/\r/g,""):i)},showErrors:function(t){var e=this;Gd.each(t,function(t,a){e.createErrorEle(Gd('[name="'+e.escapeCssMeta(t)+'"]:first')).html(a).show()})}}}),Gd.fn.wulaform=function(){var t=Gd(this);return t.length&&t.each(function(){var t=Gd(this);t.data("validateObj")||t.data("validateObj",new Ld(t))}),t},Id.validator={method:function(t,e,a){Jd[t]=e,Kd[t]=void 0!==a?a:"此项填写不合法"},validate:function(t,e){var a=Gd(t).data("validateObj");a&&(e?a.showErrors(e):a.validate())},get:function(t){var e=Gd(t),a=e.data("validateObj");return a||(e.wulaform(),a=e.data("validateObj")),a}},Gd("body").on("ajax.build","form[data-ajax]",function(t){t.stopPropagation(),t.opts.data=Gd(this).serializeArray()}).on("wulaui.widgets.init",".wulaui",function(t){t.stopPropagation(),Gd(this).find("form[data-verify]").wulaform()}),function($){var prepareValidateRule=function prepareValidateRule(rules){if(rules=rules||{},"object"!==(void 0===rules?"undefined":_typeof(rules)))try{rules=$.parseJSON(rules)}catch(t){rules={},console.log(t.message)}if(rules.rules)for(var i in rules.rules)for(var j in rules.rules[i])"pattern"===j&&(eval("var rule = "+rules.rules[i][j]+";"),rules.rules[i][j]=rule);return rules},errorPlacement=function(t,e){if(e.is("[type=checkbox]")||e.is("[type=radio]")){var a=e.closest("div");(a.is(".checkbox")||a.is(".radio"))&&(a=a.parent().closest("div")),a.children("span").length?t.insertBefore(a.children("span")):t.appendTo(a)}else{var i=$.Event("form.placement");e.trigger(i,[t,e]),i.isDefaultPrevented()||t.insertAfter(e)}},Validator=function(t){this.form=t,this.rules=prepareValidateRule(t.data("validate")),this.rules.errorPlacement=errorPlacement,this.rules.onsubmit=!1,this.rules.ignoreTitle=!0,this.rules.errorClass="parsley-error",this.rules.validClass="parsley-success",this.rules.wrapper="ul",this.rules.wrapperClass="parsley-error-list",this.rules.errorElement="li";var e=new $.Event("form.init.rule");e.form=this,this.form.trigger(e),this.validator=t.validate(this.rules);var a=this;t.on("ajax.validate",function(){return a.validate()});t.closest(".wulaui").on("wulaui.widgets.destroy",function t(){a.destroy(),a.form.closest(".wulaui").off("wulaui.widgets.destroy",t)})};Validator.prototype.validate=function(t){if(!this.validator)return!1;if(this.validator.form()){if(t)return this.validator.showErrors(t),!1;if(this.validator.pendingRequest)return this.validator.formSubmitted=!0,!1}return this.form.valid()},Validator.prototype.showErrors=function(t){this.validate(t)},Validator.prototype.destroy=function(){this.validator&&(this.validator.destroy(),this.validator=null,this.rules=null)},$.fn.wulavalidate=function(){var t=$(this);return t.length&&($.validator.defaults.ignore=".ignore",t.each(function(){var t=$(this);t.data("validateObj")||t.data("validateObj",new Validator(t))})),t},$("body").on("wulaui.widgets.init",".wulaui",function(t){t.stopPropagation();var e=$(this).find("form[data-validate]");e.length>0&&layui.use(["validate"],function(){e.wulavalidate()})})}($),function(t,e){var a=function(e){var a=this;(this.table=e,this.parent=e.parent(),this.data={},this.isTree=void 0!==e.data("tree"),this.hideHead=void 0!==e.data("hh"),this.autoExpend=void 0!==e.data("expend"),this.autoLoad=void 0!==e.data("auto"),this.noHover=void 0!==e.data("noHover"),this.source=e.data("table"),this.id=e.attr("id"),this.currentTreeNode=null,this.folderOpenIcon=e.data("folderIcon1")||"fa fa-minus-circle",this.folderCloseIcon=e.data("folderIcon2")||"fa fa-plus-circle",this.leafIcon=e.data("leafIcon")||"",this.noHover?e.addClass("table"):e.addClass("table table-hover"),e.data("tableObj",this),e.data("formTarget",this),e.data("pagerTarget",this),e.data("loaderObj",this),this.initSorter(),this.id)?0===t('form[data-table-form="#'+this.id+'"]').length&&this.initData():this.initData();this.table.find('th input[type="checkbox"].grp').click(function(){var e=t(this),i=e.prop("checked");a.table.find('td input[type="checkbox"].grp').prop("checked",i),i?a.table.find("tbody tr").addClass("nui-selected"):a.table.find("tbody tr").removeClass("nui-selected"),a.table.find('th input[type="checkbox"].grp').not(e).prop("checked",i)}),this.isTree?(this.table.find("tbody tr").length>0&&this.initTree(),this.table.on("click","tbody tr > td:first-child span.tt-folder",function(){var e=t(this),n=a.currentTreeNode=e.parent().parent();void 0!==n.data("parent")&&(e.hasClass("node-open")?(e.removeClass(a.folderOpenIcon).removeClass("node-open").addClass(a.folderCloseIcon),r(n,a)):(e.removeClass(a.folderCloseIcon).addClass("node-open").addClass(a.folderOpenIcon),n.data("loaded")?i(n,a):a.reload()))})):this.table.on("click","tbody tr > td:first-child span.tt-folder",function(){var e=t(this),i=e.parent().parent().next();e.hasClass("node-open")?(e.removeClass(a.folderOpenIcon).removeClass("node-open").addClass(a.folderCloseIcon),i.addClass("hidden").hide()):(e.removeClass(a.folderCloseIcon).addClass("node-open").addClass(a.folderOpenIcon),i.removeClass("hidden").show())}),this.hideHead&&(this.table.find("thead").hide(),this.table.find("tfoot").hide()),this.table.trigger("wulaui.table.init")};a.prototype.initData=function(){if(this.autoLoad){var e=this,a=10,i=t('div[data-table-pager="#'+e.id+'"]');if(this.data.cp?1===i.length&&(i.data("limit",this.data.limit),i.find("select").val(this.data.limit),this.pagerCtl&&(this.pagerCtl.limit=this.data.limit,this.pagerCtl.current=this.data.cp)):(1===i.length&&i.data("limit")&&(a=parseInt(i.data("limit"),10)),this.data.cp=1,this.data.limit=a),this.data.sf){e.table.find("div.sorthd i").removeClass("fa-sort-up fa-sort-down");var r=e.table.find("div[data-field='"+this.data.sf+"']");"d"===this.data.dir?(r.data("dir","a"),r.find("i").addClass("fa-sort-down")):(r.data("dir","d"),r.find("i").addClass("fa-sort-up"))}this.inited=!1,e.table.parents(".nui-dialog").length>0?setTimeout(function(){e.reload(),e.inited=!0},200):(this.reload(),this.inited=!0)}else this.isTree||(this.subTr(),this.inited=!0)},a.prototype.initSorter=function(){var e=this.table.attr("data-sort"),a=this;if(this.table.find("th[data-sort]").each(function(i,r){var n=t(r),s=n.attr("data-sort");if(s){var o=s.split(","),l=o.shift(),d="d",u="fa fa-sort pull-right m-t-xs ";o.length>0&&"d"!==(d=o.shift())&&"a"!==d&&(d="d"),e===s&&(a.data.sf=l,a.data.dir=d,"d"===d?(u+="fa-sort-down text-info",d="a"):(u+="fa-sort-up text-info",d="d"));var p='<div class="sorthd" data-field="'+l+'"';p+=' data-dir="'+d+'">'+n.html(),p+='<i class="'+u+'"></i></div>',n.empty().append(t(p)).removeAttr("data-sort")}}),this.table.data("tfoot")){var i=t("<tfoot></tfoot>");this.table.find("thead tr").clone().appendTo(i),this.table.append(i)}var r=this.table.find("div.sorthd");r.click(function(){r.find("i").removeClass("fa-sort-down fa-sort-up text-info");var e=t(this),i=e.data("field"),n=e.data("dir"),s=t("div[data-field='"+i+"']");a.doSort(i,n,function(){"d"===n?(s.data("dir","a"),s.find("i").removeClass("fa-sort-up").addClass("fa-sort-down text-info")):(s.data("dir","d"),s.find("i").removeClass("fa-sort-down").addClass("fa-sort-up text-info"))})})},a.prototype.initTree=function(e){var a=this;e||(e=this.table.find("tbody tr"));var r=0,n="0";null!==a.currentTreeNode&&(r=a.currentTreeNode.data("ttLevel"),n=a.currentTreeNode.attr("rel"));var s="tt-folder",o=a.folderCloseIcon;t.each(e,function(i,l){var d=t(l),u=d.attr("rel");if(!d.data("handleAdded")){var p=e.is('[parent="'+u+'"]');d.data("parent")||p?(s="tt-folder",d.attr("data-parent")||d.attr("data-parent","true"),o=!a.autoExpend||!p&&a.autoLoad?a.folderCloseIcon:a.folderOpenIcon):(s="tt-leaf",o=a.leafIcon),d.attr("parent")||d.attr("parent",n);var h=d.attr("parent");e.is('[rel="'+h+'"]')?d.css("display","none"):d.css("display","table-row"),d.find("td:first").prepend(t('<span class="'+s+" "+o+'"></span>')),d.find("td:first").prepend(t('<span class="tt-line"></span>')),d.data("handleAdded",!0),d.data("ttLevel",r),d.data("loaded",p)}}),a.autoExpend&&a.table.find("tbody tr[parent='0']").each(function(e,r){i(t(r),a)})},a.prototype.reloadNode=function(e){var a=this;e?(e=(e=""+e).split(","),t.each(e,function(t,e){if(a.currentTreeNode=a.table.find("tr[rel="+e+"]").eq(0),a.currentTreeNode&&a.currentTreeNode.data("loaded")){var i=a.currentTreeNode.find("td:first-child span.tt-folder");a.currentTreeNode.data("loaded",!1),i.hasClass("node-open")&&(n(a.currentTreeNode,a),a.currentTreeNode.find("td:first-child span.tt-folder").removeClass(a.folderOpenIcon).removeClass("node-open").addClass(a.folderCloseIcon),a.reload())}})):(a.currentTreeNode&&(a.currentTreeNode.data("loaded",!1),a.currentTreeNode=null),this.reload())},a.prototype.doPage=function(t,e,a,i){this.data.cp=t,this.currentTreeNode=null,e&&(this.data.limit=e),a&&this.reload(null,i)},a.prototype.doSort=function(t,e,a){this.currentTreeNode=null,this.data.sf=t,this.data.dir=e,this.reload(a)},a.prototype.reload=function(a,r){if(this.source){var n=this,s=[],o=!1;n.searchForm&&(s=n.searchForm.serializeArray()),!r&&this.inited||(s.push({name:"count",value:1}),o=!0),r&&(this.data.cp=1,this.currentTreeNode=null,this.pagerCtl&&(this.pagerCtl.current=1)),s.push({name:"pager[page]",value:this.data.cp}),s.push({name:"pager[size]",value:this.data.limit}),this.data.sf&&(s.push({name:"sort[name]",value:this.data.sf}),this.data.dir?s.push({name:"sort[dir]",value:this.data.dir}):s.push({name:"sort[dir]",value:"d"})),null!==n.currentTreeNode&&(s.push({name:"parentId",value:n.currentTreeNode.attr("rel")}),n.currentTreeNode.find(".tt-folder").addClass("fa-spin")),t.ajax(n.source,{dataType:"html",element:n.table,data:s,method:"get"}).done(function(r){n.table.find('th input[type="checkbox"].grp').prop("checked",!1);var s=(r=t(r)).data("disableTree");if(n.isTree&&!s)if(n.currentTreeNode)r=r.find("tr"),n.initTree(r),n.currentTreeNode.after(r),n.currentTreeNode.data("loaded",!0),n.currentTreeNode.find(".tt-folder").removeClass("fa-spin "+n.folderCloseIcon).addClass(n.folderOpenIcon+" node-open"),i(n.currentTreeNode,n);else{var l=n.table.find("tbody");e.destroy(l),l.remove(),n.table.find("thead").after(r),n.initTree()}else{var d=n.table.find("tbody");e.destroy(d),d.remove(),n.table.find("thead").after(r),n.subTr()}if(t.isFunction(a)&&a(),n.pagerCtl&&t.isFunction(n.pagerCtl.pageIt)){var u=-1;if(o){var p=r.data("total");u=""===p?-1:parseInt(p||0,10)}n.pagerCtl.pageIt(u)}e.init(r)})}},a.prototype.form=function(t){if(!t)return this.searchForm;this.searchForm=t,this.initData()},a.prototype.pager=function(t){if(!t)return this.pagerCtl;this.pagerCtl=t},a.prototype.filter=function(t,e){if(void 0===e)this.table.find("tbody tr").show();else{var a="[data-field-"+t+'="'+e+'"]';this.table.find("tbody tr"+a).show(),this.table.find("tbody tr").not(a).hide()}},a.prototype.subTr=function(){if(!this.isTree){var e=this.table.find("tbody tr[rel]"),a=this.folderCloseIcon;e.length>0&&e.each(function(){t(this).find("td:first").prepend(t('<span class="tt-folder '+a+'"></span>'))})}},t.fn.wulatable=function(e){var i=Array.apply(null,arguments);return i.shift(),t(this).each(function(r,n){var s=t(n);if(s.data("tableObj")){var o=s.data("tableObj");"string"==typeof e&&"function"==typeof o[e]&&o[e].apply(o,i)}else new a(s)})};var i=function e(a,i){var r=a.attr("rel"),n=i.table,s=a.data("ttLevel")+1;a.data("childrenMoved")||(a.after(n.find('[parent="'+r+'"]')),a.data("childrenMoved",!0));var o=10*s+"px";n.find('[parent="'+r+'"]').each(function(a,r){var n=t(r),l=n.find("td:first span.tt-folder");n.data("ttLevel",s),n.find("td:first span.tt-line").css({"margin-left":o}),n.css({display:"table-row"}),l.hasClass("node-open")&&e(n,i)})},r=function e(a,i){var r=a.attr("rel");i.table.find('[parent="'+r+'"]').each(function(a,r){var n=t(r);e(n,i),n.css("display","none")})},n=function e(a,i){var r=a.attr("rel");i.table.find('[parent="'+r+'"]').each(function(a,r){var n=t(r);e(n,i),n.css("display","none").remove()})};t("body").on("wulaui.widgets.init",".wulaui",function(e){e.stopPropagation(),t(this).find("[data-table]").wulatable()})}($,wulaui),Ej=$,Hj=function(t){var e=t.data("tablePager");if(e){var a=Ej(e).data("pagerTarget");a&&(this.pagerTarget=a)}if(t.addClass("row"),this.pagerTarget&&Ej.isFunction(this.pagerTarget.pager)&&Ej.isFunction(this.pagerTarget.doPage)){this.pagerTarget.pager(this),this.element=t,this.total=parseInt(Ej(e).find("tbody").data("total")||0,10),this.limit=parseInt(t.data("limit")||20,10),this.pp=parseInt(t.data("pp")||5,10),this.current=1,this.limit||(this.limit=20),this.pp||(this.pp=5);var i=this,r=Ej('<section class="col-sm-12 col-md-7 col-lg-8 text-right"><ul class="pagination pagination-sm m-t-sm m-b-none"></ul></section>');if(void 0===t.data("hiddenTip")){this.tipElm=Ej('<section class="col-md-5 col-lg-4 visible-md-block visible-lg-block"><div class="m-t text-muted">每页&nbsp;<select></select>条&nbsp;共<span class="tp"></span>页<span class="tr"></span>条记录</div></section>');var n=this.tipElm.find("select");n.append(Ej('<option value="5">5</option>')),n.append(Ej('<option value="10">10</option>')),n.append(Ej('<option value="15">15</option>')),n.append(Ej('<option value="20">20</option>')),n.append(Ej('<option value="30">30</option>')),n.append(Ej('<option value="50">50</option>')),n.append(Ej('<option value="100">100</option>')),n.val(this.limit),this.tipElm.find(".tr").html(this.total),this.tipElm.appendTo(t),n.change(function(){i.limit=Ej(this).val(),i.current=1,i.pagerTarget.doPage(i.current,i.limit,!0,!0)})}else r.removeClass("col-md-7 col-lg-8");var s=this.pagerElm=r.find("ul");s.append('<li class="disabled p-f"><a href="#" rel="1"><i class="fa fa-fast-backward"></i></a></li>'),s.append('<li class="disabled p-p"><a href="#" rel="1"><i class="fa fa-backward"></i></a></li>');for(var o=1;o<=this.pp;o++)s.append('<li class="p-'+o+'"><a href="#" rel="'+o+'">'+o+"</a></li>");s.append('<li class="disabled p-n"><a href="#" rel="1"><i class="fa fa-forward"></i></a></li>'),s.append('<li class="disabled p-l"><a href="#" rel="1"><i class="fa fa-fast-forward"></i></a></li>'),r.appendTo(t),s.on("click","a",function(t){if(t.preventDefault(),!Ej(this).parents("li").hasClass("disabled")){var e=Ej(this).attr("rel");i.current=parseInt(e,10),i.pagerTarget.doPage(i.current,i.limit,!0)}return!1}),this.pagerTarget.doPage(i.current,i.limit),this.pageIt(this.total)}},Hj.prototype.pageIt=function(t){this.total=t>=0?t:this.total;var e=Math.ceil(this.total/this.limit),a=this.pagerElm;if(this.tipElm&&(this.tipElm.find(".tp").html(e),this.tipElm.find(".tr").html(this.total)),e<2)a.hide();else{a.show(),a.find("li").removeClass("disabled"),this.current>1?(a.find(".p-f").removeClass("disabled"),a.find(".p-p").removeClass("disabled").find("a").attr("rel",this.current-1)):(a.find(".p-f").addClass("disabled"),a.find(".p-p").addClass("disabled")),this.current===e?(a.find(".p-n").addClass("disabled"),a.find(".p-l").addClass("disabled")):(a.find(".p-l").removeClass("disabled").find("a").attr("rel",e),a.find(".p-n").removeClass("disabled").find("a").attr("rel",this.current+1));var i=Math.ceil(this.pp/2),r=0;if(e<this.pp)for(var n=this.pp;n>e;n--)a.find(".p-"+n).hide();this.current>=i&&(r=this.current-i-1),this.current+i>e&&(r=e-this.pp),r=Math.max(0,r);for(var s=1;s<=Math.min(this.pp,e);s++)a.find(".p-"+s).addClass("hidden-xs").css("display","inline").find("a").attr("rel",r+s).html(r+s);a.find("a[rel="+this.current+"]").parents("li").removeClass("hidden-xs").addClass("disabled")}},Ej.fn.wulaplgpager=function(){return Ej(this).each(function(t,e){var a=Ej(e);a.data("pagerObj")||a.data("pagerObj",new Hj(a))})},Ej("body").on("wulaui.table.init","table[data-table]",function(t){t.stopPropagation();var e=Ej(this).attr("id");e&&Ej('div[data-table-pager="#'+e+'"]').wulaplgpager()}),dk=$,dk.fn.wulaplgform=function(){return dk(this).each(function(t,e){var a=dk(e);a.data("formObj")||a.data("formObj",new function(t){var e=t.data("tableForm");if(e){var a=dk(e).data("formTarget");a&&dk.isFunction(a.form)&&dk.isFunction(a.reload)&&(a.form(t),t.submit(function(t){return t.preventDefault(),a.reload(null,!0),!1}))}}(a))})},dk("body").on("wulaui.table.init","table[data-table]",function(t){t.stopPropagation();var e=dk(this).attr("id");e&&dk('form[data-table-form="#'+e+'"]').wulaplgform()}),function($,wui){var defaultOpts={c:!1,runtimes:"html5",max_file_count:1,chunk_size:"256k",chunks:!0,multi_selection:!1,max_file_size:"28mb",filters:[{title:"*.*",extensions:"jpg,gif,png,jpeg"}]},PreviewFile=function(t,e){if(this.file=t,this.id=e,this.name=t.name,this.previewable=/.+\.(png|gif|jpg|jpeg|bmp)/i.test(this.name),this.previewable){var a=$(this.id).get(0),i=new FileReader;i.onload=function(t){a.src=t.target.result},i.readAsDataURL(this.file)}else $(this.id).attr("src",wui.config.assets+"dat.jpg")},nuiUploader=function nuiUploader(elem){elem.data("uploaderObj",this);var $this=this;this.element=elem,this.value=elem.data("value"),this.varName=elem.data("name"),this.auto=void 0!==elem.data("auto"),this.extensions=elem.data("exts")||"jpg,gif,png,jpeg",this.width=elem.data("width")||90,this.height=elem.data("height")||this.width,this.readonly=void 0!==elem.data("readonly"),this.whstyle="width:"+this.width+"px;height:"+this.height+"px;",this.isLocal=void 0!==elem.data("localStore");var opts={};this.extensions&&(opts.filters=[{title:"*.*",extensions:this.extensions}]);var cnt=elem.data("multi");this.multi=parseInt(cnt||"1",10)||1,this.multi>1?(opts.max_file_count=this.multi,opts.chunks=!0,opts.chunk_size="512k",opts.multi_selection=!0,this.varName+="[]"):this.multi=1,this.mfs=elem.data("maxFileSize"),this.mfs&&(opts.max_file_size=this.mfs);var resize=elem.data("resize");if(resize){var rss=resize.split(",");opts.resize={},opts.resize.width=rss[0],opts.resize.height=rss[0],opts.resize.preserve_headers=!1,rss.length>=2&&rss[1]&&(opts.resize.height=rss[1]),rss.length>=3&&rss[2]&&(opts.resize.quality=rss[2]),rss.length>=4&&rss[3]&&(opts.resize.crop=!0)}this.opts=$.extend({},defaultOpts,opts),this.noWatermark=elem.data("noWater"),void 0!==this.noWatermark&&(this.opts.multipart_params={nowater:1});var removeFile=function(){var t=$this.uploader,e=$(this).parent(),a=e.find("input").attr("id"),i=t.getFile(a);i&&(t.removeFile(i),$this.newFile--);var r=e.find("input").val();if(r){var n=$.Event("uploader.remove");$this.element.trigger(n,[r]),n.isDefaultPrevented()||(e.remove(),$this.uploadBtn.show())}else e.remove(),$this.uploadBtn.show();0===$this.wrapper.find("input").length&&$this.uploadBtn.append('<input type="hidden" id="empty-f-'+$this.id+'" name="'+$this.varName+'" value=""/>')},destroy=function t(){elem.off("form.placement"),$this.uploader&&($this.uploader.destroy(),$this.wrapper=null,elem.data("uploaderObj",null),$(this).off("wulaui.widgets.destroy",t),delete $this.uploader)};this.id=elem.attr("id"),this.btnId="uploadimg-"+this.id,this.wrapper=$('<ul class="upload-img-box clearfix"><li class="uploadimg-btn"><a href="javascript:void(0);" style="'+this.whstyle+'" id="'+this.btnId+'"></a></li></ul>'),elem.append(this.wrapper),this.uploadBtn=this.wrapper.find(".uploadimg-btn"),this.opts.browse_button="uploadimg-"+elem.attr("id"),this.opts.url=elem.data("uploader")||"";var uploader=new plupload.Uploader(this.opts);if(this.uploader=uploader,this.newFile=0,this.value){if(1===this.multi&&(this.value=[this.value]),$.isArray(this.value)){$.each(this.value,function(t,e){var a='<li id="up-file'+t+'">';a+='<img id="img_file'+t+'" src="'+($this.isLocal?wui.base(e):wui.media(e))+'" style="'+$this.whstyle+'"/>',$this.readonly||(a+="<i>×</i>"),a+='<input type="hidden" id="old-file'+t+'" name="'+$this.varName+'" value="'+e+'"/>';var i=$(a+="</li>");$this.uploadBtn.before(i),i.on("click","i",removeFile)});var imgNum=$this.wrapper.find("input").length;imgNum>=$this.multi&&$this.uploadBtn.hide()}}else this.uploadBtn.append('<input type="hidden" id="empty-f-'+this.id+'" name="'+this.varName+'" value=""/>');this.readonly&&this.uploadBtn.remove(),uploader.init(),uploader.bind("BeforeUpload",function(t,e){var a="#up-"+e.id;$(a+" .progress").show()}),uploader.bind("FilesAdded",function(t,e){var a=document.getElementById(t.id+"_"+t.runtime),i=void 0;for(var r in $this.uploadBtn.find("input").remove(),$this.auto&&t.disableBrowse(!0),e){if((i=$this.wrapper.find("input").length)+1>$this.multi){t.splice($this.newFile);break}var n=e[r],s=null;for(var o in a.files)a.files[o].name===n.name&&a.files[o].size===n.size&&(s=a.files[o]);if(s){$this.newFile++;var l='<li id="up-'+n.id+'">';l+='<img id="img_'+n.id+'" src="'+wui.config.assets+'s.gif" style="'+$this.whstyle+'"/>',l+='<div class="progress progress-xs" style="display:none;width: '+$this.width+'px"><div class="progress-bar progress-bar-info"></div></div>',l+="<span>"+(n.size/1e3).toFixed(1)+"K</span>",l+="<i>×</i>",l+='<input type="hidden" id="'+n.id+'" name="'+$this.varName+'"/>';var d=$(l+="</li>");$this.uploadBtn.before(d),new PreviewFile(s,"#img_"+n.id),d.on("click","i",removeFile)}}++i>=$this.multi&&$this.uploadBtn.hide(),$this.auto&&$this.newFile>0&&t.start()}),uploader.bind("UploadProgress",function(t,e){var a="#up-"+e.id;$(a+" .progress-bar").css("width",e.percent+"%")}),uploader.bind("FileUploaded",function(t,e,a){var i=e.id,r="#up-"+i;if(e.status===plupload.DONE){$(r+" .progress-bar").removeClass("progress-bar-info").addClass("progress-bar-success");try{var n=$.parseJSON(a.response).result;if(n){$(r+" input").val(n.url);try{$this.element.trigger("uploader.uploaded",[n])}catch(t){}}else $(r+" .progress-bar").removeClass("progress-bar-info").addClass("progress-bar-danger")}catch(t){$("#up-"+i+" .progress-bar").removeClass("progress-bar-info").addClass("progress-bar-danger"),wui.toast.error(t.message)}}else $("#up-"+i+" .progress-bar").removeClass("progress-bar-info").addClass("progress-bar-danger")}),uploader.bind("UploadComplete",function(t){t.disableBrowse(!1),$this.newFile=0,t.splice(0),t.refresh(),$this.element.trigger("uploader.done")}),uploader.bind("Error",function(up,file){up.disableBrowse(!1);var id=file.file?file.file.id:file.id;if($("#up-"+id+" .progress-bar").removeClass("progress-bar-info").addClass("progress-bar-danger"),file.response)try{var result=eval("("+file.response+")"),rst=result.error;wui.toast.error(rst.message)}catch(t){console.log(t)}else file.message&&wui.toast.error(file.message);$this.element.trigger("uploader.error")}),elem.closest(".wulaui").on("wulaui.widgets.destroy",destroy)};nuiUploader.prototype.start=function(){this.newFile>0?this.uploader.start():this.element.trigger("uploader.done")},nuiUploader.prototype.stop=function(){this.uploader.stop()},nuiUploader.prototype.get=function(){return this.uploader},nuiUploader.prototype.clear=function(){this.wrapper.find("li").not(this.uploadBtn).find("i").click(),this.uploader.splice(0),this.uploader.refresh(),this.uploader.disableBrowse(!1),this.uploadBtn.show()},$.fn.wulauploader=function(){var t=Array.apply(null,arguments);return t.shift(),$(this).each(function(e,a){var i=$(a);if(i.data("uploaderObj")){var r=i.data("uploaderObj");"string"==typeof option&&"function"==typeof r[option]&&r[option].apply(r,t)}else new nuiUploader(i)})},$("body").on("wulaui.widgets.init",".wulaui",function(t){t.stopPropagation();var e=$(this).find("[data-uploader]");e.length>0&&(window.plupload?e.wulauploader():layui.use("plupload",function(){e.wulauploader()}))})}($,wulaui),function(t,e){t.fn.wulapopmenu=function(){return t(this).each(function(e,i){var r=t(i);r.data("popMenuObj")||r.data("popMenuObj",new a(r))})};var a=function(e){this.target=e.data("popMenu"),this.arg=e.data("popArg")||"id";var a=this;this.target&&e.find("[data-id]").hover(function(){var e=t(this),i=e.data("popToolbar"),r=e.data("id");return i||(i=t(a.target).clone(!0),e.data("popToolbar",i),i.css({position:"absolute",right:5,bottom:5,padding:0,margin:0}).find("[data-ajax]").on("ajax.build",function(t){t.opts&&t.opts.url&&(t.opts.url=t.opts.url+(t.opts.url.indexOf("?")>0?"&":"?")+a.arg+"="+r)}),i.appendTo(e)),i.show(),!1},function(){var e=t(this).data("popToolbar");return e&&e.hide(),!1})};t("body").on("wulaui.widgets.init",".wulaui",function(e){e.stopPropagation(),t(this).find("[data-pop-menu]").wulapopmenu()})}($),El=$,Fl=function(t){var e=this;this.combox=t,t.data("comboxObj",this);var a={allowClear:!0};if(this.isTagMode=void 0!==t.data("tagMode"),this.parent=t.data("parent"),this.url=t.data("combox"),this.multiple=void 0!==t.data("multi"),this.multiple&&t.data("multi")&&(a.maximumSelectionSize=parseInt(t.data("multi"),10)),a.placeholder=t.attr("placeholder")||"",a.allowClear="false"!==t.data("allowClear")&&a.allowClear,a.minimumInputLength=t.data("mnl")?parseInt(t.data("mnl"),10):0,this.isTagMode&&this.multiple&&(a.separator=",",a.tokenSeparators=[","," "],a.tokenizer=function(t,a,i,r){if(t.length>1){var n=t.length,s=t.substring(n-1,n);if(","===s||" "===s){var o=a.length;t=t.replace(/[, ]+$/g,"");for(var l=0;l<o;l++)if(t===a[l].id)return void e.comboxObj.select2("close");i({id:t,text:t})}}}),t.is("select")||(a.multiple=this.multiple,a.initSelection=function(t,a){var i=El(t).val(),r=null,n=void 0,s=[];if(r=e.multiple?[{id:"",text:""}]:{id:"",text:""},i){if(e.multiple)for(var o in r=[],i=i.split(","))(n=i[o].split(":")).length>1?r.push({id:n[0],text:n[1]}):r.push({id:n[0],text:n[0]}),s.push(n[0]);else r=(i=i.split(":")).length>1?{id:i[0],text:i[1]}:{id:i[0],text:i[0]},s.push(i[0]);El(t).attr("value",s.join(","))}a(r)}),this.url&&(a.ajax={quietMillis:100,cache:!0,data:function(t,a){var i={q:t,_cp:a};return e.parent&&(i.p=El("#"+e.parent).val()),i},dataType:"json",url:this.url,results:function(t,e){return t.results?t:{results:t,more:!1}}}),this.options=a,this.comboxObj=t.select2(this.options),this.parent){var i=El("#"+this.parent);i.length>0&&i.change(function(){e.setValue()})}},Fl.prototype.getComboxObj=function(){return this.comboxObj},Fl.prototype.getCombox=function(){return this.combox},Fl.prototype.setValue=function(t){t||(t=this.multiple?null:""),this.combox.select2("val",t,!0)},El.fn.wulauiCombox2=function(){return El(this).each(function(t,e){var a=El(e);a.data("comboxObj")||new Fl(a)})},El("body").on("wulaui.widgets.init",".wulaui",function(t){t.stopPropagation();var e=El(this).find("[data-combox]");e.length>0&&(El.fn.select2?e.wulauiCombox2():layui.use("select2",function(){e.wulauiCombox2()}))}),lm=$,lm.fn.wulauiDatepicker=function(){return lm(this).each(function(t,e){var a=lm(e);if(!a.data("DatepickerObj")){a.data("DatepickerObj",!0);var i={format:a.data("format")||"yyyy-mm-dd",clearBtn:!0,daysOfWeekHighlighted:"0,6",calendarWeeks:!0,autoclose:!0,todayHighlight:!0},r=a.data("start"),n=a.data("end"),s=a.data("startday"),o=a.data("endday"),l=a.data("dwd"),d=a.data("disabled");s&&(i.startDate=s),o&&(i.endDate=o),d&&(i.datesDisabled=d),l&&(i.daysOfWeekDisabled=l),a.datepicker(i),r?(r=lm(r)).length&&r.change(function(){a.datepicker("setStartDate",lm(this).val())}).change():n&&(n=lm(n)).length&&n.change(function(){a.datepicker("setEndDate",lm(this).val())}).change()}})},lm.fn.wulauiTimepicker=function(){return lm(this).each(function(t,e){var a=lm(e);if(!a.data("TimepickerObj")){a.data("TimepickerObj",1);var i=a.attr("for");if(i){var r=(i=lm(i)).val().split(":");0===r.length?r=["00","00"]:1===r.length&&r.push("00"),a.find(".hour").on("change",function(){r[0]=lm(this).val(),i.val(r.join(":"))}).val(r[0]),a.find(".minute").on("change",function(){r[1]=lm(this).val(),i.val(r.join(":"))}).val(r[1])}}})},lm("body").on("wulaui.widgets.init",".wulaui",function(t){t.stopPropagation();var e=lm(this).find("[data-datepicker]");e.length>0&&(lm.fn.datepicker?e.wulauiDatepicker():layui.use("datepicker",function(){e.wulauiDatepicker()}));var a=lm(this).find("[data-timepicker]");a.length>0&&a.wulauiTimepicker()}),Hm=$,Im=function(t){var e=this;this.settings={view:{},callback:{},edit:{drap:{}},data:{keep:{},key:{},simpleData:{}},check:{}},this.url=t.data("ztree"),this.lazy=void 0!==t.data("lazy"),t.addClass("ztree"),this.url&&(this.settings.async={enable:!0,url:this.url,type:"get",dataType:"json",autoParam:["id"]}),t.on("ztree.setting.load",function(){var a=Hm.Event("ztree.init");a.tree=e,t.trigger(a),e.settings=a.tree.settings,e.nodes=a.tree.nodes,a.isDefaultPrevented()||(e.treeObj=Hm.fn.zTree.init(t,e.settings,e.nodes),t.trigger("ztree.ready",[e.treeObj])),t.off("ztree.setting.load")}).closest(".wulaui").on("wulaui.widgets.destroy",e.destroy),this.lazy&&!t.data("treeEventBind")||t.trigger("ztree.setting.load")},Im.prototype.destroy=function(){this.treeObj&&(this.treeObj.destroy(),delete this.treeObj,Hm(this).off("wulaui.widgets.destroy",this.destroy))},Hm.fn.wulatree=function(t){return Hm(this).each(function(){var e=Hm(this);if("load"===t)e.data("treeObj")?e.trigger("ztree.setting.load"):e.data("treeEventBind",!0);else if("destroy"===t){var a=e.data("treeObj");a&&(e.data("treeObj",null),a.destroy(),a=null)}else e.data("treeObj")||e.data("treeObj",new Im(e))})},Hm("body").on("wulaui.widgets.init",".wulaui",function(t){t.stopPropagation();var e=Hm(this).find("[data-ztree]");e.length>0&&layui.use("ztree",function(){e.wulatree()})}),Sm=$,Tm=wulaui,Um=function(t){var e=this,a=layui.upload;this.form=t.closest("form"),this.targetId=t.attr("for"),this.target=Sm(this.targetId),this.parent=t.closest("div.wysiwyg"),this.mode="edit",this.readonly=t.data("readonly"),void 0!==this.form.data("ajax")?this.form.on("ajax.before",function(){e.target.val(t.html())}):this.form.on("submit",function(){e.target.val(t.html())}),t.data("wysiwygObj",this),this.element=t,this.parent.on("click","a[data-act]",function(){var t=Sm(this).data("act");e[t]&&e[t].apply(e)}).on("click",".ins-pic",function(){var t=Sm(this).closest(".input-group").find(".form-control"),a=t.val();t.val(""),a&&e.exec("insertImage",a)}),this.readonly||(this.editor=t.wysiwyg({toolbarSelector:this.targetId+"-editor-toolbar"}),a.render({elem:this.targetId+"-uploader",url:Tm.app("media/ins"),exts:"jpg|png|gif|jpeg",done:function(t){if(1===t.done){var a='<img src="'+Tm.media(t.result.url)+'" style="width:'+(t.result.width>=800?"100%":t.result.width+"px")+';height: auto;border:0"/>';e.exec("insertHtml",a)}},accept:"images",multiple:!0})),t.data("wysiwygObj",this.editor)},Um.prototype.exec=function(t,e){this.editor&&(this.editor.restoreSelection(),this.element.focus(),this.editor.execCommand(t,e,this.element),this.editor.saveSelection())},Um.prototype.source=function(){this.element.find("a,img").removeAttr("data-original-title").popover("destroy"),"edit"===this.mode?(this.mode="source",this.element.addClass("hidden"),this.target.val(this.element.html()).removeClass("hidden"),this.parent.find(".btn-toolbar .btn-group").not(".source").hide()):(this.mode="edit",this.target.addClass("hidden"),this.element.html(this.target.val()).removeClass("hidden"),this.parent.find(".btn-toolbar .btn-group").show())},Um.prototype.pager=function(){this.editor&&this.exec("insertHtml","<hr/><div><br/></div>")},Sm("body").on("wulaui.widgets.init",".wulaui",function(t){t.stopPropagation();var e=Sm(this).find("[data-wysiwyg]");e.length>0&&layui.use(["upload","wysiwyg"],function(){e.each(function(t,e){var a=Sm(e);a.data("wysiwygObj")||new Um(a)})})}),wulaui.init(),exports("wulaui",wulaui)});