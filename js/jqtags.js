layui.define(["jquery","layer"],function(t){var a=layui.jquery,d=layui.layer,n="",i=function(){};i.prototype.init=function(){var t=this;a(".tag-defined:not([tag-bind]),.tag:not([tag-bind])").each(function(){t.setBind(a(this)),a(this).bind("click",{tags:t},t.click)})},i.prototype.setBind=function(t){t.attr("tag-bind",1)},i.prototype.addTag=function(t){var i=a.trim(t.val());if(""!=i){if(0<=i.indexOf(","))return d.msg('标签不能包含","'),void(n=i);if(0<=i.indexOf("|"))return d.msg('标签不能包含"|"'),void(n=i);if(10<i.length)return d.msg("您最多只能输入10个字符"),void(n=i);if(Number(i))return d.msg("标签不能纯数字"),void(n="");var e='<div class="tag" data-id="0"><p class="text">'+i+'</p><p class="tick-box"><span class="tick-bg"></span><i class="iconfont tick">&#xe6a1;</i></p></div>';t.parent("div.tag-defined").before(e).empty().css({padding:"0 20px"}).html("自定义标签").prev(".tag").bind("click",{tags:this},this.click).trigger("click"),n=""}else t.parent("div").empty().css({padding:"0 20px"}).html("自定义标签")},i.prototype.text=function(t){var i=this,e=a('<input type="text" />').css({width:"112px",height:"36px",border:"none",outline:"none","text-align":"center"});t.css({padding:"0"}).html(e),e.focus().val(n),e.blur(function(){i.addTag(a(this))}),e.keyup(function(t){if(13==t.which)return i.addTag(a(this)),!1})},i.prototype.click=function(t){_tags=t.data.tags,null==a(this).attr("data-id")?_tags.text(a(this)):_tags.select(a(this))},i.prototype.select=function(t){var i=t.attr("data-id")+"|"+a.trim(t.find(".text").text());t.hasClass("tag-selected")?(t.removeClass("tag-selected"),t.find(".tick-box").hide(),this.setval(t,i,"del")):(t.addClass("tag-selected"),t.find(".tick-box").show(),this.setval(t,i,"add"))},i.prototype.setval=function(t,i,e){var a=t.parent("div.layui-input-block").find("input[type=hidden]"),n=a.val();if(t.parent("div.layui-input-block").find(".tag-selected").length>parseInt(a.data("count")))return d.msg("最多只能选择5个标签"),t.removeClass("tag-selected"),void t.find(".tick-box").hide();if(""!=n){var s=n.split(",");"del"==e?s.remove(i):s.push(i),i=s.join(",")}a.val(i)},Array.prototype.indexOf=function(t){for(var i=0;i<this.length;i++)if(this[i]==t)return i;return-1},Array.prototype.remove=function(t){var i=this.indexOf(t);-1<i&&this.splice(i,1)};var e=new i;e.init(),t("jqtags",e)});