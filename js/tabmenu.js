layui.define(["jquery","jqelem"],function(t){var c=layui.jquery,d=layui.jqelem,e=function(){this.config={item:".jqadmin-tab-box",closed:!0,showIcon:!0}},h={};e.prototype.set=function(t){return"string"==typeof t&&""!=t?this.config.item=t:"object"==typeof t&&c.extend(!0,this.config,t),this},e.prototype.init=function(){var t=this.config,e=c(""+t.item),i=e.attr("lay-filter");return void 0!==i&&""!==i||console.log("错误:请设置Tab菜单选项卡属性lay-filter过滤器"),h.titleBox=e.children("ul.layui-tab-title"),h.contentBox=e.children("div.layui-tab-content"),h.tabFilter=i,this},e.prototype.exited=function(t){var i=-1,n=t.href;return void 0===h.titleBox&&this.init(),h.titleBox.find("li").each(function(t,e){c(this).children("em").data("href")===n&&(i=c(this).attr("lay-id"))}),i},e.prototype.tabAdd=function(t,e,i){var n=this.exited(t),a=this,o=t.cls||"iconfont",r=!1!==i;if(t.cls=o,-1===n){var l=t.layId?t.layId:(new Date).getTime(),s='<iframe src="'+t.href+'" data-id="'+l+'" class="jqadmin-iframe"></iframe>',f="";a.config.showIcon?f+='<i class="'+o+'">'+t.icon+"</i>":f+='<i class="'+o+' hide-icon">'+t.icon+"</i>",f+='<em data-href="'+t.href+'">'+t.title+"</em>",this.config.closed&&(f+='<i class="layui-icon layui-unselect layui-tab-close" data-id="'+l+'">&#9747;</i>'),d.tabAdd(h.tabFilter,{title:f,content:s,id:l,cls:o}),t.nodo||(t.layId=l,a.storage(t,"add")),r&&a.effect(l),this.config.closed&&h.titleBox.find("li").children("i.layui-tab-close[data-id="+l+"]").on("click",function(){d.tabDelete(h.tabFilter,c(this).parent("li").attr("lay-id"),t.parent),a.tabMove(1,1),d.init(),a.storage(t,"close")}),r&&(this.tabMove(n,0),d.tabChange(h.tabFilter,l))}else d.tabChange(h.tabFilter,n),a.storage(t,"change"),this.tabMove(n,0),e&&a.fresh(n)},e.prototype.active=function(t){var e=this.exited(t);0<=e&&(d.tabChange(h.tabFilter,e),this.tabMove(e,0))},e.prototype.effect=function(t,e){var i=layer.load(2);e?(h.contentBox.find("iframe[data-id="+t+"]").css({opacity:"0","margin-top":"50px"}).delay(200).animate({opacity:"1",marginTop:"0"},200),layer.close(i)):h.contentBox.find("iframe[data-id="+t+"]").css({opacity:"0","margin-top":"50px"}).load(function(){c(this).delay(100).animate({opacity:"1",marginTop:"0"},200),layer.close(i)})},e.prototype.storage=function(t,e){if(null==t.title&&"all"!=e)return!1;var i=window.sessionStorage||{removeItem:function(){}},n=JSON.stringify(t);if("add"==e)if(i.menu){(o=(o=i.menu).split("<-!->")).remove(n),o.push(n);var a=o.join("<-!->");i.menu=a}else i.menu=n;else if("all"==e)i.removeItem("curMenu"),i.removeItem("menu");else{var o;if(!(o=i.menu))return;if(o=o.split("<-!->"),"close"==e){for(index in o)if("remove"!=index){if("string"==typeof o[index])a=JSON.parse(o[index]);a.layId==t.layId&&o.splice(index,1)}i.menu=o.join("<-!->"),i.removeItem("curMenu")}else{for(index in o)if("remove"!=index){if("string"==typeof o[index])a=JSON.parse(o[index]);if(a.layId==t.layId){n=o[index];break}}"other"==e&&(i.menu=n)}}},e.prototype.fresh=function(t,e){if(t){e&&d.tabChange(h.tabFilter,t);var i=h.titleBox.find('>li[lay-id="'+t+'"]'),n=i.parent().children("li").index(i),a=i.parents(".layui-tab").eq(0).children(".layui-tab-content").children(".layui-tab-item"),o=a.eq(n).find("iframe").attr("src");a.eq(n).find("iframe").attr("src",o)}},e.prototype.close=function(t){var e=t.href.substring(t.origin.length),i=this.exited({href:e});if(i){var n={layId:i};d.tabDelete(h.tabFilter,i),this.tabMove(1,1),d.init(),n.title="",this.storage(n,"close")}},e.prototype.reload=function(t){var e=this.exited({href:t});e&&this.fresh(e,!1)},e.prototype.tabMove=function(t,e){var i=parseInt(h.titleBox.parent("div").width()),n=h.titleBox.find("li"),a=0;if(n[0])if(n.each(function(t,e){a+=c(e).outerWidth(!0)}),i+1<a){c(".tab-move-btn").show();var o=i-a;if(o<45){if(0<=t){var r=0;try{r=parseInt(h.titleBox.find(".layui-this").position().left)}catch(t){}var l=parseInt(h.titleBox.css("marginLeft"));if(r+parseInt(l)<=45)o=45-r;else if(-(l-i+parseInt(h.titleBox.find(".layui-this").outerWidth(!0))+r)<=0)o=i-r-parseInt(h.titleBox.find(".layui-this").outerWidth(!0));else{if(!(1==e&&parseInt(l)<0))return;45<(o=i-r-parseInt(h.titleBox.find(".layui-this").outerWidth(!0)))&&(o=45)}}h.titleBox.css({marginLeft:o})}}else c(".tab-move-btn").hide(),h.titleBox.css({marginLeft:45})},Array.prototype.indexOf=function(t){for(var e=0;e<this.length;e++)if(this[e]==t)return e;return-1},Array.prototype.remove=function(t){var e=this.indexOf(t);-1<e&&this.splice(e,1)},t("tabmenu",function(t){return(new e).set(t)})});