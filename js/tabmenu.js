layui.define(["jquery","jqelem"],function(t){var e=layui.jquery,i=layui.jqelem,n=function(){this.config={item:".jqadmin-tab-box",closed:!0,showIcon:!0}},a={};n.prototype.set=function(t){return"string"==typeof t&&""!=t?this.config.item=t:"object"==typeof t&&e.extend(!0,this.config,t),this},n.prototype.init=function(){var t=this.config,i=e(""+t.item),n=i.attr("lay-filter");return void 0!==n&&""!==n||console.log("错误:请设置Tab菜单选项卡属性lay-filter过滤器"),a.titleBox=i.children("ul.layui-tab-title"),a.contentBox=i.children("div.layui-tab-content"),a.tabFilter=n,this},n.prototype.exited=function(t){var i=-1,n=t.href;return void 0===a.titleBox&&this.init(),a.titleBox.find("li").each(function(t,a){e(this).children("em").data("href")===n&&(i=e(this).attr("lay-id"))}),i},n.prototype.tabAdd=function(t,n,o){var r=this.exited(t),l=this,s=t.cls||"iconfont",f=!1!==o;if(t.cls=s,-1===r){var c=t.layId?t.layId:(new Date).getTime(),d='<iframe src="'+t.href+'" data-id="'+c+'" class="jqadmin-iframe"></iframe>',h="";l.config.showIcon?h+='<i class="'+s+'">'+t.icon+"</i>":h+='<i class="'+s+' hide-icon">'+t.icon+"</i>",h+='<em data-href="'+t.href+'">'+t.title+"</em>",this.config.closed&&(h+='<i class="layui-icon layui-unselect layui-tab-close" data-id="'+c+'">&#9747;</i>'),i.tabAdd(a.tabFilter,{title:h,content:d,id:c,cls:s}),t.nodo||(t.layId=c,l.storage(t,"add")),f&&l.effect(c),this.config.closed&&a.titleBox.find("li").children("i.layui-tab-close[data-id="+c+"]").on("click",function(){i.tabDelete(a.tabFilter,e(this).parent("li").attr("lay-id"),t.parent),l.tabMove(1,1),i.init(),l.storage(t,"close")}),f&&(this.tabMove(r,0),i.tabChange(a.tabFilter,c))}else i.tabChange(a.tabFilter,r),l.storage(t,"change"),this.tabMove(r,0),n&&l.fresh(r)},n.prototype.active=function(t){var e=this.exited(t);e>=0&&(i.tabChange(a.tabFilter,e),this.tabMove(e,0))},n.prototype.effect=function(t,i){var n=layer.load(2);i?(a.contentBox.find("iframe[data-id="+t+"]").css({opacity:"0","margin-top":"50px"}).delay(200).animate({opacity:"1",marginTop:"0"},200),layer.close(n)):a.contentBox.find("iframe[data-id="+t+"]").css({opacity:"0","margin-top":"50px"}).load(function(){e(this).delay(100).animate({opacity:"1",marginTop:"0"},200),layer.close(n)})},n.prototype.storage=function(t,e){if(null==t.title&&"all"!=e)return!1;var i=window.sessionStorage||{removeItem:function(){}},n=JSON.stringify(t);if("add"==e)if(i.menu){(o=(o=i.menu).split("<-!->")).remove(n),o.push(n);var a=o.join("<-!->");i.menu=a}else i.menu=n;else if("all"==e)i.removeItem("curMenu"),i.removeItem("menu");else{var o;if(!(o=i.menu))return;if(o=o.split("<-!->"),"close"==e){for(index in o)if("remove"!=index){if("string"==typeof o[index])a=JSON.parse(o[index]);a.layId==t.layId&&o.splice(index,1)}i.menu=o.join("<-!->"),i.removeItem("curMenu")}else{for(index in o)if("remove"!=index){if("string"==typeof o[index])a=JSON.parse(o[index]);if(a.layId==t.layId){n=o[index];break}}"other"==e&&(i.menu=n)}}},n.prototype.fresh=function(t,e){if(t){e&&i.tabChange(a.tabFilter,t);var n=a.titleBox.find('>li[lay-id="'+t+'"]'),o=n.parent().children("li").index(n),r=n.parents(".layui-tab").eq(0).children(".layui-tab-content").children(".layui-tab-item"),l=r.eq(o).find("iframe").attr("src");r.eq(o).find("iframe").attr("src",l)}},n.prototype.close=function(t){var e=t.href.substring(t.origin.length),n=this.exited({href:e});if(n){var o={layId:n};i.tabDelete(a.tabFilter,n),this.tabMove(1,1),i.init(),o.title="",this.storage(o,"close")}},n.prototype.reload=function(t){var e=this.exited({href:t});e&&this.fresh(e,!1)},n.prototype.tabMove=function(t,i){var n=parseInt(a.titleBox.parent("div").width()),o=a.titleBox.find("li"),r=0;if(o[0])if(o.each(function(t,i){r+=e(i).outerWidth(!0)}),r>n+1){e(".tab-move-btn").show();var l=n-r;if(l<45){if(t>=0){var s=0;try{s=parseInt(a.titleBox.find(".layui-this").position().left)}catch(t){}var f=parseInt(a.titleBox.css("marginLeft"));if(s+parseInt(f)<=45)l=45-s;else if(-(f-n+parseInt(a.titleBox.find(".layui-this").outerWidth(!0))+s)<=0)l=n-s-parseInt(a.titleBox.find(".layui-this").outerWidth(!0));else{if(!(1==i&&parseInt(f)<0))return;(l=n-s-parseInt(a.titleBox.find(".layui-this").outerWidth(!0)))>45&&(l=45)}}a.titleBox.css({marginLeft:l})}}else e(".tab-move-btn").hide(),a.titleBox.css({marginLeft:45})},Array.prototype.indexOf=function(t){for(var e=0;e<this.length;e++)if(this[e]==t)return e;return-1},Array.prototype.remove=function(t){var e=this.indexOf(t);e>-1&&this.splice(e,1)},t("tabmenu",function(t){return(new n).set(t)})});