layui.define(["jquery","ztree"],function(e){var t=layui.$,o={event:{DRAG:"ztree_drag",DROP:"ztree_drop",RENAME:"ztree_rename",DRAGMOVE:"ztree_dragmove"},id:{EDIT:"_edit",INPUT:"_input",REMOVE:"_remove"},move:{TYPE_INNER:"inner",TYPE_PREV:"prev",TYPE_NEXT:"next"},node:{CURSELECTED_EDIT:"curSelectedNode_Edit",TMPTARGET_TREE:"tmpTargetzTree",TMPTARGET_NODE:"tmpTargetNode"}},r={onHoverOverNode:function(e,t){var o=s.getSetting(e.data.treeId),d=s.getRoot(o);d.curHoverNode!=t&&r.onHoverOutNode(e),d.curHoverNode=t,l.addHoverDom(o,t)},onHoverOutNode:function(e,t){var o=s.getSetting(e.data.treeId),r=s.getRoot(o);r.curHoverNode&&!s.isSelectedNode(o,r.curHoverNode)&&(l.removeTreeDom(o,r.curHoverNode),r.curHoverNode=null)},onMousedownNode:function(e,r){var d,n,u=s.getSetting(e.data.treeId),N=s.getRoot(u),v=s.getRoots();if(2==e.button||!u.edit.enable||!u.edit.drag.isCopy&&!u.edit.drag.isMove)return!0;var g=e.target,p=s.getRoot(u).curSelectedList,m=[];if(s.isSelectedNode(u,r))for(d=0,n=p.length;d<n;d++){if(p[d].editNameFlag&&a.eqs(g.tagName,"input")&&null!==g.getAttribute("treeNode"+i.id.INPUT))return!0;if(m.push(p[d]),m[0].parentTId!==p[d].parentTId){m=[r];break}}else m=[r];l.editNodeBlur=!0,l.cancelCurEditNode(u);var T,f,E,I,h,b=t(u.treeObj.get(0).ownerDocument),R=t(u.treeObj.get(0).ownerDocument.body),P=!1,w=u,M=u,C=null,_=null,O=null,D=i.move.TYPE_INNER,y=e.clientX,k=e.clientY,S=(new Date).getTime();function A(e){if(0==N.dragFlag&&Math.abs(y-e.clientX)<u.edit.drag.minMoveSize&&Math.abs(k-e.clientY)<u.edit.drag.minMoveSize)return!0;var r,d,n,g,p,M=u.data.key.children;if(R.css("cursor","pointer"),0==N.dragFlag){if(0==a.apply(u.callback.beforeDrag,[u.treeId,m],!0))return L(e),!0;for(r=0,d=m.length;r<d;r++)0==r&&(N.dragNodeShowBefore=[]),(n=m[r]).isParent&&n.open?(l.expandCollapseNode(u,n,!n.open),N.dragNodeShowBefore[n.tId]=!0):N.dragNodeShowBefore[n.tId]=!1;N.dragFlag=1,v.showHoverDom=!1,a.showIfameMask(u,!0);var A=!0,Y=-1;if(m.length>1){var x=m[0].parentTId?m[0].getParentNode()[M]:s.getNodes(u);for(p=[],r=0,d=x.length;r<d;r++)if(void 0!==N.dragNodeShowBefore[x[r].tId]&&(A&&Y>-1&&Y+1!==r&&(A=!1),p.push(x[r]),Y=r),m.length===p.length){m=p;break}}for(A&&(I=m[0].getPreNode(),h=m[m.length-1].getNextNode()),T=c("<ul class='zTreeDragUL'></ul>",u),r=0,d=m.length;r<d;r++)(n=m[r]).editNameFlag=!1,l.selectNode(u,n,r>0),l.removeTreeDom(u,n),r>u.edit.drag.maxShowNodeNum-1||((g=c("<li id='"+n.tId+"_tmp'></li>",u)).append(c(n,i.id.A,u).clone()),g.css("padding","0"),g.children("#"+n.tId+i.id.A).removeClass(i.node.CURSELECTED),T.append(g),r==u.edit.drag.maxShowNodeNum-1&&(g=c("<li id='"+n.tId+"_moretmp'><a>  ...  </a></li>",u),T.append(g)));T.attr("id",m[0].tId+i.id.UL+"_tmp"),T.addClass(u.treeObj.attr("class")),T.appendTo(R),(f=c("<span class='tmpzTreeMove_arrow'></span>",u)).attr("id","zTreeMove_arrow_tmp"),f.appendTo(R),u.treeObj.trigger(i.event.DRAG,[e,u.treeId,m])}if(1==N.dragFlag){if(E&&f.attr("id")==e.target.id&&O&&e.clientX+b.scrollLeft()+2>t("#"+O+i.id.A,E).offset().left){var j=t("#"+O+i.id.A,E);e.target=j.length>0?j.get(0):e.target}else E&&(E.removeClass(i.node.TMPTARGET_TREE),O&&t("#"+O+i.id.A,E).removeClass(i.node.TMPTARGET_NODE+"_"+i.move.TYPE_PREV).removeClass(i.node.TMPTARGET_NODE+"_"+o.move.TYPE_NEXT).removeClass(i.node.TMPTARGET_NODE+"_"+o.move.TYPE_INNER));E=null,O=null,P=!1,w=u;var z=s.getSettings();for(var B in z)z[B].treeId&&z[B].edit.enable&&z[B].treeId!=u.treeId&&(e.target.id==z[B].treeId||t(e.target).parents("#"+z[B].treeId).length>0)&&(P=!0,w=z[B]);var H=b.scrollTop(),F=b.scrollLeft(),V=w.treeObj.offset(),U=w.treeObj.get(0).scrollHeight,G=w.treeObj.get(0).scrollWidth,X=e.clientY+H-V.top,q=w.treeObj.height()+V.top-e.clientY-H,W=e.clientX+F-V.left,K=w.treeObj.width()+V.left-e.clientX-F,$=X<u.edit.drag.borderMax&&X>u.edit.drag.borderMin,Z=q<u.edit.drag.borderMax&&q>u.edit.drag.borderMin,J=W<u.edit.drag.borderMax&&W>u.edit.drag.borderMin,Q=K<u.edit.drag.borderMax&&K>u.edit.drag.borderMin,ee=X>u.edit.drag.borderMin&&q>u.edit.drag.borderMin&&W>u.edit.drag.borderMin&&K>u.edit.drag.borderMin,te=$&&w.treeObj.scrollTop()<=0,oe=Z&&w.treeObj.scrollTop()+w.treeObj.height()+10>=U,re=J&&w.treeObj.scrollLeft()<=0,de=Q&&w.treeObj.scrollLeft()+w.treeObj.width()+10>=G;if(e.target&&a.isChildOrSelf(e.target,w.treeId)){for(var ne=e.target;ne&&ne.tagName&&!a.eqs(ne.tagName,"li")&&ne.id!=w.treeId;)ne=ne.parentNode;var ae=!0;for(r=0,d=m.length;r<d;r++){if(n=m[r],ne.id===n.tId){ae=!1;break}if(c(n,u).find("#"+ne.id).length>0){ae=!1;break}}ae&&e.target&&a.isChildOrSelf(e.target,ne.id+i.id.A)&&(E=t(ne),O=ne.id)}n=m[0],ee&&a.isChildOrSelf(e.target,w.treeId)&&(!E&&(e.target.id==w.treeId||te||oe||re||de)&&(P||!P&&n.parentTId)&&(E=w.treeObj),$?w.treeObj.scrollTop(w.treeObj.scrollTop()-10):Z&&w.treeObj.scrollTop(w.treeObj.scrollTop()+10),J?w.treeObj.scrollLeft(w.treeObj.scrollLeft()-10):Q&&w.treeObj.scrollLeft(w.treeObj.scrollLeft()+10),E&&E!=w.treeObj&&E.offset().left<w.treeObj.offset().left&&w.treeObj.scrollLeft(w.treeObj.scrollLeft()+E.offset().left-w.treeObj.offset().left)),T.css({top:e.clientY+H+3+"px",left:e.clientX+F+3+"px"});var ie=0,le=0;if(E&&E.attr("id")!=w.treeId){var se=function(){E=null,O="",D=i.move.TYPE_INNER,f.css({display:"none"}),window.zTreeMoveTimer&&(clearTimeout(window.zTreeMoveTimer),window.zTreeMoveTargetNodeTId=null)},ce=null==O?null:s.getNodeCache(w,O),ue=(e.ctrlKey||e.metaKey)&&u.edit.drag.isMove&&u.edit.drag.isCopy||!u.edit.drag.isMove&&u.edit.drag.isCopy,Ne=!(!I||O!==I.tId),ve=!(!h||O!==h.tId),ge=n.parentTId&&n.parentTId==O,pe=(ue||!ve)&&a.apply(w.edit.drag.prev,[w.treeId,m,ce],!!w.edit.drag.prev),me=(ue||!Ne)&&a.apply(w.edit.drag.next,[w.treeId,m,ce],!!w.edit.drag.next),Te=(ue||!ge)&&!(w.data.keep.leaf&&!ce.isParent)&&a.apply(w.edit.drag.inner,[w.treeId,m,ce],!!w.edit.drag.inner);if(pe||me||Te){var fe=t("#"+O+i.id.A,E),Ee=ce.isLastNode?null:t("#"+ce.getNextNode().tId+i.id.A,E.next()),Ie=fe.offset().top,he=fe.offset().left,be=pe?Te?.25:me?.5:1:-1,Re=me?Te?.75:pe?.5:0:-1,Pe=(e.clientY+H-Ie)/fe.height();if((1==be||Pe<=be&&Pe>=-.2)&&pe?(ie=1-f.width(),le=Ie-f.height()/2,D=i.move.TYPE_PREV):(0==Re||Pe>=Re&&Pe<=1.2)&&me?(ie=1-f.width(),le=null==Ee||ce.isParent&&ce.open?Ie+fe.height()-f.height()/2:Ee.offset().top-f.height()/2,D=i.move.TYPE_NEXT):Te?(ie=5-f.width(),le=Ie,D=i.move.TYPE_INNER):se(),E&&(f.css({display:"block",top:le+"px",left:he+ie+"px"}),fe.addClass(i.node.TMPTARGET_NODE+"_"+D),C==O&&_==D||(S=(new Date).getTime()),ce&&ce.isParent&&D==i.move.TYPE_INNER)){var we=!0;window.zTreeMoveTimer&&window.zTreeMoveTargetNodeTId!==ce.tId?(clearTimeout(window.zTreeMoveTimer),window.zTreeMoveTargetNodeTId=null):window.zTreeMoveTimer&&window.zTreeMoveTargetNodeTId===ce.tId&&(we=!1),we&&(window.zTreeMoveTimer=setTimeout(function(){D==i.move.TYPE_INNER&&ce&&ce.isParent&&!ce.open&&(new Date).getTime()-S>w.edit.drag.autoOpenTime&&a.apply(w.callback.beforeDragOpen,[w.treeId,ce],!0)&&(l.switchNode(w,ce),w.edit.drag.autoExpandTrigger&&w.treeObj.trigger(i.event.EXPAND,[w.treeId,ce]))},w.edit.drag.autoOpenTime+50),window.zTreeMoveTargetNodeTId=ce.tId)}}else se()}else D=i.move.TYPE_INNER,E&&a.apply(w.edit.drag.inner,[w.treeId,m,null],!!w.edit.drag.inner)?E.addClass(i.node.TMPTARGET_TREE):E=null,f.css({display:"none"}),window.zTreeMoveTimer&&(clearTimeout(window.zTreeMoveTimer),window.zTreeMoveTargetNodeTId=null);C=O,_=D,u.treeObj.trigger(i.event.DRAGMOVE,[e,u.treeId,m])}return!1}function L(e){if(window.zTreeMoveTimer&&(clearTimeout(window.zTreeMoveTimer),window.zTreeMoveTargetNodeTId=null),C=null,_=null,b.unbind("mousemove",A),b.unbind("mouseup",L),b.unbind("selectstart",Y),R.css("cursor",""),E&&(E.removeClass(i.node.TMPTARGET_TREE),O&&t("#"+O+i.id.A,E).removeClass(i.node.TMPTARGET_NODE+"_"+i.move.TYPE_PREV).removeClass(i.node.TMPTARGET_NODE+"_"+o.move.TYPE_NEXT).removeClass(i.node.TMPTARGET_NODE+"_"+o.move.TYPE_INNER)),a.showIfameMask(u,!1),v.showHoverDom=!0,0!=N.dragFlag){var r,d,n;for(N.dragFlag=0,r=0,d=m.length;r<d;r++)(n=m[r]).isParent&&N.dragNodeShowBefore[n.tId]&&!n.open&&(l.expandCollapseNode(u,n,!n.open),delete N.dragNodeShowBefore[n.tId]);T&&T.remove(),f&&f.remove();var g=(e.ctrlKey||e.metaKey)&&u.edit.drag.isMove&&u.edit.drag.isCopy||!u.edit.drag.isMove&&u.edit.drag.isCopy;if(!g&&E&&O&&m[0].parentTId&&O==m[0].parentTId&&D==i.move.TYPE_INNER&&(E=null),E){var p=function(){if(P){if(!g)for(var t=0,o=m.length;t<o;t++)l.removeNode(u,m[t]);D==i.move.TYPE_INNER?l.addNodes(w,I,-1,h):l.addNodes(w,I.getParentNode(),D==i.move.TYPE_PREV?I.getIndex():I.getIndex()+1,h)}else if(g&&D==i.move.TYPE_INNER)l.addNodes(w,I,-1,h);else if(g)l.addNodes(w,I.getParentNode(),D==i.move.TYPE_PREV?I.getIndex():I.getIndex()+1,h);else if(D!=i.move.TYPE_NEXT)for(t=0,o=h.length;t<o;t++)l.moveNode(w,I,h[t],D,!1);else for(t=-1,o=h.length-1;t<o;o--)l.moveNode(w,I,h[o],D,!1);l.selectNodes(w,h);var r=c(h[0],u).get(0);l.scrollIntoView(u,r),u.treeObj.trigger(i.event.DROP,[e,w.treeId,h,I,D,g])},I=null==O?null:s.getNodeCache(w,O);if(0==a.apply(u.callback.beforeDrop,[w.treeId,m,I,D,g],!0))return void l.selectNodes(M,m);var h=g?a.clone(m):m;D==i.move.TYPE_INNER&&a.canAsync(w,I)?l.asyncNode(w,I,!1,p):p()}else l.selectNodes(M,m),u.treeObj.trigger(i.event.DROP,[e,u.treeId,m,null,null,null])}}function Y(){return!1}return a.uCanDo(u)&&b.bind("mousemove",A),b.bind("mouseup",L),b.bind("selectstart",Y),e.preventDefault&&e.preventDefault(),!0}},d={tools:{getAbs:function(e){var t=e.getBoundingClientRect(),o=document.body.scrollTop+document.documentElement.scrollTop,r=document.body.scrollLeft+document.documentElement.scrollLeft;return[t.left+r,t.top+o]},inputFocus:function(e){e.get(0)&&(e.focus(),a.setCursorPosition(e.get(0),e.val().length))},inputSelect:function(e){e.get(0)&&(e.focus(),e.select())},setCursorPosition:function(e,t){if(e.setSelectionRange)e.focus(),e.setSelectionRange(t,t);else if(e.createTextRange){var o=e.createTextRange();o.collapse(!0),o.moveEnd("character",t),o.moveStart("character",t),o.select()}},showIfameMask:function(e,t){for(var o=s.getRoot(e);o.dragMaskList.length>0;)o.dragMaskList[0].remove(),o.dragMaskList.shift();if(t)for(var r=c("iframe",e),d=0,n=r.length;d<n;d++){var i=r.get(d),l=a.getAbs(i),u=c("<div id='zTreeMask_"+d+"' class='zTreeMask' style='top:"+l[1]+"px; left:"+l[0]+"px; width:"+i.offsetWidth+"px; height:"+i.offsetHeight+"px;'></div>",e);u.appendTo(c("body",e)),o.dragMaskList.push(u)}}},view:{addEditBtn:function(e,t){if(!(t.editNameFlag||c(t,i.id.EDIT,e).length>0)&&a.apply(e.edit.showRenameBtn,[e.treeId,t],e.edit.showRenameBtn)){var o=c(t,i.id.A,e),r="<span class='"+i.className.BUTTON+" edit' id='"+t.tId+i.id.EDIT+"' title='"+a.apply(e.edit.renameTitle,[e.treeId,t],e.edit.renameTitle)+"' treeNode"+i.id.EDIT+" style='display:none;'></span>";o.append(r),c(t,i.id.EDIT,e).bind("click",function(){return!(!a.uCanDo(e)||0==a.apply(e.callback.beforeEditName,[e.treeId,t],!0))&&(l.editNode(e,t),!1)}).show()}},addRemoveBtn:function(e,t){if(!(t.editNameFlag||c(t,i.id.REMOVE,e).length>0)&&a.apply(e.edit.showRemoveBtn,[e.treeId,t],e.edit.showRemoveBtn)){var o=c(t,i.id.A,e),r="<span class='"+i.className.BUTTON+" remove' id='"+t.tId+i.id.REMOVE+"' title='"+a.apply(e.edit.removeTitle,[e.treeId,t],e.edit.removeTitle)+"' treeNode"+i.id.REMOVE+" style='display:none;'></span>";o.append(r),c(t,i.id.REMOVE,e).bind("click",function(){return!(!a.uCanDo(e)||0==a.apply(e.callback.beforeRemove,[e.treeId,t],!0))&&(l.removeNode(e,t),e.treeObj.trigger(i.event.REMOVE,[e.treeId,t]),!1)}).bind("mousedown",function(e){return!0}).show()}},addHoverDom:function(e,t){s.getRoots().showHoverDom&&(t.isHover=!0,e.edit.enable&&(l.addEditBtn(e,t),l.addRemoveBtn(e,t)),a.apply(e.view.addHoverDom,[e.treeId,t]))},cancelCurEditNode:function(e,t,o){var r=s.getRoot(e),d=e.data.key.name,n=r.curEditNode;if(n){var u=r.curEditInput,N=t||(o?n[d]:u.val());if(!1===a.apply(e.callback.beforeRename,[e.treeId,n,N,o],!0))return!1;n[d]=N,c(n,i.id.A,e).removeClass(i.node.CURSELECTED_EDIT),u.unbind(),l.setNodeName(e,n),n.editNameFlag=!1,r.curEditNode=null,r.curEditInput=null,l.selectNode(e,n,!1),e.treeObj.trigger(i.event.RENAME,[e.treeId,n,o])}return r.noSelection=!0,!0},editNode:function(e,t){var o=s.getRoot(e);if(l.editNodeBlur=!1,s.isSelectedNode(e,t)&&o.curEditNode==t&&t.editNameFlag)setTimeout(function(){a.inputFocus(o.curEditInput)},0);else{var r=e.data.key.name;t.editNameFlag=!0,l.removeTreeDom(e,t),l.cancelCurEditNode(e),l.selectNode(e,t,!1),c(t,i.id.SPAN,e).html("<input type=text class='rename' id='"+t.tId+i.id.INPUT+"' treeNode"+i.id.INPUT+" >");var d=c(t,i.id.INPUT,e);d.attr("value",t[r]),e.edit.editNameSelectAll?a.inputSelect(d):a.inputFocus(d),d.bind("blur",function(t){l.editNodeBlur||l.cancelCurEditNode(e)}).bind("keydown",function(t){"13"==t.keyCode?(l.editNodeBlur=!0,l.cancelCurEditNode(e)):"27"==t.keyCode&&l.cancelCurEditNode(e,null,!0)}).bind("click",function(e){return!1}).bind("dblclick",function(e){return!1}),c(t,i.id.A,e).addClass(i.node.CURSELECTED_EDIT),o.curEditInput=d,o.noSelection=!1,o.curEditNode=t}},moveNode:function(e,t,o,r,d,n){var a=s.getRoot(e),u=e.data.key.children;if(t!=o&&(!e.data.keep.leaf||!t||t.isParent||r!=i.move.TYPE_INNER)){var N=o.parentTId?o.getParentNode():a,v=null===t||t==a;v&&null===t&&(t=a),v&&(r=i.move.TYPE_INNER);var g,p,m=t.parentTId?t.getParentNode():a;if(r!=i.move.TYPE_PREV&&r!=i.move.TYPE_NEXT&&(r=i.move.TYPE_INNER),r==i.move.TYPE_INNER&&(v?o.parentTId=null:(t.isParent||(t.isParent=!0,t.open=!!t.open,l.setNodeLineIcos(e,t)),o.parentTId=t.tId)),v)p=g=e.treeObj;else{if(n||r!=i.move.TYPE_INNER?n||l.expandCollapseNode(e,t.getParentNode(),!0,!1):l.expandCollapseNode(e,t,!0,!1),g=c(t,e),p=c(t,i.id.UL,e),g.get(0)&&!p.get(0)){var T=[];l.makeUlHtml(e,t,T,""),g.append(T.join(""))}p=c(t,i.id.UL,e)}var f=c(o,e);f.get(0)?g.get(0)||f.remove():f=l.appendNodes(e,o.level,[o],null,-1,!1,!0).join(""),p.get(0)&&r==i.move.TYPE_INNER?p.append(f):g.get(0)&&r==i.move.TYPE_PREV?g.before(f):g.get(0)&&r==i.move.TYPE_NEXT&&g.after(f);var E,I,h=-1,b=0,R=null,P=null,w=o.level;if(o.isFirstNode)h=0,N[u].length>1&&((R=N[u][1]).isFirstNode=!0);else if(o.isLastNode)h=N[u].length-1,(R=N[u][h-1]).isLastNode=!0;else for(E=0,I=N[u].length;E<I;E++)if(N[u][E].tId==o.tId){h=E;break}if(h>=0&&N[u].splice(h,1),r!=i.move.TYPE_INNER)for(E=0,I=m[u].length;E<I;E++)m[u][E].tId==t.tId&&(b=E);if(r==i.move.TYPE_INNER?(t[u]||(t[u]=new Array),t[u].length>0&&((P=t[u][t[u].length-1]).isLastNode=!1),t[u].splice(t[u].length,0,o),o.isLastNode=!0,o.isFirstNode=1==t[u].length):t.isFirstNode&&r==i.move.TYPE_PREV?(m[u].splice(b,0,o),(P=t).isFirstNode=!1,o.parentTId=t.parentTId,o.isFirstNode=!0,o.isLastNode=!1):t.isLastNode&&r==i.move.TYPE_NEXT?(m[u].splice(b+1,0,o),(P=t).isLastNode=!1,o.parentTId=t.parentTId,o.isFirstNode=!1,o.isLastNode=!0):(r==i.move.TYPE_PREV?m[u].splice(b,0,o):m[u].splice(b+1,0,o),o.parentTId=t.parentTId,o.isFirstNode=!1,o.isLastNode=!1),s.fixPIdKeyValue(e,o),s.setSonNodeLevel(e,o.getParentNode(),o),l.setNodeLineIcos(e,o),l.repairNodeLevelClass(e,o,w),!e.data.keep.parent&&N[u].length<1){N.isParent=!1,N.open=!1;var M=c(N,i.id.UL,e),C=c(N,i.id.SWITCH,e),_=c(N,i.id.ICON,e);l.replaceSwitchClass(N,C,i.folder.DOCU),l.replaceIcoClass(N,_,i.folder.DOCU),M.css("display","none")}else R&&l.setNodeLineIcos(e,R);P&&l.setNodeLineIcos(e,P),e.check&&e.check.enable&&l.repairChkClass&&(l.repairChkClass(e,N),l.repairParentChkClassWithSelf(e,N),N!=o.parent&&l.repairParentChkClassWithSelf(e,o)),n||l.expandCollapseParentNode(e,o.getParentNode(),!0,d)}},removeEditBtn:function(e,t){c(t,i.id.EDIT,e).unbind().remove()},removeRemoveBtn:function(e,t){c(t,i.id.REMOVE,e).unbind().remove()},removeTreeDom:function(e,t){t.isHover=!1,l.removeEditBtn(e,t),l.removeRemoveBtn(e,t),a.apply(e.view.removeHoverDom,[e.treeId,t])},repairNodeLevelClass:function(e,t,o){if(o!==t.level){var r=c(t,e),d=c(t,i.id.A,e),n=c(t,i.id.UL,e),a=i.className.LEVEL+o,l=i.className.LEVEL+t.level;r.removeClass(a),r.addClass(l),d.removeClass(a),d.addClass(l),n.removeClass(a),n.addClass(l)}},selectNodes:function(e,t){for(var o=0,r=t.length;o<r;o++)l.selectNode(e,t[o],o>0)}},event:{},data:{setSonNodeLevel:function(e,t,o){if(o){var r=e.data.key.children;if(o.level=t?t.level+1:0,o[r])for(var d=0,n=o[r].length;d<n;d++)o[r][d]&&s.setSonNodeLevel(e,o,o[r][d])}}}};t.extend(!0,t.fn.zTree.consts,o),t.extend(!0,t.fn.zTree._z,d);var n=t.fn.zTree,a=n._z.tools,i=n.consts,l=n._z.view,s=n._z.data,c=(n._z.event,a.$);s.exSetting({edit:{enable:!1,editNameSelectAll:!1,showRemoveBtn:!0,showRenameBtn:!0,removeTitle:"remove",renameTitle:"rename",drag:{autoExpandTrigger:!1,isCopy:!0,isMove:!0,prev:!0,next:!0,inner:!0,minMoveSize:5,borderMax:10,borderMin:-5,maxShowNodeNum:5,autoOpenTime:500}},view:{addHoverDom:null,removeHoverDom:null},callback:{beforeDrag:null,beforeDragOpen:null,beforeDrop:null,beforeEditName:null,beforeRename:null,onDrag:null,onDragMove:null,onDrop:null,onRename:null}}),s.addInitBind(function(e){var t=e.treeObj,o=i.event;t.bind(o.RENAME,function(t,o,r,d){a.apply(e.callback.onRename,[t,o,r,d])}),t.bind(o.DRAG,function(t,o,r,d){a.apply(e.callback.onDrag,[o,r,d])}),t.bind(o.DRAGMOVE,function(t,o,r,d){a.apply(e.callback.onDragMove,[o,r,d])}),t.bind(o.DROP,function(t,o,r,d,n,i,l){a.apply(e.callback.onDrop,[o,r,d,n,i,l])})}),s.addInitUnBind(function(e){var t=e.treeObj,o=i.event;t.unbind(o.RENAME),t.unbind(o.DRAG),t.unbind(o.DRAGMOVE),t.unbind(o.DROP)}),s.addInitCache(function(e){}),s.addInitNode(function(e,t,o,r,d,n,a){o&&(o.isHover=!1,o.editNameFlag=!1)}),s.addInitProxy(function(e){var t=e.target,o=s.getSetting(e.data.treeId),d=e.relatedTarget,n="",l=null,c="",u=null,N=null;if(a.eqs(e.type,"mouseover")?(N=a.getMDom(o,t,[{tagName:"a",attrName:"treeNode"+i.id.A}]))&&(n=a.getNodeMainDom(N).id,c="hoverOverNode"):a.eqs(e.type,"mouseout")?(N=a.getMDom(o,d,[{tagName:"a",attrName:"treeNode"+i.id.A}]))||(n="remove",c="hoverOutNode"):a.eqs(e.type,"mousedown")&&(N=a.getMDom(o,t,[{tagName:"a",attrName:"treeNode"+i.id.A}]))&&(n=a.getNodeMainDom(N).id,c="mousedownNode"),n.length>0)switch(l=s.getNodeCache(o,n),c){case"mousedownNode":u=r.onMousedownNode;break;case"hoverOverNode":u=r.onHoverOverNode;break;case"hoverOutNode":u=r.onHoverOutNode}return{stop:!1,node:l,nodeEventType:c,nodeEventCallback:u,treeEventType:"",treeEventCallback:null}}),s.addInitRoot(function(e){var t=s.getRoot(e),o=s.getRoots();t.curEditNode=null,t.curEditInput=null,t.curHoverNode=null,t.dragFlag=0,t.dragNodeShowBefore=[],t.dragMaskList=new Array,o.showHoverDom=!0}),s.addZTreeTools(function(e,t){t.cancelEditName=function(e){s.getRoot(this.setting).curEditNode&&l.cancelCurEditNode(this.setting,e||null,!0)},t.copyNode=function(e,t,o,r){if(!t)return null;if(e&&!e.isParent&&this.setting.data.keep.leaf&&o===i.move.TYPE_INNER)return null;var d=this,n=a.clone(t);if(e||(e=null,o=i.move.TYPE_INNER),o==i.move.TYPE_INNER){var s=function(){l.addNodes(d.setting,e,-1,[n],r)};a.canAsync(this.setting,e)?l.asyncNode(this.setting,e,r,s):s()}else l.addNodes(this.setting,e.parentNode,-1,[n],r),l.moveNode(this.setting,e,n,o,!1,r);return n},t.editName=function(e){e&&e.tId&&e===s.getNodeCache(this.setting,e.tId)&&(e.parentTId&&l.expandCollapseParentNode(this.setting,e.getParentNode(),!0),l.editNode(this.setting,e))},t.moveNode=function(e,t,o,r){if(!t)return t;if(e&&!e.isParent&&this.setting.data.keep.leaf&&o===i.move.TYPE_INNER)return null;if(e&&(t.parentTId==e.tId&&o==i.move.TYPE_INNER||c(t,this.setting).find("#"+e.tId).length>0))return null;e||(e=null);var d=this;function n(){l.moveNode(d.setting,e,t,o,!1,r)}return a.canAsync(this.setting,e)&&o===i.move.TYPE_INNER?l.asyncNode(this.setting,e,r,n):n(),t},t.setEditable=function(e){return this.setting.edit.enable=e,this.refresh()}});var u=l.cancelPreSelectedNode;l.cancelPreSelectedNode=function(e,t){for(var o=s.getRoot(e).curSelectedList,r=0,d=o.length;r<d&&(t&&t!==o[r]||(l.removeTreeDom(e,o[r]),!t));r++);u&&u.apply(l,arguments)};var N=l.createNodes;l.createNodes=function(e,t,o,r,d){N&&N.apply(l,arguments),o&&l.repairParentChkClassWithSelf&&l.repairParentChkClassWithSelf(e,r)};var v=l.makeNodeUrl;l.makeNodeUrl=function(e,t){return e.edit.enable?null:v.apply(l,arguments)};var g=l.removeNode;l.removeNode=function(e,t){var o=s.getRoot(e);o.curEditNode===t&&(o.curEditNode=null),g&&g.apply(l,arguments)};var p=l.selectNode;l.selectNode=function(e,t,o){var r=s.getRoot(e);return(!s.isSelectedNode(e,t)||r.curEditNode!=t||!t.editNameFlag)&&(p&&p.apply(l,arguments),l.addHoverDom(e,t),!0)};var m=a.uCanDo;a.uCanDo=function(e,t){var o=s.getRoot(e);return!(!t||!(a.eqs(t.type,"mouseover")||a.eqs(t.type,"mouseout")||a.eqs(t.type,"mousedown")||a.eqs(t.type,"mouseup")))||(o.curEditNode&&(l.editNodeBlur=!1,o.curEditInput.focus()),!o.curEditNode&&(!m||m.apply(l,arguments)))},e("ztree.edit",t.fn.zTree)});