layui.define(["jquery","ztree"],function(e){layui.$;var t={event:{DRAG:"ztree_drag",DROP:"ztree_drop",RENAME:"ztree_rename",DRAGMOVE:"ztree_dragmove"},id:{EDIT:"_edit",INPUT:"_input",REMOVE:"_remove"},move:{TYPE_INNER:"inner",TYPE_PREV:"prev",TYPE_NEXT:"next"},node:{CURSELECTED_EDIT:"curSelectedNode_Edit",TMPTARGET_TREE:"tmpTargetzTree",TMPTARGET_NODE:"tmpTargetNode"}},o={onHoverOverNode:function(e,t){var r=l.getSetting(e.data.treeId),d=l.getRoot(r);d.curHoverNode!=t&&o.onHoverOutNode(e),d.curHoverNode=t,i.addHoverDom(r,t)},onHoverOutNode:function(e,t){var o=l.getSetting(e.data.treeId),r=l.getRoot(o);r.curHoverNode&&!l.isSelectedNode(o,r.curHoverNode)&&(i.removeTreeDom(o,r.curHoverNode),r.curHoverNode=null)},onMousedownNode:function(e,o){var r,d,c=l.getSetting(e.data.treeId),u=l.getRoot(c),N=l.getRoots();if(2==e.button||!c.edit.enable||!c.edit.drag.isCopy&&!c.edit.drag.isMove)return!0;var v=e.target,g=l.getRoot(c).curSelectedList,p=[];if(l.isSelectedNode(c,o))for(r=0,d=g.length;r<d;r++){if(g[r].editNameFlag&&n.eqs(v.tagName,"input")&&null!==v.getAttribute("treeNode"+a.id.INPUT))return!0;if(p.push(g[r]),p[0].parentTId!==g[r].parentTId){p=[o];break}}else p=[o];i.editNodeBlur=!0,i.cancelCurEditNode(c);var m,T,f,E,I,h=$(c.treeObj.get(0).ownerDocument),b=$(c.treeObj.get(0).ownerDocument.body),R=!1,P=c,w=c,M=null,C=null,_=null,O=a.move.TYPE_INNER,D=e.clientX,y=e.clientY,k=(new Date).getTime();function S(e){if(0==u.dragFlag&&Math.abs(D-e.clientX)<c.edit.drag.minMoveSize&&Math.abs(y-e.clientY)<c.edit.drag.minMoveSize)return!0;var o,r,d,v,g,w=c.data.key.children;if(b.css("cursor","pointer"),0==u.dragFlag){if(0==n.apply(c.callback.beforeDrag,[c.treeId,p],!0))return A(e),!0;for(o=0,r=p.length;o<r;o++)0==o&&(u.dragNodeShowBefore=[]),(d=p[o]).isParent&&d.open?(i.expandCollapseNode(c,d,!d.open),u.dragNodeShowBefore[d.tId]=!0):u.dragNodeShowBefore[d.tId]=!1;u.dragFlag=1,N.showHoverDom=!1,n.showIfameMask(c,!0);var S=!0,L=-1;if(p.length>1){var Y=p[0].parentTId?p[0].getParentNode()[w]:l.getNodes(c);for(g=[],o=0,r=Y.length;o<r;o++)if(void 0!==u.dragNodeShowBefore[Y[o].tId]&&(S&&L>-1&&L+1!==o&&(S=!1),g.push(Y[o]),L=o),p.length===g.length){p=g;break}}for(S&&(E=p[0].getPreNode(),I=p[p.length-1].getNextNode()),m=s("<ul class='zTreeDragUL'></ul>",c),o=0,r=p.length;o<r;o++)(d=p[o]).editNameFlag=!1,i.selectNode(c,d,o>0),i.removeTreeDom(c,d),o>c.edit.drag.maxShowNodeNum-1||((v=s("<li id='"+d.tId+"_tmp'></li>",c)).append(s(d,a.id.A,c).clone()),v.css("padding","0"),v.children("#"+d.tId+a.id.A).removeClass(a.node.CURSELECTED),m.append(v),o==c.edit.drag.maxShowNodeNum-1&&(v=s("<li id='"+d.tId+"_moretmp'><a>  ...  </a></li>",c),m.append(v)));m.attr("id",p[0].tId+a.id.UL+"_tmp"),m.addClass(c.treeObj.attr("class")),m.appendTo(b),(T=s("<span class='tmpzTreeMove_arrow'></span>",c)).attr("id","zTreeMove_arrow_tmp"),T.appendTo(b),c.treeObj.trigger(a.event.DRAG,[e,c.treeId,p])}if(1==u.dragFlag){if(f&&T.attr("id")==e.target.id&&_&&e.clientX+h.scrollLeft()+2>$("#"+_+a.id.A,f).offset().left){var x=$("#"+_+a.id.A,f);e.target=x.length>0?x.get(0):e.target}else f&&(f.removeClass(a.node.TMPTARGET_TREE),_&&$("#"+_+a.id.A,f).removeClass(a.node.TMPTARGET_NODE+"_"+a.move.TYPE_PREV).removeClass(a.node.TMPTARGET_NODE+"_"+t.move.TYPE_NEXT).removeClass(a.node.TMPTARGET_NODE+"_"+t.move.TYPE_INNER));f=null,_=null,R=!1,P=c;var j=l.getSettings();for(var z in j)j[z].treeId&&j[z].edit.enable&&j[z].treeId!=c.treeId&&(e.target.id==j[z].treeId||$(e.target).parents("#"+j[z].treeId).length>0)&&(R=!0,P=j[z]);var B=h.scrollTop(),H=h.scrollLeft(),F=P.treeObj.offset(),V=P.treeObj.get(0).scrollHeight,U=P.treeObj.get(0).scrollWidth,G=e.clientY+B-F.top,X=P.treeObj.height()+F.top-e.clientY-B,q=e.clientX+H-F.left,W=P.treeObj.width()+F.left-e.clientX-H,K=G<c.edit.drag.borderMax&&G>c.edit.drag.borderMin,Z=X<c.edit.drag.borderMax&&X>c.edit.drag.borderMin,J=q<c.edit.drag.borderMax&&q>c.edit.drag.borderMin,Q=W<c.edit.drag.borderMax&&W>c.edit.drag.borderMin,ee=G>c.edit.drag.borderMin&&X>c.edit.drag.borderMin&&q>c.edit.drag.borderMin&&W>c.edit.drag.borderMin,te=K&&P.treeObj.scrollTop()<=0,oe=Z&&P.treeObj.scrollTop()+P.treeObj.height()+10>=V,re=J&&P.treeObj.scrollLeft()<=0,de=Q&&P.treeObj.scrollLeft()+P.treeObj.width()+10>=U;if(e.target&&n.isChildOrSelf(e.target,P.treeId)){for(var ne=e.target;ne&&ne.tagName&&!n.eqs(ne.tagName,"li")&&ne.id!=P.treeId;)ne=ne.parentNode;var ae=!0;for(o=0,r=p.length;o<r;o++){if(d=p[o],ne.id===d.tId){ae=!1;break}if(s(d,c).find("#"+ne.id).length>0){ae=!1;break}}ae&&e.target&&n.isChildOrSelf(e.target,ne.id+a.id.A)&&(f=$(ne),_=ne.id)}d=p[0],ee&&n.isChildOrSelf(e.target,P.treeId)&&(!f&&(e.target.id==P.treeId||te||oe||re||de)&&(R||!R&&d.parentTId)&&(f=P.treeObj),K?P.treeObj.scrollTop(P.treeObj.scrollTop()-10):Z&&P.treeObj.scrollTop(P.treeObj.scrollTop()+10),J?P.treeObj.scrollLeft(P.treeObj.scrollLeft()-10):Q&&P.treeObj.scrollLeft(P.treeObj.scrollLeft()+10),f&&f!=P.treeObj&&f.offset().left<P.treeObj.offset().left&&P.treeObj.scrollLeft(P.treeObj.scrollLeft()+f.offset().left-P.treeObj.offset().left)),m.css({top:e.clientY+B+3+"px",left:e.clientX+H+3+"px"});var ie=0,le=0;if(f&&f.attr("id")!=P.treeId){var se=function(){f=null,_="",O=a.move.TYPE_INNER,T.css({display:"none"}),window.zTreeMoveTimer&&(clearTimeout(window.zTreeMoveTimer),window.zTreeMoveTargetNodeTId=null)},ce=null==_?null:l.getNodeCache(P,_),ue=(e.ctrlKey||e.metaKey)&&c.edit.drag.isMove&&c.edit.drag.isCopy||!c.edit.drag.isMove&&c.edit.drag.isCopy,Ne=!(!E||_!==E.tId),ve=!(!I||_!==I.tId),ge=d.parentTId&&d.parentTId==_,pe=(ue||!ve)&&n.apply(P.edit.drag.prev,[P.treeId,p,ce],!!P.edit.drag.prev),me=(ue||!Ne)&&n.apply(P.edit.drag.next,[P.treeId,p,ce],!!P.edit.drag.next),Te=(ue||!ge)&&!(P.data.keep.leaf&&!ce.isParent)&&n.apply(P.edit.drag.inner,[P.treeId,p,ce],!!P.edit.drag.inner);if(pe||me||Te){var fe=$("#"+_+a.id.A,f),Ee=ce.isLastNode?null:$("#"+ce.getNextNode().tId+a.id.A,f.next()),Ie=fe.offset().top,he=fe.offset().left,be=pe?Te?.25:me?.5:1:-1,Re=me?Te?.75:pe?.5:0:-1,Pe=(e.clientY+B-Ie)/fe.height();if((1==be||Pe<=be&&Pe>=-.2)&&pe?(ie=1-T.width(),le=Ie-T.height()/2,O=a.move.TYPE_PREV):(0==Re||Pe>=Re&&Pe<=1.2)&&me?(ie=1-T.width(),le=null==Ee||ce.isParent&&ce.open?Ie+fe.height()-T.height()/2:Ee.offset().top-T.height()/2,O=a.move.TYPE_NEXT):Te?(ie=5-T.width(),le=Ie,O=a.move.TYPE_INNER):se(),f&&(T.css({display:"block",top:le+"px",left:he+ie+"px"}),fe.addClass(a.node.TMPTARGET_NODE+"_"+O),M==_&&C==O||(k=(new Date).getTime()),ce&&ce.isParent&&O==a.move.TYPE_INNER)){var we=!0;window.zTreeMoveTimer&&window.zTreeMoveTargetNodeTId!==ce.tId?(clearTimeout(window.zTreeMoveTimer),window.zTreeMoveTargetNodeTId=null):window.zTreeMoveTimer&&window.zTreeMoveTargetNodeTId===ce.tId&&(we=!1),we&&(window.zTreeMoveTimer=setTimeout(function(){O==a.move.TYPE_INNER&&ce&&ce.isParent&&!ce.open&&(new Date).getTime()-k>P.edit.drag.autoOpenTime&&n.apply(P.callback.beforeDragOpen,[P.treeId,ce],!0)&&(i.switchNode(P,ce),P.edit.drag.autoExpandTrigger&&P.treeObj.trigger(a.event.EXPAND,[P.treeId,ce]))},P.edit.drag.autoOpenTime+50),window.zTreeMoveTargetNodeTId=ce.tId)}}else se()}else O=a.move.TYPE_INNER,f&&n.apply(P.edit.drag.inner,[P.treeId,p,null],!!P.edit.drag.inner)?f.addClass(a.node.TMPTARGET_TREE):f=null,T.css({display:"none"}),window.zTreeMoveTimer&&(clearTimeout(window.zTreeMoveTimer),window.zTreeMoveTargetNodeTId=null);M=_,C=O,c.treeObj.trigger(a.event.DRAGMOVE,[e,c.treeId,p])}return!1}function A(e){if(window.zTreeMoveTimer&&(clearTimeout(window.zTreeMoveTimer),window.zTreeMoveTargetNodeTId=null),M=null,C=null,h.unbind("mousemove",S),h.unbind("mouseup",A),h.unbind("selectstart",L),b.css("cursor",""),f&&(f.removeClass(a.node.TMPTARGET_TREE),_&&$("#"+_+a.id.A,f).removeClass(a.node.TMPTARGET_NODE+"_"+a.move.TYPE_PREV).removeClass(a.node.TMPTARGET_NODE+"_"+t.move.TYPE_NEXT).removeClass(a.node.TMPTARGET_NODE+"_"+t.move.TYPE_INNER)),n.showIfameMask(c,!1),N.showHoverDom=!0,0!=u.dragFlag){var o,r,d;for(u.dragFlag=0,o=0,r=p.length;o<r;o++)(d=p[o]).isParent&&u.dragNodeShowBefore[d.tId]&&!d.open&&(i.expandCollapseNode(c,d,!d.open),delete u.dragNodeShowBefore[d.tId]);m&&m.remove(),T&&T.remove();var v=(e.ctrlKey||e.metaKey)&&c.edit.drag.isMove&&c.edit.drag.isCopy||!c.edit.drag.isMove&&c.edit.drag.isCopy;if(!v&&f&&_&&p[0].parentTId&&_==p[0].parentTId&&O==a.move.TYPE_INNER&&(f=null),f){var g=function(){if(R){if(!v)for(var t=0,o=p.length;t<o;t++)i.removeNode(c,p[t]);O==a.move.TYPE_INNER?i.addNodes(P,E,-1,I):i.addNodes(P,E.getParentNode(),O==a.move.TYPE_PREV?E.getIndex():E.getIndex()+1,I)}else if(v&&O==a.move.TYPE_INNER)i.addNodes(P,E,-1,I);else if(v)i.addNodes(P,E.getParentNode(),O==a.move.TYPE_PREV?E.getIndex():E.getIndex()+1,I);else if(O!=a.move.TYPE_NEXT)for(t=0,o=I.length;t<o;t++)i.moveNode(P,E,I[t],O,!1);else for(t=-1,o=I.length-1;t<o;o--)i.moveNode(P,E,I[o],O,!1);i.selectNodes(P,I);var r=s(I[0],c).get(0);i.scrollIntoView(c,r),c.treeObj.trigger(a.event.DROP,[e,P.treeId,I,E,O,v])},E=null==_?null:l.getNodeCache(P,_);if(0==n.apply(c.callback.beforeDrop,[P.treeId,p,E,O,v],!0))return void i.selectNodes(w,p);var I=v?n.clone(p):p;O==a.move.TYPE_INNER&&n.canAsync(P,E)?i.asyncNode(P,E,!1,g):g()}else i.selectNodes(w,p),c.treeObj.trigger(a.event.DROP,[e,c.treeId,p,null,null,null])}}function L(){return!1}return n.uCanDo(c)&&h.bind("mousemove",S),h.bind("mouseup",A),h.bind("selectstart",L),e.preventDefault&&e.preventDefault(),!0}},r={tools:{getAbs:function(e){var t=e.getBoundingClientRect(),o=document.body.scrollTop+document.documentElement.scrollTop,r=document.body.scrollLeft+document.documentElement.scrollLeft;return[t.left+r,t.top+o]},inputFocus:function(e){e.get(0)&&(e.focus(),n.setCursorPosition(e.get(0),e.val().length))},inputSelect:function(e){e.get(0)&&(e.focus(),e.select())},setCursorPosition:function(e,t){if(e.setSelectionRange)e.focus(),e.setSelectionRange(t,t);else if(e.createTextRange){var o=e.createTextRange();o.collapse(!0),o.moveEnd("character",t),o.moveStart("character",t),o.select()}},showIfameMask:function(e,t){for(var o=l.getRoot(e);o.dragMaskList.length>0;)o.dragMaskList[0].remove(),o.dragMaskList.shift();if(t)for(var r=s("iframe",e),d=0,a=r.length;d<a;d++){var i=r.get(d),c=n.getAbs(i),u=s("<div id='zTreeMask_"+d+"' class='zTreeMask' style='top:"+c[1]+"px; left:"+c[0]+"px; width:"+i.offsetWidth+"px; height:"+i.offsetHeight+"px;'></div>",e);u.appendTo(s("body",e)),o.dragMaskList.push(u)}}},view:{addEditBtn:function(e,t){if(!(t.editNameFlag||s(t,a.id.EDIT,e).length>0)&&n.apply(e.edit.showRenameBtn,[e.treeId,t],e.edit.showRenameBtn)){var o=s(t,a.id.A,e),r="<span class='"+a.className.BUTTON+" edit' id='"+t.tId+a.id.EDIT+"' title='"+n.apply(e.edit.renameTitle,[e.treeId,t],e.edit.renameTitle)+"' treeNode"+a.id.EDIT+" style='display:none;'></span>";o.append(r),s(t,a.id.EDIT,e).bind("click",function(){return!(!n.uCanDo(e)||0==n.apply(e.callback.beforeEditName,[e.treeId,t],!0))&&(i.editNode(e,t),!1)}).show()}},addRemoveBtn:function(e,t){if(!(t.editNameFlag||s(t,a.id.REMOVE,e).length>0)&&n.apply(e.edit.showRemoveBtn,[e.treeId,t],e.edit.showRemoveBtn)){var o=s(t,a.id.A,e),r="<span class='"+a.className.BUTTON+" remove' id='"+t.tId+a.id.REMOVE+"' title='"+n.apply(e.edit.removeTitle,[e.treeId,t],e.edit.removeTitle)+"' treeNode"+a.id.REMOVE+" style='display:none;'></span>";o.append(r),s(t,a.id.REMOVE,e).bind("click",function(){return!(!n.uCanDo(e)||0==n.apply(e.callback.beforeRemove,[e.treeId,t],!0))&&(i.removeNode(e,t),e.treeObj.trigger(a.event.REMOVE,[e.treeId,t]),!1)}).bind("mousedown",function(e){return!0}).show()}},addHoverDom:function(e,t){l.getRoots().showHoverDom&&(t.isHover=!0,e.edit.enable&&(i.addEditBtn(e,t),i.addRemoveBtn(e,t)),n.apply(e.view.addHoverDom,[e.treeId,t]))},cancelCurEditNode:function(e,t,o){var r=l.getRoot(e),d=e.data.key.name,c=r.curEditNode;if(c){var u=r.curEditInput,N=t||(o?c[d]:u.val());if(!1===n.apply(e.callback.beforeRename,[e.treeId,c,N,o],!0))return!1;c[d]=N,s(c,a.id.A,e).removeClass(a.node.CURSELECTED_EDIT),u.unbind(),i.setNodeName(e,c),c.editNameFlag=!1,r.curEditNode=null,r.curEditInput=null,i.selectNode(e,c,!1),e.treeObj.trigger(a.event.RENAME,[e.treeId,c,o])}return r.noSelection=!0,!0},editNode:function(e,t){var o=l.getRoot(e);if(i.editNodeBlur=!1,l.isSelectedNode(e,t)&&o.curEditNode==t&&t.editNameFlag)setTimeout(function(){n.inputFocus(o.curEditInput)},0);else{var r=e.data.key.name;t.editNameFlag=!0,i.removeTreeDom(e,t),i.cancelCurEditNode(e),i.selectNode(e,t,!1),s(t,a.id.SPAN,e).html("<input type=text class='rename' id='"+t.tId+a.id.INPUT+"' treeNode"+a.id.INPUT+" >");var d=s(t,a.id.INPUT,e);d.attr("value",t[r]),e.edit.editNameSelectAll?n.inputSelect(d):n.inputFocus(d),d.bind("blur",function(t){i.editNodeBlur||i.cancelCurEditNode(e)}).bind("keydown",function(t){"13"==t.keyCode?(i.editNodeBlur=!0,i.cancelCurEditNode(e)):"27"==t.keyCode&&i.cancelCurEditNode(e,null,!0)}).bind("click",function(e){return!1}).bind("dblclick",function(e){return!1}),s(t,a.id.A,e).addClass(a.node.CURSELECTED_EDIT),o.curEditInput=d,o.noSelection=!1,o.curEditNode=t}},moveNode:function(e,t,o,r,d,n){var c=l.getRoot(e),u=e.data.key.children;if(t!=o&&(!e.data.keep.leaf||!t||t.isParent||r!=a.move.TYPE_INNER)){var N=o.parentTId?o.getParentNode():c,v=null===t||t==c;v&&null===t&&(t=c),v&&(r=a.move.TYPE_INNER);var g,p,m=t.parentTId?t.getParentNode():c;if(r!=a.move.TYPE_PREV&&r!=a.move.TYPE_NEXT&&(r=a.move.TYPE_INNER),r==a.move.TYPE_INNER&&(v?o.parentTId=null:(t.isParent||(t.isParent=!0,t.open=!!t.open,i.setNodeLineIcos(e,t)),o.parentTId=t.tId)),v)p=g=e.treeObj;else{if(n||r!=a.move.TYPE_INNER?n||i.expandCollapseNode(e,t.getParentNode(),!0,!1):i.expandCollapseNode(e,t,!0,!1),g=s(t,e),p=s(t,a.id.UL,e),g.get(0)&&!p.get(0)){var T=[];i.makeUlHtml(e,t,T,""),g.append(T.join(""))}p=s(t,a.id.UL,e)}var f=s(o,e);f.get(0)?g.get(0)||f.remove():f=i.appendNodes(e,o.level,[o],null,-1,!1,!0).join(""),p.get(0)&&r==a.move.TYPE_INNER?p.append(f):g.get(0)&&r==a.move.TYPE_PREV?g.before(f):g.get(0)&&r==a.move.TYPE_NEXT&&g.after(f);var E,I,h=-1,b=0,R=null,P=null,w=o.level;if(o.isFirstNode)h=0,N[u].length>1&&((R=N[u][1]).isFirstNode=!0);else if(o.isLastNode)h=N[u].length-1,(R=N[u][h-1]).isLastNode=!0;else for(E=0,I=N[u].length;E<I;E++)if(N[u][E].tId==o.tId){h=E;break}if(h>=0&&N[u].splice(h,1),r!=a.move.TYPE_INNER)for(E=0,I=m[u].length;E<I;E++)m[u][E].tId==t.tId&&(b=E);if(r==a.move.TYPE_INNER?(t[u]||(t[u]=new Array),t[u].length>0&&((P=t[u][t[u].length-1]).isLastNode=!1),t[u].splice(t[u].length,0,o),o.isLastNode=!0,o.isFirstNode=1==t[u].length):t.isFirstNode&&r==a.move.TYPE_PREV?(m[u].splice(b,0,o),(P=t).isFirstNode=!1,o.parentTId=t.parentTId,o.isFirstNode=!0,o.isLastNode=!1):t.isLastNode&&r==a.move.TYPE_NEXT?(m[u].splice(b+1,0,o),(P=t).isLastNode=!1,o.parentTId=t.parentTId,o.isFirstNode=!1,o.isLastNode=!0):(r==a.move.TYPE_PREV?m[u].splice(b,0,o):m[u].splice(b+1,0,o),o.parentTId=t.parentTId,o.isFirstNode=!1,o.isLastNode=!1),l.fixPIdKeyValue(e,o),l.setSonNodeLevel(e,o.getParentNode(),o),i.setNodeLineIcos(e,o),i.repairNodeLevelClass(e,o,w),!e.data.keep.parent&&N[u].length<1){N.isParent=!1,N.open=!1;var M=s(N,a.id.UL,e),C=s(N,a.id.SWITCH,e),_=s(N,a.id.ICON,e);i.replaceSwitchClass(N,C,a.folder.DOCU),i.replaceIcoClass(N,_,a.folder.DOCU),M.css("display","none")}else R&&i.setNodeLineIcos(e,R);P&&i.setNodeLineIcos(e,P),e.check&&e.check.enable&&i.repairChkClass&&(i.repairChkClass(e,N),i.repairParentChkClassWithSelf(e,N),N!=o.parent&&i.repairParentChkClassWithSelf(e,o)),n||i.expandCollapseParentNode(e,o.getParentNode(),!0,d)}},removeEditBtn:function(e,t){s(t,a.id.EDIT,e).unbind().remove()},removeRemoveBtn:function(e,t){s(t,a.id.REMOVE,e).unbind().remove()},removeTreeDom:function(e,t){t.isHover=!1,i.removeEditBtn(e,t),i.removeRemoveBtn(e,t),n.apply(e.view.removeHoverDom,[e.treeId,t])},repairNodeLevelClass:function(e,t,o){if(o!==t.level){var r=s(t,e),d=s(t,a.id.A,e),n=s(t,a.id.UL,e),i=a.className.LEVEL+o,l=a.className.LEVEL+t.level;r.removeClass(i),r.addClass(l),d.removeClass(i),d.addClass(l),n.removeClass(i),n.addClass(l)}},selectNodes:function(e,t){for(var o=0,r=t.length;o<r;o++)i.selectNode(e,t[o],o>0)}},event:{},data:{setSonNodeLevel:function(e,t,o){if(o){var r=e.data.key.children;if(o.level=t?t.level+1:0,o[r])for(var d=0,n=o[r].length;d<n;d++)o[r][d]&&l.setSonNodeLevel(e,o,o[r][d])}}}};$.extend(!0,$.fn.zTree.consts,t),$.extend(!0,$.fn.zTree._z,r);var d=$.fn.zTree,n=d._z.tools,a=d.consts,i=d._z.view,l=d._z.data,s=(d._z.event,n.$);l.exSetting({edit:{enable:!1,editNameSelectAll:!1,showRemoveBtn:!0,showRenameBtn:!0,removeTitle:"remove",renameTitle:"rename",drag:{autoExpandTrigger:!1,isCopy:!0,isMove:!0,prev:!0,next:!0,inner:!0,minMoveSize:5,borderMax:10,borderMin:-5,maxShowNodeNum:5,autoOpenTime:500}},view:{addHoverDom:null,removeHoverDom:null},callback:{beforeDrag:null,beforeDragOpen:null,beforeDrop:null,beforeEditName:null,beforeRename:null,onDrag:null,onDragMove:null,onDrop:null,onRename:null}}),l.addInitBind(function(e){var t=e.treeObj,o=a.event;t.bind(o.RENAME,function(t,o,r,d){n.apply(e.callback.onRename,[t,o,r,d])}),t.bind(o.DRAG,function(t,o,r,d){n.apply(e.callback.onDrag,[o,r,d])}),t.bind(o.DRAGMOVE,function(t,o,r,d){n.apply(e.callback.onDragMove,[o,r,d])}),t.bind(o.DROP,function(t,o,r,d,a,i,l){n.apply(e.callback.onDrop,[o,r,d,a,i,l])})}),l.addInitUnBind(function(e){var t=e.treeObj,o=a.event;t.unbind(o.RENAME),t.unbind(o.DRAG),t.unbind(o.DRAGMOVE),t.unbind(o.DROP)}),l.addInitCache(function(e){}),l.addInitNode(function(e,t,o,r,d,n,a){o&&(o.isHover=!1,o.editNameFlag=!1)}),l.addInitProxy(function(e){var t=e.target,r=l.getSetting(e.data.treeId),d=e.relatedTarget,i="",s=null,c="",u=null,N=null;if(n.eqs(e.type,"mouseover")?(N=n.getMDom(r,t,[{tagName:"a",attrName:"treeNode"+a.id.A}]))&&(i=n.getNodeMainDom(N).id,c="hoverOverNode"):n.eqs(e.type,"mouseout")?(N=n.getMDom(r,d,[{tagName:"a",attrName:"treeNode"+a.id.A}]))||(i="remove",c="hoverOutNode"):n.eqs(e.type,"mousedown")&&(N=n.getMDom(r,t,[{tagName:"a",attrName:"treeNode"+a.id.A}]))&&(i=n.getNodeMainDom(N).id,c="mousedownNode"),i.length>0)switch(s=l.getNodeCache(r,i),c){case"mousedownNode":u=o.onMousedownNode;break;case"hoverOverNode":u=o.onHoverOverNode;break;case"hoverOutNode":u=o.onHoverOutNode}return{stop:!1,node:s,nodeEventType:c,nodeEventCallback:u,treeEventType:"",treeEventCallback:null}}),l.addInitRoot(function(e){var t=l.getRoot(e),o=l.getRoots();t.curEditNode=null,t.curEditInput=null,t.curHoverNode=null,t.dragFlag=0,t.dragNodeShowBefore=[],t.dragMaskList=new Array,o.showHoverDom=!0}),l.addZTreeTools(function(e,t){t.cancelEditName=function(e){l.getRoot(this.setting).curEditNode&&i.cancelCurEditNode(this.setting,e||null,!0)},t.copyNode=function(e,t,o,r){if(!t)return null;if(e&&!e.isParent&&this.setting.data.keep.leaf&&o===a.move.TYPE_INNER)return null;var d=this,l=n.clone(t);if(e||(e=null,o=a.move.TYPE_INNER),o==a.move.TYPE_INNER){var s=function(){i.addNodes(d.setting,e,-1,[l],r)};n.canAsync(this.setting,e)?i.asyncNode(this.setting,e,r,s):s()}else i.addNodes(this.setting,e.parentNode,-1,[l],r),i.moveNode(this.setting,e,l,o,!1,r);return l},t.editName=function(e){e&&e.tId&&e===l.getNodeCache(this.setting,e.tId)&&(e.parentTId&&i.expandCollapseParentNode(this.setting,e.getParentNode(),!0),i.editNode(this.setting,e))},t.moveNode=function(e,t,o,r){if(!t)return t;if(e&&!e.isParent&&this.setting.data.keep.leaf&&o===a.move.TYPE_INNER)return null;if(e&&(t.parentTId==e.tId&&o==a.move.TYPE_INNER||s(t,this.setting).find("#"+e.tId).length>0))return null;e||(e=null);var d=this;function l(){i.moveNode(d.setting,e,t,o,!1,r)}return n.canAsync(this.setting,e)&&o===a.move.TYPE_INNER?i.asyncNode(this.setting,e,r,l):l(),t},t.setEditable=function(e){return this.setting.edit.enable=e,this.refresh()}});var c=i.cancelPreSelectedNode;i.cancelPreSelectedNode=function(e,t){for(var o=l.getRoot(e).curSelectedList,r=0,d=o.length;r<d&&(t&&t!==o[r]||(i.removeTreeDom(e,o[r]),!t));r++);c&&c.apply(i,arguments)};var u=i.createNodes;i.createNodes=function(e,t,o,r,d){u&&u.apply(i,arguments),o&&i.repairParentChkClassWithSelf&&i.repairParentChkClassWithSelf(e,r)};var N=i.makeNodeUrl;i.makeNodeUrl=function(e,t){return e.edit.enable?null:N.apply(i,arguments)};var v=i.removeNode;i.removeNode=function(e,t){var o=l.getRoot(e);o.curEditNode===t&&(o.curEditNode=null),v&&v.apply(i,arguments)};var g=i.selectNode;i.selectNode=function(e,t,o){var r=l.getRoot(e);return(!l.isSelectedNode(e,t)||r.curEditNode!=t||!t.editNameFlag)&&(g&&g.apply(i,arguments),i.addHoverDom(e,t),!0)};var p=n.uCanDo;n.uCanDo=function(e,t){var o=l.getRoot(e);return!(!t||!(n.eqs(t.type,"mouseover")||n.eqs(t.type,"mouseout")||n.eqs(t.type,"mousedown")||n.eqs(t.type,"mouseup")))||(o.curEditNode&&(i.editNodeBlur=!1,o.curEditInput.focus()),!o.curEditNode&&(!p||p.apply(i,arguments)))},e("ztree.edit",$.fn.zTree)});