layui.define(["jquery","ztree"],function(e){var Ee=layui.$,Ie={event:{DRAG:"ztree_drag",DROP:"ztree_drop",RENAME:"ztree_rename",DRAGMOVE:"ztree_dragmove"},id:{EDIT:"_edit",INPUT:"_input",REMOVE:"_remove"},move:{TYPE_INNER:"inner",TYPE_PREV:"prev",TYPE_NEXT:"next"},node:{CURSELECTED_EDIT:"curSelectedNode_Edit",TMPTARGET_TREE:"tmpTargetzTree",TMPTARGET_NODE:"tmpTargetNode"}},s={onHoverOverNode:function(e,t){var o=Pe.getSetting(e.data.treeId),r=Pe.getRoot(o);r.curHoverNode!=t&&s.onHoverOutNode(e),r.curHoverNode=t,Re.addHoverDom(o,t)},onHoverOutNode:function(e,t){var o=Pe.getSetting(e.data.treeId),r=Pe.getRoot(o);r.curHoverNode&&!Pe.isSelectedNode(o,r.curHoverNode)&&(Re.removeTreeDom(o,r.curHoverNode),r.curHoverNode=null)},onMousedownNode:function(e,t){var o,r,J=Pe.getSetting(e.data.treeId),Q=Pe.getRoot(J),ee=Pe.getRoots();if(2==e.button||!J.edit.enable||!J.edit.drag.isCopy&&!J.edit.drag.isMove)return!0;var d=e.target,n=Pe.getRoot(J).curSelectedList,te=[];if(Pe.isSelectedNode(J,t))for(o=0,r=n.length;o<r;o++){if(n[o].editNameFlag&&he.eqs(d.tagName,"input")&&null!==d.getAttribute("treeNode"+be.id.INPUT))return!0;if(te.push(n[o]),te[0].parentTId!==n[o].parentTId){te=[t];break}}else te=[t];Re.editNodeBlur=!0,Re.cancelCurEditNode(J);var oe,re,de,ne,ae,ie=Ee(J.treeObj.get(0).ownerDocument),le=Ee(J.treeObj.get(0).ownerDocument.body),se=!1,ce=J,l=J,ue=null,Ne=null,ve=null,ge=be.move.TYPE_INNER,pe=e.clientX,me=e.clientY,Te=(new Date).getTime();function s(e){if(0==Q.dragFlag&&Math.abs(pe-e.clientX)<J.edit.drag.minMoveSize&&Math.abs(me-e.clientY)<J.edit.drag.minMoveSize)return!0;var t,o,r,d,n,a=J.data.key.children;if(le.css("cursor","pointer"),0==Q.dragFlag){if(0==he.apply(J.callback.beforeDrag,[J.treeId,te],!0))return fe(e),!0;for(t=0,o=te.length;t<o;t++)0==t&&(Q.dragNodeShowBefore=[]),(r=te[t]).isParent&&r.open?(Re.expandCollapseNode(J,r,!r.open),Q.dragNodeShowBefore[r.tId]=!0):Q.dragNodeShowBefore[r.tId]=!1;Q.dragFlag=1,ee.showHoverDom=!1,he.showIfameMask(J,!0);var i=!0,l=-1;if(1<te.length){var s=te[0].parentTId?te[0].getParentNode()[a]:Pe.getNodes(J);for(n=[],t=0,o=s.length;t<o;t++)if(void 0!==Q.dragNodeShowBefore[s[t].tId]&&(i&&-1<l&&l+1!==t&&(i=!1),n.push(s[t]),l=t),te.length===n.length){te=n;break}}for(i&&(ne=te[0].getPreNode(),ae=te[te.length-1].getNextNode()),oe=we("<ul class='zTreeDragUL'></ul>",J),t=0,o=te.length;t<o;t++)(r=te[t]).editNameFlag=!1,Re.selectNode(J,r,0<t),Re.removeTreeDom(J,r),t>J.edit.drag.maxShowNodeNum-1||((d=we("<li id='"+r.tId+"_tmp'></li>",J)).append(we(r,be.id.A,J).clone()),d.css("padding","0"),d.children("#"+r.tId+be.id.A).removeClass(be.node.CURSELECTED),oe.append(d),t==J.edit.drag.maxShowNodeNum-1&&(d=we("<li id='"+r.tId+"_moretmp'><a>  ...  </a></li>",J),oe.append(d)));oe.attr("id",te[0].tId+be.id.UL+"_tmp"),oe.addClass(J.treeObj.attr("class")),oe.appendTo(le),(re=we("<span class='tmpzTreeMove_arrow'></span>",J)).attr("id","zTreeMove_arrow_tmp"),re.appendTo(le),J.treeObj.trigger(be.event.DRAG,[e,J.treeId,te])}if(1==Q.dragFlag){if(de&&re.attr("id")==e.target.id&&ve&&e.clientX+ie.scrollLeft()+2>Ee("#"+ve+be.id.A,de).offset().left){var c=Ee("#"+ve+be.id.A,de);e.target=0<c.length?c.get(0):e.target}else de&&(de.removeClass(be.node.TMPTARGET_TREE),ve&&Ee("#"+ve+be.id.A,de).removeClass(be.node.TMPTARGET_NODE+"_"+be.move.TYPE_PREV).removeClass(be.node.TMPTARGET_NODE+"_"+Ie.move.TYPE_NEXT).removeClass(be.node.TMPTARGET_NODE+"_"+Ie.move.TYPE_INNER));ve=de=null,se=!1,ce=J;var u=Pe.getSettings();for(var N in u)u[N].treeId&&u[N].edit.enable&&u[N].treeId!=J.treeId&&(e.target.id==u[N].treeId||0<Ee(e.target).parents("#"+u[N].treeId).length)&&(se=!0,ce=u[N]);var v=ie.scrollTop(),g=ie.scrollLeft(),p=ce.treeObj.offset(),m=ce.treeObj.get(0).scrollHeight,T=ce.treeObj.get(0).scrollWidth,f=e.clientY+v-p.top,E=ce.treeObj.height()+p.top-e.clientY-v,I=e.clientX+g-p.left,h=ce.treeObj.width()+p.left-e.clientX-g,b=f<J.edit.drag.borderMax&&f>J.edit.drag.borderMin,R=E<J.edit.drag.borderMax&&E>J.edit.drag.borderMin,P=I<J.edit.drag.borderMax&&I>J.edit.drag.borderMin,w=h<J.edit.drag.borderMax&&h>J.edit.drag.borderMin,M=f>J.edit.drag.borderMin&&E>J.edit.drag.borderMin&&I>J.edit.drag.borderMin&&h>J.edit.drag.borderMin,C=b&&ce.treeObj.scrollTop()<=0,_=R&&ce.treeObj.scrollTop()+ce.treeObj.height()+10>=m,O=P&&ce.treeObj.scrollLeft()<=0,D=w&&ce.treeObj.scrollLeft()+ce.treeObj.width()+10>=T;if(e.target&&he.isChildOrSelf(e.target,ce.treeId)){for(var y=e.target;y&&y.tagName&&!he.eqs(y.tagName,"li")&&y.id!=ce.treeId;)y=y.parentNode;var k=!0;for(t=0,o=te.length;t<o;t++){if(r=te[t],y.id===r.tId){k=!1;break}if(0<we(r,J).find("#"+y.id).length){k=!1;break}}k&&e.target&&he.isChildOrSelf(e.target,y.id+be.id.A)&&(de=Ee(y),ve=y.id)}r=te[0],M&&he.isChildOrSelf(e.target,ce.treeId)&&(!de&&(e.target.id==ce.treeId||C||_||O||D)&&(se||!se&&r.parentTId)&&(de=ce.treeObj),b?ce.treeObj.scrollTop(ce.treeObj.scrollTop()-10):R&&ce.treeObj.scrollTop(ce.treeObj.scrollTop()+10),P?ce.treeObj.scrollLeft(ce.treeObj.scrollLeft()-10):w&&ce.treeObj.scrollLeft(ce.treeObj.scrollLeft()+10),de&&de!=ce.treeObj&&de.offset().left<ce.treeObj.offset().left&&ce.treeObj.scrollLeft(ce.treeObj.scrollLeft()+de.offset().left-ce.treeObj.offset().left)),oe.css({top:e.clientY+v+3+"px",left:e.clientX+g+3+"px"});var S=0,A=0;if(de&&de.attr("id")!=ce.treeId){var L=function(){de=null,ve="",ge=be.move.TYPE_INNER,re.css({display:"none"}),window.zTreeMoveTimer&&(clearTimeout(window.zTreeMoveTimer),window.zTreeMoveTargetNodeTId=null)},Y=null==ve?null:Pe.getNodeCache(ce,ve),x=(e.ctrlKey||e.metaKey)&&J.edit.drag.isMove&&J.edit.drag.isCopy||!J.edit.drag.isMove&&J.edit.drag.isCopy,j=!(!ne||ve!==ne.tId),z=!(!ae||ve!==ae.tId),B=r.parentTId&&r.parentTId==ve,H=(x||!z)&&he.apply(ce.edit.drag.prev,[ce.treeId,te,Y],!!ce.edit.drag.prev),F=(x||!j)&&he.apply(ce.edit.drag.next,[ce.treeId,te,Y],!!ce.edit.drag.next),V=(x||!B)&&!(ce.data.keep.leaf&&!Y.isParent)&&he.apply(ce.edit.drag.inner,[ce.treeId,te,Y],!!ce.edit.drag.inner);if(H||F||V){var U=Ee("#"+ve+be.id.A,de),G=Y.isLastNode?null:Ee("#"+Y.getNextNode().tId+be.id.A,de.next()),X=U.offset().top,q=U.offset().left,W=H?V?.25:F?.5:1:-1,K=F?V?.75:H?.5:0:-1,$=(e.clientY+v-X)/U.height();if((1==W||$<=W&&-.2<=$)&&H?(S=1-re.width(),A=X-re.height()/2,ge=be.move.TYPE_PREV):(0==K||K<=$&&$<=1.2)&&F?(S=1-re.width(),A=null==G||Y.isParent&&Y.open?X+U.height()-re.height()/2:G.offset().top-re.height()/2,ge=be.move.TYPE_NEXT):V?(S=5-re.width(),A=X,ge=be.move.TYPE_INNER):L(),de&&(re.css({display:"block",top:A+"px",left:q+S+"px"}),U.addClass(be.node.TMPTARGET_NODE+"_"+ge),ue==ve&&Ne==ge||(Te=(new Date).getTime()),Y&&Y.isParent&&ge==be.move.TYPE_INNER)){var Z=!0;window.zTreeMoveTimer&&window.zTreeMoveTargetNodeTId!==Y.tId?(clearTimeout(window.zTreeMoveTimer),window.zTreeMoveTargetNodeTId=null):window.zTreeMoveTimer&&window.zTreeMoveTargetNodeTId===Y.tId&&(Z=!1),Z&&(window.zTreeMoveTimer=setTimeout(function(){ge==be.move.TYPE_INNER&&Y&&Y.isParent&&!Y.open&&(new Date).getTime()-Te>ce.edit.drag.autoOpenTime&&he.apply(ce.callback.beforeDragOpen,[ce.treeId,Y],!0)&&(Re.switchNode(ce,Y),ce.edit.drag.autoExpandTrigger&&ce.treeObj.trigger(be.event.EXPAND,[ce.treeId,Y]))},ce.edit.drag.autoOpenTime+50),window.zTreeMoveTargetNodeTId=Y.tId)}}else L()}else ge=be.move.TYPE_INNER,de&&he.apply(ce.edit.drag.inner,[ce.treeId,te,null],!!ce.edit.drag.inner)?de.addClass(be.node.TMPTARGET_TREE):de=null,re.css({display:"none"}),window.zTreeMoveTimer&&(clearTimeout(window.zTreeMoveTimer),window.zTreeMoveTargetNodeTId=null);ue=ve,Ne=ge,J.treeObj.trigger(be.event.DRAGMOVE,[e,J.treeId,te])}return!1}function fe(r){if(window.zTreeMoveTimer&&(clearTimeout(window.zTreeMoveTimer),window.zTreeMoveTargetNodeTId=null),Ne=ue=null,ie.unbind("mousemove",s),ie.unbind("mouseup",fe),ie.unbind("selectstart",c),le.css("cursor",""),de&&(de.removeClass(be.node.TMPTARGET_TREE),ve&&Ee("#"+ve+be.id.A,de).removeClass(be.node.TMPTARGET_NODE+"_"+be.move.TYPE_PREV).removeClass(be.node.TMPTARGET_NODE+"_"+Ie.move.TYPE_NEXT).removeClass(be.node.TMPTARGET_NODE+"_"+Ie.move.TYPE_INNER)),he.showIfameMask(J,!1),ee.showHoverDom=!0,0!=Q.dragFlag){var e,t,o;for(e=Q.dragFlag=0,t=te.length;e<t;e++)(o=te[e]).isParent&&Q.dragNodeShowBefore[o.tId]&&!o.open&&(Re.expandCollapseNode(J,o,!o.open),delete Q.dragNodeShowBefore[o.tId]);oe&&oe.remove(),re&&re.remove();var d=(r.ctrlKey||r.metaKey)&&J.edit.drag.isMove&&J.edit.drag.isCopy||!J.edit.drag.isMove&&J.edit.drag.isCopy;if(!d&&de&&ve&&te[0].parentTId&&ve==te[0].parentTId&&ge==be.move.TYPE_INNER&&(de=null),de){var n=function(){if(se){if(!d)for(var e=0,t=te.length;e<t;e++)Re.removeNode(J,te[e]);ge==be.move.TYPE_INNER?Re.addNodes(ce,a,-1,i):Re.addNodes(ce,a.getParentNode(),ge==be.move.TYPE_PREV?a.getIndex():a.getIndex()+1,i)}else if(d&&ge==be.move.TYPE_INNER)Re.addNodes(ce,a,-1,i);else if(d)Re.addNodes(ce,a.getParentNode(),ge==be.move.TYPE_PREV?a.getIndex():a.getIndex()+1,i);else if(ge!=be.move.TYPE_NEXT)for(e=0,t=i.length;e<t;e++)Re.moveNode(ce,a,i[e],ge,!1);else for(e=-1,t=i.length-1;e<t;t--)Re.moveNode(ce,a,i[t],ge,!1);Re.selectNodes(ce,i);var o=we(i[0],J).get(0);Re.scrollIntoView(J,o),J.treeObj.trigger(be.event.DROP,[r,ce.treeId,i,a,ge,d])},a=null==ve?null:Pe.getNodeCache(ce,ve);if(0==he.apply(J.callback.beforeDrop,[ce.treeId,te,a,ge,d],!0))return void Re.selectNodes(l,te);var i=d?he.clone(te):te;ge==be.move.TYPE_INNER&&he.canAsync(ce,a)?Re.asyncNode(ce,a,!1,n):n()}else Re.selectNodes(l,te),J.treeObj.trigger(be.event.DROP,[r,J.treeId,te,null,null,null])}}function c(){return!1}return he.uCanDo(J)&&ie.bind("mousemove",s),ie.bind("mouseup",fe),ie.bind("selectstart",c),e.preventDefault&&e.preventDefault(),!0}},t={tools:{getAbs:function(e){var t=e.getBoundingClientRect(),o=document.body.scrollTop+document.documentElement.scrollTop,r=document.body.scrollLeft+document.documentElement.scrollLeft;return[t.left+r,t.top+o]},inputFocus:function(e){e.get(0)&&(e.focus(),he.setCursorPosition(e.get(0),e.val().length))},inputSelect:function(e){e.get(0)&&(e.focus(),e.select())},setCursorPosition:function(e,t){if(e.setSelectionRange)e.focus(),e.setSelectionRange(t,t);else if(e.createTextRange){var o=e.createTextRange();o.collapse(!0),o.moveEnd("character",t),o.moveStart("character",t),o.select()}},showIfameMask:function(e,t){for(var o=Pe.getRoot(e);0<o.dragMaskList.length;)o.dragMaskList[0].remove(),o.dragMaskList.shift();if(t)for(var r=we("iframe",e),d=0,n=r.length;d<n;d++){var a=r.get(d),i=he.getAbs(a),l=we("<div id='zTreeMask_"+d+"' class='zTreeMask' style='top:"+i[1]+"px; left:"+i[0]+"px; width:"+a.offsetWidth+"px; height:"+a.offsetHeight+"px;'></div>",e);l.appendTo(we("body",e)),o.dragMaskList.push(l)}}},view:{addEditBtn:function(e,t){if(!(t.editNameFlag||0<we(t,be.id.EDIT,e).length)&&he.apply(e.edit.showRenameBtn,[e.treeId,t],e.edit.showRenameBtn)){var o=we(t,be.id.A,e),r="<span class='"+be.className.BUTTON+" edit' id='"+t.tId+be.id.EDIT+"' title='"+he.apply(e.edit.renameTitle,[e.treeId,t],e.edit.renameTitle)+"' treeNode"+be.id.EDIT+" style='display:none;'></span>";o.append(r),we(t,be.id.EDIT,e).bind("click",function(){return he.uCanDo(e)&&0!=he.apply(e.callback.beforeEditName,[e.treeId,t],!0)&&Re.editNode(e,t),!1}).show()}},addRemoveBtn:function(e,t){if(!(t.editNameFlag||0<we(t,be.id.REMOVE,e).length)&&he.apply(e.edit.showRemoveBtn,[e.treeId,t],e.edit.showRemoveBtn)){var o=we(t,be.id.A,e),r="<span class='"+be.className.BUTTON+" remove' id='"+t.tId+be.id.REMOVE+"' title='"+he.apply(e.edit.removeTitle,[e.treeId,t],e.edit.removeTitle)+"' treeNode"+be.id.REMOVE+" style='display:none;'></span>";o.append(r),we(t,be.id.REMOVE,e).bind("click",function(){return he.uCanDo(e)&&0!=he.apply(e.callback.beforeRemove,[e.treeId,t],!0)&&(Re.removeNode(e,t),e.treeObj.trigger(be.event.REMOVE,[e.treeId,t])),!1}).bind("mousedown",function(e){return!0}).show()}},addHoverDom:function(e,t){Pe.getRoots().showHoverDom&&(t.isHover=!0,e.edit.enable&&(Re.addEditBtn(e,t),Re.addRemoveBtn(e,t)),he.apply(e.view.addHoverDom,[e.treeId,t]))},cancelCurEditNode:function(e,t,o){var r=Pe.getRoot(e),d=e.data.key.name,n=r.curEditNode;if(n){var a=r.curEditInput,i=t||(o?n[d]:a.val());if(!1===he.apply(e.callback.beforeRename,[e.treeId,n,i,o],!0))return!1;n[d]=i,we(n,be.id.A,e).removeClass(be.node.CURSELECTED_EDIT),a.unbind(),Re.setNodeName(e,n),n.editNameFlag=!1,r.curEditNode=null,r.curEditInput=null,Re.selectNode(e,n,!1),e.treeObj.trigger(be.event.RENAME,[e.treeId,n,o])}return r.noSelection=!0},editNode:function(t,e){var o=Pe.getRoot(t);if(Re.editNodeBlur=!1,Pe.isSelectedNode(t,e)&&o.curEditNode==e&&e.editNameFlag)setTimeout(function(){he.inputFocus(o.curEditInput)},0);else{var r=t.data.key.name;e.editNameFlag=!0,Re.removeTreeDom(t,e),Re.cancelCurEditNode(t),Re.selectNode(t,e,!1),we(e,be.id.SPAN,t).html("<input type=text class='rename' id='"+e.tId+be.id.INPUT+"' treeNode"+be.id.INPUT+" >");var d=we(e,be.id.INPUT,t);d.attr("value",e[r]),t.edit.editNameSelectAll?he.inputSelect(d):he.inputFocus(d),d.bind("blur",function(e){Re.editNodeBlur||Re.cancelCurEditNode(t)}).bind("keydown",function(e){"13"==e.keyCode?(Re.editNodeBlur=!0,Re.cancelCurEditNode(t)):"27"==e.keyCode&&Re.cancelCurEditNode(t,null,!0)}).bind("click",function(e){return!1}).bind("dblclick",function(e){return!1}),we(e,be.id.A,t).addClass(be.node.CURSELECTED_EDIT),o.curEditInput=d,o.noSelection=!1,o.curEditNode=e}},moveNode:function(e,t,o,r,d,n){var a=Pe.getRoot(e),i=e.data.key.children;if(t!=o&&(!e.data.keep.leaf||!t||t.isParent||r!=be.move.TYPE_INNER)){var l=o.parentTId?o.getParentNode():a,s=null===t||t==a;s&&null===t&&(t=a),s&&(r=be.move.TYPE_INNER);var c,u,N=t.parentTId?t.getParentNode():a;if(r!=be.move.TYPE_PREV&&r!=be.move.TYPE_NEXT&&(r=be.move.TYPE_INNER),r==be.move.TYPE_INNER&&(s?o.parentTId=null:(t.isParent||(t.isParent=!0,t.open=!!t.open,Re.setNodeLineIcos(e,t)),o.parentTId=t.tId)),s)u=c=e.treeObj;else{if(n||r!=be.move.TYPE_INNER?n||Re.expandCollapseNode(e,t.getParentNode(),!0,!1):Re.expandCollapseNode(e,t,!0,!1),c=we(t,e),u=we(t,be.id.UL,e),c.get(0)&&!u.get(0)){var v=[];Re.makeUlHtml(e,t,v,""),c.append(v.join(""))}u=we(t,be.id.UL,e)}var g=we(o,e);g.get(0)?c.get(0)||g.remove():g=Re.appendNodes(e,o.level,[o],null,-1,!1,!0).join(""),u.get(0)&&r==be.move.TYPE_INNER?u.append(g):c.get(0)&&r==be.move.TYPE_PREV?c.before(g):c.get(0)&&r==be.move.TYPE_NEXT&&c.after(g);var p,m,T=-1,f=0,E=null,I=null,h=o.level;if(o.isFirstNode)T=0,1<l[i].length&&((E=l[i][1]).isFirstNode=!0);else if(o.isLastNode)T=l[i].length-1,(E=l[i][T-1]).isLastNode=!0;else for(p=0,m=l[i].length;p<m;p++)if(l[i][p].tId==o.tId){T=p;break}if(0<=T&&l[i].splice(T,1),r!=be.move.TYPE_INNER)for(p=0,m=N[i].length;p<m;p++)N[i][p].tId==t.tId&&(f=p);if(r==be.move.TYPE_INNER?(t[i]||(t[i]=new Array),0<t[i].length&&((I=t[i][t[i].length-1]).isLastNode=!1),t[i].splice(t[i].length,0,o),o.isLastNode=!0,o.isFirstNode=1==t[i].length):t.isFirstNode&&r==be.move.TYPE_PREV?(N[i].splice(f,0,o),(I=t).isFirstNode=!1,o.parentTId=t.parentTId,o.isFirstNode=!0,o.isLastNode=!1):t.isLastNode&&r==be.move.TYPE_NEXT?(N[i].splice(f+1,0,o),(I=t).isLastNode=!1,o.parentTId=t.parentTId,o.isFirstNode=!1,o.isLastNode=!0):(r==be.move.TYPE_PREV?N[i].splice(f,0,o):N[i].splice(f+1,0,o),o.parentTId=t.parentTId,o.isFirstNode=!1,o.isLastNode=!1),Pe.fixPIdKeyValue(e,o),Pe.setSonNodeLevel(e,o.getParentNode(),o),Re.setNodeLineIcos(e,o),Re.repairNodeLevelClass(e,o,h),!e.data.keep.parent&&l[i].length<1){l.isParent=!1,l.open=!1;var b=we(l,be.id.UL,e),R=we(l,be.id.SWITCH,e),P=we(l,be.id.ICON,e);Re.replaceSwitchClass(l,R,be.folder.DOCU),Re.replaceIcoClass(l,P,be.folder.DOCU),b.css("display","none")}else E&&Re.setNodeLineIcos(e,E);I&&Re.setNodeLineIcos(e,I),e.check&&e.check.enable&&Re.repairChkClass&&(Re.repairChkClass(e,l),Re.repairParentChkClassWithSelf(e,l),l!=o.parent&&Re.repairParentChkClassWithSelf(e,o)),n||Re.expandCollapseParentNode(e,o.getParentNode(),!0,d)}},removeEditBtn:function(e,t){we(t,be.id.EDIT,e).unbind().remove()},removeRemoveBtn:function(e,t){we(t,be.id.REMOVE,e).unbind().remove()},removeTreeDom:function(e,t){t.isHover=!1,Re.removeEditBtn(e,t),Re.removeRemoveBtn(e,t),he.apply(e.view.removeHoverDom,[e.treeId,t])},repairNodeLevelClass:function(e,t,o){if(o!==t.level){var r=we(t,e),d=we(t,be.id.A,e),n=we(t,be.id.UL,e),a=be.className.LEVEL+o,i=be.className.LEVEL+t.level;r.removeClass(a),r.addClass(i),d.removeClass(a),d.addClass(i),n.removeClass(a),n.addClass(i)}},selectNodes:function(e,t){for(var o=0,r=t.length;o<r;o++)Re.selectNode(e,t[o],0<o)}},event:{},data:{setSonNodeLevel:function(e,t,o){if(o){var r=e.data.key.children;if(o.level=t?t.level+1:0,o[r])for(var d=0,n=o[r].length;d<n;d++)o[r][d]&&Pe.setSonNodeLevel(e,o,o[r][d])}}}};Ee.extend(!0,Ee.fn.zTree.consts,Ie),Ee.extend(!0,Ee.fn.zTree._z,t);var o=Ee.fn.zTree,he=o._z.tools,be=o.consts,Re=o._z.view,Pe=o._z.data,we=(o._z.event,he.$);Pe.exSetting({edit:{enable:!1,editNameSelectAll:!1,showRemoveBtn:!0,showRenameBtn:!0,removeTitle:"remove",renameTitle:"rename",drag:{autoExpandTrigger:!1,isCopy:!0,isMove:!0,prev:!0,next:!0,inner:!0,minMoveSize:5,borderMax:10,borderMin:-5,maxShowNodeNum:5,autoOpenTime:500}},view:{addHoverDom:null,removeHoverDom:null},callback:{beforeDrag:null,beforeDragOpen:null,beforeDrop:null,beforeEditName:null,beforeRename:null,onDrag:null,onDragMove:null,onDrop:null,onRename:null}}),Pe.addInitBind(function(i){var e=i.treeObj,t=be.event;e.bind(t.RENAME,function(e,t,o,r){he.apply(i.callback.onRename,[e,t,o,r])}),e.bind(t.DRAG,function(e,t,o,r){he.apply(i.callback.onDrag,[t,o,r])}),e.bind(t.DRAGMOVE,function(e,t,o,r){he.apply(i.callback.onDragMove,[t,o,r])}),e.bind(t.DROP,function(e,t,o,r,d,n,a){he.apply(i.callback.onDrop,[t,o,r,d,n,a])})}),Pe.addInitUnBind(function(e){var t=e.treeObj,o=be.event;t.unbind(o.RENAME),t.unbind(o.DRAG),t.unbind(o.DRAGMOVE),t.unbind(o.DROP)}),Pe.addInitCache(function(e){}),Pe.addInitNode(function(e,t,o,r,d,n,a){o&&(o.isHover=!1,o.editNameFlag=!1)}),Pe.addInitProxy(function(e){var t=e.target,o=Pe.getSetting(e.data.treeId),r=e.relatedTarget,d="",n=null,a="",i=null,l=null;if(he.eqs(e.type,"mouseover")?(l=he.getMDom(o,t,[{tagName:"a",attrName:"treeNode"+be.id.A}]))&&(d=he.getNodeMainDom(l).id,a="hoverOverNode"):he.eqs(e.type,"mouseout")?(l=he.getMDom(o,r,[{tagName:"a",attrName:"treeNode"+be.id.A}]))||(d="remove",a="hoverOutNode"):he.eqs(e.type,"mousedown")&&(l=he.getMDom(o,t,[{tagName:"a",attrName:"treeNode"+be.id.A}]))&&(d=he.getNodeMainDom(l).id,a="mousedownNode"),0<d.length)switch(n=Pe.getNodeCache(o,d),a){case"mousedownNode":i=s.onMousedownNode;break;case"hoverOverNode":i=s.onHoverOverNode;break;case"hoverOutNode":i=s.onHoverOutNode}return{stop:!1,node:n,nodeEventType:a,nodeEventCallback:i,treeEventType:"",treeEventCallback:null}}),Pe.addInitRoot(function(e){var t=Pe.getRoot(e),o=Pe.getRoots();t.curEditNode=null,t.curEditInput=null,t.curHoverNode=null,t.dragFlag=0,t.dragNodeShowBefore=[],t.dragMaskList=new Array,o.showHoverDom=!0}),Pe.addZTreeTools(function(e,t){t.cancelEditName=function(e){Pe.getRoot(this.setting).curEditNode&&Re.cancelCurEditNode(this.setting,e||null,!0)},t.copyNode=function(e,t,o,r){if(!t)return null;if(e&&!e.isParent&&this.setting.data.keep.leaf&&o===be.move.TYPE_INNER)return null;var d=this,n=he.clone(t);if(e||(e=null,o=be.move.TYPE_INNER),o==be.move.TYPE_INNER){var a=function(){Re.addNodes(d.setting,e,-1,[n],r)};he.canAsync(this.setting,e)?Re.asyncNode(this.setting,e,r,a):a()}else Re.addNodes(this.setting,e.parentNode,-1,[n],r),Re.moveNode(this.setting,e,n,o,!1,r);return n},t.editName=function(e){e&&e.tId&&e===Pe.getNodeCache(this.setting,e.tId)&&(e.parentTId&&Re.expandCollapseParentNode(this.setting,e.getParentNode(),!0),Re.editNode(this.setting,e))},t.moveNode=function(e,t,o,r){if(!t)return t;if(e&&!e.isParent&&this.setting.data.keep.leaf&&o===be.move.TYPE_INNER)return null;if(e&&(t.parentTId==e.tId&&o==be.move.TYPE_INNER||0<we(t,this.setting).find("#"+e.tId).length))return null;e||(e=null);var d=this;function n(){Re.moveNode(d.setting,e,t,o,!1,r)}return he.canAsync(this.setting,e)&&o===be.move.TYPE_INNER?Re.asyncNode(this.setting,e,r,n):n(),t},t.setEditable=function(e){return this.setting.edit.enable=e,this.refresh()}});var n=Re.cancelPreSelectedNode;Re.cancelPreSelectedNode=function(e,t){for(var o=Pe.getRoot(e).curSelectedList,r=0,d=o.length;r<d&&(t&&t!==o[r]||(Re.removeTreeDom(e,o[r]),!t));r++);n&&n.apply(Re,arguments)};var a=Re.createNodes;Re.createNodes=function(e,t,o,r,d){a&&a.apply(Re,arguments),o&&Re.repairParentChkClassWithSelf&&Re.repairParentChkClassWithSelf(e,r)};var r=Re.makeNodeUrl;Re.makeNodeUrl=function(e,t){return e.edit.enable?null:r.apply(Re,arguments)};var d=Re.removeNode;Re.removeNode=function(e,t){var o=Pe.getRoot(e);o.curEditNode===t&&(o.curEditNode=null),d&&d.apply(Re,arguments)};var i=Re.selectNode;Re.selectNode=function(e,t,o){var r=Pe.getRoot(e);return(!Pe.isSelectedNode(e,t)||r.curEditNode!=t||!t.editNameFlag)&&(i&&i.apply(Re,arguments),Re.addHoverDom(e,t),!0)};var l=he.uCanDo;he.uCanDo=function(e,t){var o=Pe.getRoot(e);return!(!t||!(he.eqs(t.type,"mouseover")||he.eqs(t.type,"mouseout")||he.eqs(t.type,"mousedown")||he.eqs(t.type,"mouseup")))||(o.curEditNode&&(Re.editNodeBlur=!1,o.curEditInput.focus()),!o.curEditNode&&(!l||l.apply(Re,arguments)))},e("ztree.edit",Ee.fn.zTree)});